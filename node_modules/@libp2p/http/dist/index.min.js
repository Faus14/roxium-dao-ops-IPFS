(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PHttp = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PHttp=(()=>{var Hu=Object.create;var Ur=Object.defineProperty;var Mu=Object.getOwnPropertyDescriptor;var $u=Object.getOwnPropertyNames;var qu=Object.getPrototypeOf,Vu=Object.prototype.hasOwnProperty;var zu=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),yt=(e,t)=>{for(var r in t)Ur(e,r,{get:t[r],enumerable:!0})},hi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of $u(t))!Vu.call(e,o)&&o!==r&&Ur(e,o,{get:()=>t[o],enumerable:!(n=Mu(t,o))||n.enumerable});return e};var Fu=(e,t,r)=>(r=e!=null?Hu(qu(e)):{},hi(t||!e||!e.__esModule?Ur(r,"default",{value:e,enumerable:!0}):r,e)),Gu=e=>hi(Ur({},"__esModule",{value:!0}),e);var mu=zu(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.parse=Zd;Un.serialize=Xd;var zd=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,Fd=/^[\u0021-\u003A\u003C-\u007E]*$/,Gd=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,Wd=/^[\u0020-\u003A\u003D-\u007E]*$/,Yd=Object.prototype.toString,jd=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function Zd(e,t){let r=new jd,n=e.length;if(n<2)return r;let o=t?.decode||Qd,s=0;do{let i=e.indexOf("=",s);if(i===-1)break;let a=e.indexOf(";",s),c=a===-1?n:a;if(i>c){s=e.lastIndexOf(";",i-1)+1;continue}let u=du(e,s,i),f=pu(e,i,u),l=e.slice(u,f);if(r[l]===void 0){let d=du(e,i+1,c),x=pu(e,c,d),p=o(e.slice(d,x));r[l]=p}s=c+1}while(s<n);return r}function du(e,t,r){do{let n=e.charCodeAt(t);if(n!==32&&n!==9)return t}while(++t<r);return r}function pu(e,t,r){for(;t>r;){let n=e.charCodeAt(--t);if(n!==32&&n!==9)return t+1}return r}function Xd(e,t,r){let n=r?.encode||encodeURIComponent;if(!zd.test(e))throw new TypeError(`argument name is invalid: ${e}`);let o=n(t);if(!Fd.test(o))throw new TypeError(`argument val is invalid: ${t}`);let s=e+"="+o;if(!r)return s;if(r.maxAge!==void 0){if(!Number.isInteger(r.maxAge))throw new TypeError(`option maxAge is invalid: ${r.maxAge}`);s+="; Max-Age="+r.maxAge}if(r.domain){if(!Gd.test(r.domain))throw new TypeError(`option domain is invalid: ${r.domain}`);s+="; Domain="+r.domain}if(r.path){if(!Wd.test(r.path))throw new TypeError(`option path is invalid: ${r.path}`);s+="; Path="+r.path}if(r.expires){if(!Jd(r.expires)||!Number.isFinite(r.expires.valueOf()))throw new TypeError(`option expires is invalid: ${r.expires}`);s+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.partitioned&&(s+="; Partitioned"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():void 0){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"none":s+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${r.sameSite}`)}return s}function Qd(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch{return e}}function Jd(e){return Yd.call(e)==="[object Date]"}});var hp={};yt(hp,{HTTP_PROTOCOL:()=>Ae,WELL_KNOWN_PROTOCOLS_PATH:()=>Dr,authenticatedRoute:()=>ku,authenticatedWebSocketRoute:()=>Ku,http:()=>lp,webSocketRoute:()=>Ge});var Yn={};yt(Yn,{base10:()=>Ju});var pp=new Uint8Array(0);function di(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function kt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function pi(e){return new TextEncoder().encode(e)}function mi(e){return new TextDecoder().decode(e)}function Wu(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var C=0,A=0,g=0,v=p.length;g!==v&&p[g]===0;)g++,C++;for(var b=(v-g)*f+1>>>0,I=new Uint8Array(b);g!==v;){for(var N=p[g],M=0,$=b-1;(N!==0||M<A)&&$!==-1;$--,M++)N+=256*I[$]>>>0,I[$]=N%a>>>0,N=N/a>>>0;if(N!==0)throw new Error("Non-zero carry");A=M,g++}for(var E=b-A;E!==b&&I[E]===0;)E++;for(var w=c.repeat(C);E<b;++E)w+=e.charAt(I[E]);return w}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var C=0;if(p[C]!==" "){for(var A=0,g=0;p[C]===c;)A++,C++;for(var v=(p.length-C)*u+1>>>0,b=new Uint8Array(v);p[C];){var I=r[p.charCodeAt(C)];if(I===255)return;for(var N=0,M=v-1;(I!==0||N<g)&&M!==-1;M--,N++)I+=a*b[M]>>>0,b[M]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");g=N,C++}if(p[C]!==" "){for(var $=v-g;$!==v&&b[$]===0;)$++;for(var E=new Uint8Array(A+(v-$)),w=A;$!==v;)E[w++]=b[$++];return E}}}function x(p){var C=d(p);if(C)return C;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:d,decode:x}}var Yu=Wu,ju=Yu,gi=ju;var zn=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Fn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return bi(this,t)}},Gn=class{decoders;constructor(t){this.decoders=t}or(t){return bi(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function bi(e,t){return new Gn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Wn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new zn(t,r,n),this.decoder=new Fn(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function ve({name:e,prefix:t,encode:r,decode:n}){return new Wn(e,t,r,n)}function Zt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=gi(r,e);return ve({prefix:t,name:e,encode:n,decode:s=>kt(o(s))})}function Zu(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let u=0;u<o;++u){let f=t[e[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|f,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Xu(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function Qu(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function X({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=Qu(n);return ve({prefix:t,name:e,encode(s){return Xu(s,n,r)},decode(s){return Zu(s,o,r,e)}})}var Ju=Zt({prefix:"9",name:"base10",alphabet:"0123456789"});var jn={};yt(jn,{base16:()=>tf,base16upper:()=>ef});var tf=X({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ef=X({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Zn={};yt(Zn,{base2:()=>rf});var rf=X({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Xn={};yt(Xn,{base256emoji:()=>cf});var wi=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),nf=wi.reduce((e,t,r)=>(e[r]=t,e),[]),of=wi.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function sf(e){return e.reduce((t,r)=>(t+=nf[r],t),"")}function af(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=of[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var cf=ve({prefix:"\u{1F680}",name:"base256emoji",encode:sf,decode:af});var Qn={};yt(Qn,{base32:()=>Xt,base32hex:()=>hf,base32hexpad:()=>pf,base32hexpadupper:()=>mf,base32hexupper:()=>df,base32pad:()=>ff,base32padupper:()=>lf,base32upper:()=>uf,base32z:()=>yf});var Xt=X({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uf=X({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ff=X({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),lf=X({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hf=X({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),df=X({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pf=X({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mf=X({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),yf=X({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Jn={};yt(Jn,{base36:()=>ue,base36upper:()=>gf});var ue=Zt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gf=Zt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var to={};yt(to,{base58btc:()=>Q,base58flickr:()=>bf});var Q=Zt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bf=Zt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ro={};yt(ro,{base64:()=>wf,base64pad:()=>je,base64url:()=>eo,base64urlpad:()=>xf});var wf=X({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),je=X({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),eo=X({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xf=X({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var no={};yt(no,{base8:()=>Ef});var Ef=X({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var oo={};yt(oo,{identity:()=>Sf});var Sf=ve({prefix:"\0",name:"identity",encode:e=>mi(e),decode:e=>pi(e)});var Op=new TextEncoder,Bp=new TextDecoder;var io={};yt(io,{identity:()=>vt});var Tf=Si,xi=128,Cf=127,If=~Cf,_f=Math.pow(2,31);function Si(e,t,r){t=t||[],r=r||0;for(var n=r;e>=_f;)t[r++]=e&255|xi,e/=128;for(;e&If;)t[r++]=e&255|xi,e>>>=7;return t[r]=e|0,Si.bytes=r-n+1,t}var Rf=so,Of=128,Ei=127;function so(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw so.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Ei)<<o:(i&Ei)*Math.pow(2,o),o+=7}while(i>=Of);return so.bytes=s-n,r}var Bf=Math.pow(2,7),Lf=Math.pow(2,14),Df=Math.pow(2,21),Pf=Math.pow(2,28),Uf=Math.pow(2,35),Nf=Math.pow(2,42),kf=Math.pow(2,49),Kf=Math.pow(2,56),Hf=Math.pow(2,63),Mf=function(e){return e<Bf?1:e<Lf?2:e<Df?3:e<Pf?4:e<Uf?5:e<Nf?6:e<kf?7:e<Kf?8:e<Hf?9:10},$f={encode:Tf,decode:Rf,encodingLength:Mf},qf=$f,Ze=qf;function Xe(e,t=0){return[Ze.decode(e,t),Ze.decode.bytes]}function Te(e,t,r=0){return Ze.encode(e,t,r),t}function Ce(e){return Ze.encodingLength(e)}function Ot(e,t){let r=t.byteLength,n=Ce(e),o=n+Ce(r),s=new Uint8Array(o+r);return Te(e,s,0),Te(r,s,n),s.set(t,o),new Ie(e,r,t,s)}function Qe(e){let t=kt(e),[r,n]=Xe(t),[o,s]=Xe(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Ie(r,o,i,t)}function Ai(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&di(e.bytes,r.bytes)}}var Ie=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};var vi=0,Vf="identity",Ti=kt;function zf(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return Ot(vi,Ti(e))}var vt={code:vi,name:Vf,encode:Ti,digest:zf};var co={};yt(co,{sha256:()=>tr,sha512:()=>Gf});var Ff=20;function Je({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new ao(e,t,r,n,o)}var ao=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??Ff,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Ci(n,this.code,r?.truncate):n.then(o=>Ci(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Ci(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return Ot(t,e)}function _i(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var tr=Je({name:"sha2-256",code:18,encode:_i("SHA-256")}),Gf=Je({name:"sha2-512",code:19,encode:_i("SHA-512")});function Ri(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Yf(r,uo(e),t??Q.encoder);default:return jf(r,uo(e),t??Xt.encoder)}}var Oi=new WeakMap;function uo(e){let t=Oi.get(e);if(t==null){let r=new Map;return Oi.set(e,r),r}return t}var nt=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==er)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Zf)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Ot(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&Ai(t.multihash,n.multihash)}toString(t){return Ri(this,t)}toJSON(){return{"/":Ri(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Bi(n,o,s.bytes))}else if(r[Xf]===!0){let{version:n,multihash:o,code:s}=r,i=Qe(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==er)throw new Error(`Version 0 CID must use dag-pb (code: ${er}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Bi(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,er,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=kt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new Ie(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[l,d]=Xe(t.subarray(r));return r+=d,l},o=n(),s=er;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,f=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(t,r){let[n,o]=Wf(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return uo(s).set(n,t),s}};function Wf(e,t){switch(e[0]){case"Q":{let r=t??Q;return[Q.prefix,r.decode(`${Q.prefix}${e}`)]}case Q.prefix:{let r=t??Q;return[Q.prefix,r.decode(e)]}case Xt.prefix:{let r=t??Xt;return[Xt.prefix,r.decode(e)]}case ue.prefix:{let r=t??ue;return[ue.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Yf(e,t,r){let{prefix:n}=r;if(n!==Q.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function jf(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var er=112,Zf=18;function Bi(e,t,r){let n=Ce(e),o=n+Ce(t),s=new Uint8Array(o+r.byteLength);return Te(e,s,0),Te(t,s,n),s.set(r,o),s}var Xf=Symbol.for("@ipld/js-cid/CID");var rr={...oo,...Zn,...no,...Yn,...jn,...Qn,...Jn,...to,...ro,...Xn},Jp={...co,...io};function Kt(e=0){return new Uint8Array(e)}function gt(e=0){return new Uint8Array(e)}function Di(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Li=Di("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),fo=Di("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=gt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Qf={utf8:Li,"utf-8":Li,hex:rr.base16,latin1:fo,ascii:fo,binary:fo,...rr},kr=Qf;function U(e,t="utf8"){let r=kr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}function T(e){if(e!==void 0&&e!==T.REQUEST&&e!==T.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");e===void 0||this.initialize(e),this.maxHeaderSize=T.maxHeaderSize}T.prototype.initialize=function(e,t){if(e!==T.REQUEST&&e!==T.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};T.encoding="ascii";T.maxHeaderSize=80*1024;T.REQUEST="REQUEST";T.RESPONSE="RESPONSE";var Pi=T.kOnHeaders=1,lo=T.kOnHeadersComplete=2,Kr=T.kOnBody=3,ho=T.kOnMessageComplete=4;T.prototype[Pi]=T.prototype[lo]=T.prototype[Kr]=T.prototype[ho]=function(){};var Ui=!0;Object.defineProperty(T,"kOnExecute",{get:function(){return Ui=!1,99}});var Ni=T.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],ki=Ni.indexOf("CONNECT");T.prototype.reinitialize=T;T.prototype.close=T.prototype.pause=T.prototype.resume=T.prototype.remove=T.prototype.free=function(){};T.prototype._compatMode0_11=!1;T.prototype.getAsyncId=function(){return 0};var Jf={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};T.prototype.execute=function(e,t,r){if(!(this instanceof T))throw new TypeError("not a HTTPParser");t=t||0,r=typeof r=="number"?r:e.length,this.chunk=e,this.offset=t;var n=this.end=t+r;try{for(;this.offset<n&&!this[this.state](););}catch(o){if(this.isUserCall)throw o;return this.hadError=!0,o}return this.chunk=null,r=this.offset-t,Jf[this.state]&&(this.headerSize+=r,this.headerSize>(this.maxHeaderSize||T.maxHeaderSize))?new Error("max header size exceeded"):r};var tl={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};T.prototype.finish=function(){if(!this.hadError){if(!tl[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[ho]())}};T.prototype.consume=T.prototype.unconsume=T.prototype.getCurrentBuffer=function(){};T.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}};T.prototype.nextRequest=function(){this.userCall()(this[ho]()),this.reinitialize(this.type)};T.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,r=this.offset;r<e;r++)if(t[r]===10){var n=this.line+U(t.subarray(this.offset,r),T.encoding);return n.charAt(n.length-1)==="\r"&&(n=n.substr(0,n.length-1)),this.line="",this.offset=r+1,n}this.line+=U(t.subarray(this.offset,this.end),T.encoding),this.offset=this.end};var el=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,rl=/^[ \t]+(.*[^ \t])/;T.prototype.parseHeader=function(e,t){if(e.indexOf("\r")!==-1)throw Hr("HPE_LF_EXPECTED");var r=el.exec(e),n=r&&r[1];if(n)t.push(n),t.push(r[2]);else{var o=rl.exec(e);o&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=o[1])}};var nl=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;T.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=nl.exec(e);if(t===null)throw Hr("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:Ni.indexOf(t[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var ol=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;T.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=ol.exec(e);if(t===null)throw Hr("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var r=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((r/100|0)===1||r===204||r===304)&&(this.body_bytes=0),this.state="HEADER"}};T.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};T.prototype.HEADER=function(){var e=this.consumeLine();if(e!==void 0){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var r=t.headers,n=!1,o,s=!1,i=0;i<r.length;i+=2)switch(r[i].toLowerCase()){case"transfer-encoding":this.isChunked=r[i+1].toLowerCase()==="chunked";break;case"content-length":if(o=+r[i+1],n){if(o!==this.body_bytes)throw Hr("HPE_UNEXPECTED_CONTENT_LENGTH")}else n=!0,this.body_bytes=o;break;case"connection":this.connection+=r[i+1].toLowerCase();break;case"upgrade":s=!0;break}this.isChunked&&n&&(n=!1,this.body_bytes=null),s&&this.connection.indexOf("upgrade")!=-1?t.upgrade=this.type===T.REQUEST||t.statusCode===101:t.upgrade=t.method===ki,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive();var a;if(Ui?a=this.userCall()(this[lo](t)):a=this.userCall()(this[lo](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),t.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};T.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();e!==void 0&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};T.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Kr](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};T.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();if(e!==void 0){if(e!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};T.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();e!==void 0&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[Pi](this.trailers,"")),this.nextRequest()))};T.prototype.BODY_RAW=function(){this.userCall()(this[Kr](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};T.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[Kr](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=T["kOn"+e];Object.defineProperty(T.prototype,"on"+e,{get:function(){return this[t]},set:function(r){return this._compatMode0_11=!0,ki="CONNECT",this[t]=r}})});function Hr(e){var t=new Error("Parse Error");return t.code=e,t}var V=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Re=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var nr=class extends Error{static name="UnsupportedOperationError";constructor(t="Unsupported operation"){super(t),this.name="UnsupportedOperationError"}};var Mr=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},$r=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}};var ot=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}},or=class extends Error{static name="ProtocolError";constructor(t="Protocol error"){super(t),this.name="ProtocolError"}};var fe=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var qr=Symbol.for("@libp2p/peer-id");function Ki(e){return!!e?.[qr]}function Hi(e){return e!=null&&typeof e.start=="function"&&typeof e.stop=="function"}async function Mi(...e){let t=[];for(let r of e)Hi(r)&&t.push(r);await Promise.all(t.map(async r=>{r.beforeStart!=null&&await r.beforeStart()})),await Promise.all(t.map(async r=>{await r.start()})),await Promise.all(t.map(async r=>{r.afterStart!=null&&await r.afterStart()}))}async function $i(...e){let t=[];for(let r of e)Hi(r)&&t.push(r);await Promise.all(t.map(async r=>{r.beforeStop!=null&&await r.beforeStop()})),await Promise.all(t.map(async r=>{await r.stop()})),await Promise.all(t.map(async r=>{r.afterStop!=null&&await r.afterStop()}))}var Vr=class extends EventTarget{#t=new Map;constructor(){super()}listenerCount(t){let r=this.#t.get(t);return r==null?0:r.length}addEventListener(t,r,n){super.addEventListener(t,r,n);let o=this.#t.get(t);o==null&&(o=[],this.#t.set(t,o)),o.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(t,r,n){super.removeEventListener(t.toString(),r??null,n);let o=this.#t.get(t);o!=null&&(o=o.filter(({callback:s})=>s!==r),this.#t.set(t,o))}dispatchEvent(t){let r=super.dispatchEvent(t),n=this.#t.get(t.type);return n==null||(n=n.filter(({once:o})=>!o),this.#t.set(t.type,n)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}};var qi=Symbol.for("@libp2p/service-capabilities"),d0=Symbol.for("@libp2p/service-dependencies");function ut(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Bt(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=gt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var zi=Symbol.for("@achingbrain/uint8arraylist");function Vi(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function zr(e){return!!e?.[zi]}var J=class e{bufs;length;[zi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(zr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(zr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Vi(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Vi(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(zr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Bt(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Bt(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let u=t>=a&&t<c,f=r>a&&r<=c;if(u&&f){if(t===a&&r===c){n.push(i);break}let l=t-a;n.push(i.subarray(l,l+(r-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!zr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let l=r;l<=c;l+=f){f=0;for(let d=u;d>=0;d--){let x=this.get(l+d);if(n[d]!==x){f=Math.max(1,d-a[x]);break}}if(f===0)return l}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=gt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=Kt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=Kt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=Kt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=gt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=Kt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=Kt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=Kt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=Kt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=Kt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ut(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};function R(e,t="utf8"){let r=kr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}var il=parseInt("11111",2),po=parseInt("10000000",2),al=parseInt("01111111",2),Fi={0:sr,1:sr,2:cl,3:ll,4:hl,5:fl,6:ul,16:sr,22:sr,48:sr};function Ht(e,t={offset:0}){let r=e[t.offset]&il;if(t.offset++,Fi[r]!=null)return Fi[r](e,t);throw new Error("No decoder for tag "+r)}function ir(e,t){let r=0;if((e[t.offset]&po)===po){let n=e[t.offset]&al,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function sr(e,t){ir(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=Ht(e,t);if(n===null)break;r.push(n)}return r}function cl(e,t){let r=ir(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function ul(e,t){let r=ir(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let u=e[t.offset];if(t.offset++,c.push(u&127),u<128){c.reverse();let f=0;for(let l=0;l<c.length;l++)f+=c[l]<<l*7;a+=`.${f}`,c=[]}}return a}function fl(e,t){return t.offset++,null}function ll(e,t){let r=ir(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function hl(e,t){let r=ir(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function dl(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new J;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function mo(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=dl(e.byteLength);return new J(Uint8Array.from([t.byteLength|po]),t)}function bt(e){let t=new J,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new J(Uint8Array.from([2]),mo(t),t)}function Fr(e){let t=Uint8Array.from([0]),r=new J(t,e);return new J(Uint8Array.from([3]),mo(r),r)}function Qt(e,t=48){let r=new J;for(let n of e)r.append(n);return new J(Uint8Array.from([t]),mo(r),r)}async function Gi(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var pl=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),ml=Uint8Array.from([6,5,43,129,4,0,34]),yl=Uint8Array.from([6,5,43,129,4,0,35]),gl={ext:!0,kty:"EC",crv:"P-256"},bl={ext:!0,kty:"EC",crv:"P-384"},wl={ext:!0,kty:"EC",crv:"P-521"},yo=32,go=48,bo=66;function wo(e){let t=Ht(e);return Wi(t)}function Wi(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===yo*2+1)return n=U(t.subarray(r,r+yo),"base64url"),o=U(t.subarray(r+yo),"base64url"),new Oe({...gl,key_ops:["verify"],x:n,y:o});if(t.byteLength===go*2+1)return n=U(t.subarray(r,r+go),"base64url"),o=U(t.subarray(r+go),"base64url"),new Oe({...bl,key_ops:["verify"],x:n,y:o});if(t.byteLength===bo*2+1)return n=U(t.subarray(r,r+bo),"base64url"),o=U(t.subarray(r+bo),"base64url"),new Oe({...wl,key_ops:["verify"],x:n,y:o});throw new V(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function Yi(e){return Qt([bt(Uint8Array.from([1])),Qt([xl(e.crv)],160),Qt([Fr(new J(Uint8Array.from([4]),R(e.x??"","base64url"),R(e.y??"","base64url")))],161)]).subarray()}function xl(e){if(e==="P-256")return pl;if(e==="P-384")return ml;if(e==="P-521")return yl;throw new V(`Invalid curve ${e}`)}var Oe=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=Yi(this.jwk)),this._raw}toMultihash(){return vt.digest(xt(this))}toCID(){return nt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}async verify(t,r,n){return Gi(this.jwk,r,t,n)}};function le(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Lt(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function H(e,t,r=""){let n=le(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function Gr(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Lt(e.outputLen),Lt(e.blockLen)}function Be(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Zi(e,t){H(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function $t(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Wr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Tt(e,t){return e<<32-t|e>>>t}var Xi=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",El=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function qt(e){if(H(e),Xi)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=El[e[r]];return t}var Mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ji(e){if(e>=Mt._0&&e<=Mt._9)return e-Mt._0;if(e>=Mt.A&&e<=Mt.F)return e-(Mt.A-10);if(e>=Mt.a&&e<=Mt.f)return e-(Mt.a-10)}function Vt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Xi)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=ji(e.charCodeAt(s)),a=ji(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function wt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];H(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function xo(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function Le(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var Eo=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function Qi(e,t,r){return e&t^~e&r}function Ji(e,t,r){return e&t^e&r^t&r}var ar=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Wr(this.buffer)}update(t){Be(this),H(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Wr(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Be(this),Zi(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,$t(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)r[l]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let a=Wr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},zt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var ft=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var Yr=BigInt(4294967295),ta=BigInt(32);function Sl(e,t=!1){return t?{h:Number(e&Yr),l:Number(e>>ta&Yr)}:{h:Number(e>>ta&Yr)|0,l:Number(e&Yr)|0}}function ea(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=Sl(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var So=(e,t,r)=>e>>>r,Ao=(e,t,r)=>e<<32-r|t>>>r,he=(e,t,r)=>e>>>r|t<<32-r,de=(e,t,r)=>e<<32-r|t>>>r,cr=(e,t,r)=>e<<64-r|t>>>r-32,ur=(e,t,r)=>e>>>r-32|t<<64-r;function Dt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ra=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),na=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,oa=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),sa=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,ia=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),aa=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var vl=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jt=new Uint32Array(64),vo=class extends ar{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)Jt[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let d=Jt[l-15],x=Jt[l-2],p=Tt(d,7)^Tt(d,18)^d>>>3,C=Tt(x,17)^Tt(x,19)^x>>>10;Jt[l]=C+Jt[l-7]+p+Jt[l-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let d=Tt(a,6)^Tt(a,11)^Tt(a,25),x=f+d+Qi(a,c,u)+vl[l]+Jt[l]|0,C=(Tt(n,2)^Tt(n,13)^Tt(n,22))+Ji(n,o,s)|0;f=u,u=c,c=a,a=i+x|0,i=s,s=o,o=n,n=x+C|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,u,f)}roundClean(){$t(Jt)}destroy(){this.set(0,0,0,0,0,0,0,0),$t(this.buffer)}},To=class extends vo{A=zt[0]|0;B=zt[1]|0;C=zt[2]|0;D=zt[3]|0;E=zt[4]|0;F=zt[5]|0;G=zt[6]|0;H=zt[7]|0;constructor(){super(32)}};var ca=ea(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Tl=ca[0],Cl=ca[1],te=new Uint32Array(80),ee=new Uint32Array(80),Co=class extends ar{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:f,Fh:l,Fl:d,Gh:x,Gl:p,Hh:C,Hl:A}=this;return[t,r,n,o,s,i,a,c,u,f,l,d,x,p,C,A]}set(t,r,n,o,s,i,a,c,u,f,l,d,x,p,C,A){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=d|0,this.Gh=x|0,this.Gl=p|0,this.Hh=C|0,this.Hl=A|0}process(t,r){for(let b=0;b<16;b++,r+=4)te[b]=t.getUint32(r),ee[b]=t.getUint32(r+=4);for(let b=16;b<80;b++){let I=te[b-15]|0,N=ee[b-15]|0,M=he(I,N,1)^he(I,N,8)^So(I,N,7),$=de(I,N,1)^de(I,N,8)^Ao(I,N,7),E=te[b-2]|0,w=ee[b-2]|0,k=he(E,w,19)^cr(E,w,61)^So(E,w,6),q=de(E,w,19)^ur(E,w,61)^Ao(E,w,6),L=oa($,q,ee[b-7],ee[b-16]),m=sa(L,M,k,te[b-7],te[b-16]);te[b]=m|0,ee[b]=L|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:f,Eh:l,El:d,Fh:x,Fl:p,Gh:C,Gl:A,Hh:g,Hl:v}=this;for(let b=0;b<80;b++){let I=he(l,d,14)^he(l,d,18)^cr(l,d,41),N=de(l,d,14)^de(l,d,18)^ur(l,d,41),M=l&x^~l&C,$=d&p^~d&A,E=ia(v,N,$,Cl[b],ee[b]),w=aa(E,g,I,M,Tl[b],te[b]),k=E|0,q=he(n,o,28)^cr(n,o,34)^cr(n,o,39),L=de(n,o,28)^ur(n,o,34)^ur(n,o,39),m=n&s^n&a^s&a,y=o&i^o&c^i&c;g=C|0,v=A|0,C=x|0,A=p|0,x=l|0,p=d|0,{h:l,l:d}=Dt(u|0,f|0,w|0,k|0),u=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let h=ra(k,L,y);n=na(h,w,q,m),o=h|0}({h:n,l:o}=Dt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Dt(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=Dt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=Dt(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:d}=Dt(this.Eh|0,this.El|0,l|0,d|0),{h:x,l:p}=Dt(this.Fh|0,this.Fl|0,x|0,p|0),{h:C,l:A}=Dt(this.Gh|0,this.Gl|0,C|0,A|0),{h:g,l:v}=Dt(this.Hh|0,this.Hl|0,g|0,v|0),this.set(n,o,s,i,a,c,u,f,l,d,x,p,C,A,g,v)}roundClean(){$t(te,ee)}destroy(){$t(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Io=class extends Co{Ah=ft[0]|0;Al=ft[1]|0;Bh=ft[2]|0;Bl=ft[3]|0;Ch=ft[4]|0;Cl=ft[5]|0;Dh=ft[6]|0;Dl=ft[7]|0;Eh=ft[8]|0;El=ft[9]|0;Fh=ft[10]|0;Fl=ft[11]|0;Gh=ft[12]|0;Gl=ft[13]|0;Hh=ft[14]|0;Hl=ft[15]|0;constructor(){super(64)}};var De=xo(()=>new To,Eo(1));var ua=xo(()=>new Io,Eo(3));var Ro=BigInt(0),_o=BigInt(1);function Ft(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function fa(e){if(typeof e=="bigint"){if(!jr(e))throw new Error("positive bigint expected, got "+e)}else Lt(e);return e}function fr(e){let t=fa(e).toString(16);return t.length&1?"0"+t:t}function la(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Ro:BigInt("0x"+e)}function Pe(e){return la(qt(e))}function pe(e){return la(qt(Xr(H(e)).reverse()))}function Zr(e,t){Lt(t),e=fa(e);let r=Vt(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Oo(e,t){return Zr(e,t).reverse()}function Xr(e){return Uint8Array.from(e)}var jr=e=>typeof e=="bigint"&&Ro<=e;function Il(e,t,r){return jr(e)&&jr(t)&&jr(r)&&t<=e&&e<r}function lr(e,t,r,n){if(!Il(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Bo(e){let t;for(t=0;e>Ro;e>>=_o,t+=1);return t}var hr=e=>(_o<<BigInt(e))-_o;function ha(e,t,r){if(Lt(e,"hashLen"),Lt(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=A=>new Uint8Array(A),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),a=1e3,c=n(e),u=n(e),f=0,l=()=>{c.fill(1),u.fill(0),f=0},d=(...A)=>r(u,wt(c,...A)),x=(A=o)=>{u=d(s,A),c=d(),A.length!==0&&(u=d(i,A),c=d())},p=()=>{if(f++>=a)throw new Error("drbg: tried max amount of iterations");let A=0,g=[];for(;A<t;){c=d();let v=c.slice();g.push(v),A+=c.length}return wt(...g)};return(A,g)=>{l(),x(A);let v;for(;!(v=g(p()));)x();return l(),v}}function re(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,a){let c=e[s];if(a&&c===void 0)return;let u=typeof c;if(u!==i||c===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${u}`)}let o=(s,i)=>Object.entries(s).forEach(([a,c])=>n(a,c,i));o(t,!1),o(r,!0)}function Ue(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var mt=BigInt(0),st=BigInt(1),me=BigInt(2),ma=BigInt(3),ya=BigInt(4),ga=BigInt(5),_l=BigInt(7),ba=BigInt(8),Rl=BigInt(9),wa=BigInt(16);function tt(e,t){let r=e%t;return r>=mt?r:t+r}function G(e,t,r){let n=e;for(;t-- >mt;)n*=n,n%=r;return n}function da(e,t){if(e===mt)throw new Error("invert: expected non-zero number");if(t<=mt)throw new Error("invert: expected positive modulus, got "+t);let r=tt(e,t),n=t,o=mt,s=st,i=st,a=mt;for(;r!==mt;){let u=n/r,f=n%r,l=o-i*u,d=s-a*u;n=r,r=f,o=i,s=a,i=l,a=d}if(n!==st)throw new Error("invert: does not exist");return tt(o,t)}function Do(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function xa(e,t){let r=(e.ORDER+st)/ya,n=e.pow(t,r);return Do(e,n,t),n}function Ol(e,t){let r=(e.ORDER-ga)/ba,n=e.mul(t,me),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,me),o),a=e.mul(s,e.sub(i,e.ONE));return Do(e,a,t),a}function Bl(e){let t=Ne(e),r=Ea(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+_l)/wa;return(a,c)=>{let u=a.pow(c,i),f=a.mul(u,n),l=a.mul(u,o),d=a.mul(u,s),x=a.eql(a.sqr(f),c),p=a.eql(a.sqr(l),c);u=a.cmov(u,f,x),f=a.cmov(d,l,p);let C=a.eql(a.sqr(f),c),A=a.cmov(u,f,C);return Do(a,A,c),A}}function Ea(e){if(e<ma)throw new Error("sqrt is not defined for small field");let t=e-st,r=0;for(;t%me===mt;)t/=me,r++;let n=me,o=Ne(e);for(;pa(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return xa;let s=o.pow(n,t),i=(t+st)/me;return function(c,u){if(c.is0(u))return u;if(pa(c,u)!==1)throw new Error("Cannot find square root");let f=r,l=c.mul(c.ONE,s),d=c.pow(u,t),x=c.pow(u,i);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let p=1,C=c.sqr(d);for(;!c.eql(C,c.ONE);)if(p++,C=c.sqr(C),p===f)throw new Error("Cannot find square root");let A=st<<BigInt(f-p-1),g=c.pow(l,A);f=p,l=c.sqr(g),d=c.mul(d,l),x=c.mul(x,g)}return x}}function Ll(e){return e%ya===ma?xa:e%ba===ga?Ol:e%wa===Rl?Bl(e):Ea(e)}var Sa=(e,t)=>(tt(e,t)&st)===st,Dl=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Po(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=Dl.reduce((n,o)=>(n[o]="function",n),t);return re(e,r),e}function Pl(e,t,r){if(r<mt)throw new Error("invalid exponent, negatives unsupported");if(r===mt)return e.ONE;if(r===st)return t;let n=e.ONE,o=t;for(;r>mt;)r&st&&(n=e.mul(n,o)),o=e.sqr(o),r>>=st;return n}function dr(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function pa(e,t){let r=(e.ORDER-st)/me,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Ul(e,t){t!==void 0&&Lt(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var Lo=class{ORDER;BITS;BYTES;isLE;ZERO=mt;ONE=st;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=mt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=Ul(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return tt(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return mt<=t&&t<this.ORDER}is0(t){return t===mt}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&st)===st}neg(t){return tt(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return tt(t*t,this.ORDER)}add(t,r){return tt(t+r,this.ORDER)}sub(t,r){return tt(t-r,this.ORDER)}mul(t,r){return tt(t*r,this.ORDER)}pow(t,r){return Pl(this,t,r)}div(t,r){return tt(t*da(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return da(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=Ll(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Oo(t,this.BYTES):Zr(t,this.BYTES)}fromBytes(t,r=!1){H(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:a}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let u=new Uint8Array(o);u.set(t,s?0:u.length-t.length),t=u}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let c=s?pe(t):Pe(t);if(a&&(c=tt(c,i)),!r&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(t){return dr(this,t)}cmov(t,r,n){return n?r:t}};function Ne(e,t={}){return new Lo(e,t)}function Aa(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Uo(e){let t=Aa(e);return t+Math.ceil(t/2)}function No(e,t,r=!1){H(e);let n=e.length,o=Aa(t),s=Uo(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?pe(e):Pe(e),a=tt(i,t-st)+st;return r?Oo(a,o):Zr(a,o)}var ke=BigInt(0),ye=BigInt(1);function pr(e,t){let r=t.negate();return e?r:t}function ge(e,t){let r=dr(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Ia(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ko(e,t){Ia(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=hr(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function va(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=ye);let u=t*n,f=u+Math.abs(a)-1,l=a===0,d=a<0,x=t%2!==0;return{nextN:c,offset:f,isZero:l,isNeg:d,isNegF:x,offsetF:u}}var Ko=new WeakMap,_a=new WeakMap;function Ho(e){return _a.get(e)||1}function Ta(e){if(e!==ke)throw new Error("invalid wNAF")}var Ke=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>ke;)r&ye&&(n=n.add(o)),o=o.double(),r>>=ye;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=ko(r,this.bits),s=[],i=t,a=i;for(let c=0;c<n;c++){a=i,s.push(a);for(let u=1;u<o;u++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=ko(t,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:u,isZero:f,isNeg:l,isNegF:d,offsetF:x}=va(n,a,i);n=c,f?s=s.add(pr(d,r[x])):o=o.add(pr(l,r[u]))}return Ta(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=ko(t,this.bits);for(let i=0;i<s.windows&&n!==ke;i++){let{nextN:a,offset:c,isZero:u,isNeg:f}=va(n,i,s);if(n=a,!u){let l=r[c];o=o.add(f?l.negate():l)}}return Ta(n),o}getPrecomputes(t,r,n){let o=Ko.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),Ko.set(r,o))),o}cached(t,r,n){let o=Ho(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=Ho(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Ia(r,this.bits),_a.set(t,r),Ko.delete(t)}hasCache(t){return Ho(t)!==1}};function Ra(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>ke||n>ke;)r&ye&&(s=s.add(o)),n&ye&&(i=i.add(o)),o=o.double(),r>>=ye,n>>=ye;return{p1:s,p2:i}}function Ca(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Po(t),t}else return Ne(e,{isLE:r})}function Qr(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let c of["p","n","h"]){let u=t[c];if(!(typeof u=="bigint"&&u>ke))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Ca(t.p,r.Fp,n),s=Ca(t.n,r.Fn,n),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function Jr(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var ne=BigInt(0),it=BigInt(1),Mo=BigInt(2),Nl=BigInt(8);function kl(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function Oa(e,t={}){let r=Qr("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;re(t,{},{uvRatio:"function"});let a=Mo<<BigInt(o.BYTES*8)-it,c=A=>n.create(A),u=t.uvRatio||((A,g)=>{try{return{isValid:!0,value:n.sqrt(n.div(A,g))}}catch{return{isValid:!1,value:ne}}});if(!kl(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function f(A,g,v=!1){let b=v?it:ne;return lr("coordinate "+A,g,b,a),g}function l(A){if(!(A instanceof p))throw new Error("EdwardsPoint expected")}let d=Ue((A,g)=>{let{X:v,Y:b,Z:I}=A,N=A.is0();g==null&&(g=N?Nl:n.inv(I));let M=c(v*g),$=c(b*g),E=n.mul(I,g);if(N)return{x:ne,y:it};if(E!==it)throw new Error("invZ was invalid");return{x:M,y:$}}),x=Ue(A=>{let{a:g,d:v}=s;if(A.is0())throw new Error("bad point: ZERO");let{X:b,Y:I,Z:N,T:M}=A,$=c(b*b),E=c(I*I),w=c(N*N),k=c(w*w),q=c($*g),L=c(w*c(q+E)),m=c(k+c(v*c($*E)));if(L!==m)throw new Error("bad point: equation left != right (1)");let y=c(b*I),h=c(N*M);if(y!==h)throw new Error("bad point: equation left != right (2)");return!0});class p{static BASE=new p(s.Gx,s.Gy,it,c(s.Gx*s.Gy));static ZERO=new p(ne,it,it,ne);static Fp=n;static Fn=o;X;Y;Z;T;constructor(g,v,b,I){this.X=f("x",g),this.Y=f("y",v),this.Z=f("z",b,!0),this.T=f("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(g){if(g instanceof p)throw new Error("extended point not allowed");let{x:v,y:b}=g||{};return f("x",v),f("y",b),new p(v,b,it,c(v*b))}static fromBytes(g,v=!1){let b=n.BYTES,{a:I,d:N}=s;g=Xr(H(g,b,"point")),Ft(v,"zip215");let M=Xr(g),$=g[b-1];M[b-1]=$&-129;let E=pe(M),w=v?a:n.ORDER;lr("point.y",E,ne,w);let k=c(E*E),q=c(k-it),L=c(N*k-I),{isValid:m,value:y}=u(q,L);if(!m)throw new Error("bad point: invalid y coordinate");let h=(y&it)===it,S=($&128)!==0;if(!v&&y===ne&&S)throw new Error("bad point: x=0 and x_0=1");return S!==h&&(y=c(-y)),p.fromAffine({x:y,y:E})}static fromHex(g,v=!1){return p.fromBytes(Vt(g),v)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(g=8,v=!0){return C.createCache(this,g),v||this.multiply(Mo),this}assertValidity(){x(this)}equals(g){l(g);let{X:v,Y:b,Z:I}=this,{X:N,Y:M,Z:$}=g,E=c(v*$),w=c(N*I),k=c(b*$),q=c(M*I);return E===w&&k===q}is0(){return this.equals(p.ZERO)}negate(){return new p(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:g}=s,{X:v,Y:b,Z:I}=this,N=c(v*v),M=c(b*b),$=c(Mo*c(I*I)),E=c(g*N),w=v+b,k=c(c(w*w)-N-M),q=E+M,L=q-$,m=E-M,y=c(k*L),h=c(q*m),S=c(k*m),_=c(L*q);return new p(y,h,_,S)}add(g){l(g);let{a:v,d:b}=s,{X:I,Y:N,Z:M,T:$}=this,{X:E,Y:w,Z:k,T:q}=g,L=c(I*E),m=c(N*w),y=c($*b*q),h=c(M*k),S=c((I+N)*(E+w)-L-m),_=h-y,B=h+y,D=c(m-v*L),O=c(S*_),P=c(B*D),K=c(S*D),Y=c(_*B);return new p(O,P,Y,K)}subtract(g){return this.add(g.negate())}multiply(g){if(!o.isValidNot0(g))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:v,f:b}=C.cached(this,g,I=>ge(p,I));return ge(p,[v,b])[0]}multiplyUnsafe(g,v=p.ZERO){if(!o.isValid(g))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return g===ne?p.ZERO:this.is0()||g===it?this:C.unsafe(this,g,b=>ge(p,b),v)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return C.unsafe(this,s.n).is0()}toAffine(g){return d(this,g)}clearCofactor(){return i===it?this:this.multiplyUnsafe(i)}toBytes(){let{x:g,y:v}=this.toAffine(),b=n.toBytes(v);return b[b.length-1]|=g&it?128:0,b}toHex(){return qt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let C=new Ke(p,o.BITS);return p.BASE.precompute(8),p}function Ba(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');re(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,a=r.randomBytes||Le,c=r.adjustScalarBytes||(E=>E),u=r.domain||((E,w,k)=>{if(Ft(k,"phflag"),w.length||k)throw new Error("Contexts/pre-hash are not supported");return E});function f(E){return i.create(pe(E))}function l(E){let w=b.secretKey;H(E,b.secretKey,"secretKey");let k=H(t(E),2*w,"hashedSecretKey"),q=c(k.slice(0,w)),L=k.slice(w,2*w),m=f(q);return{head:q,prefix:L,scalar:m}}function d(E){let{head:w,prefix:k,scalar:q}=l(E),L=o.multiply(q),m=L.toBytes();return{head:w,prefix:k,scalar:q,point:L,pointBytes:m}}function x(E){return d(E).pointBytes}function p(E=Uint8Array.of(),...w){let k=wt(...w);return f(t(u(k,H(E,void 0,"context"),!!n)))}function C(E,w,k={}){E=H(E,void 0,"message"),n&&(E=n(E));let{prefix:q,scalar:L,pointBytes:m}=d(w),y=p(k.context,q,E),h=o.multiply(y).toBytes(),S=p(k.context,h,m,E),_=i.create(y+S*L);if(!i.isValid(_))throw new Error("sign failed: invalid s");let B=wt(h,i.toBytes(_));return H(B,b.signature,"result")}let A={zip215:!0};function g(E,w,k,q=A){let{context:L,zip215:m}=q,y=b.signature;E=H(E,y,"signature"),w=H(w,void 0,"message"),k=H(k,b.publicKey,"publicKey"),m!==void 0&&Ft(m,"zip215"),n&&(w=n(w));let h=y/2,S=E.subarray(0,h),_=pe(E.subarray(h,y)),B,D,O;try{B=e.fromBytes(k,m),D=e.fromBytes(S,m),O=o.multiplyUnsafe(_)}catch{return!1}if(!m&&B.isSmallOrder())return!1;let P=p(L,D.toBytes(),B.toBytes(),w);return D.add(B.multiplyUnsafe(P)).subtract(O).clearCofactor().is0()}let v=s.BYTES,b={secretKey:v,publicKey:v,signature:2*v,seed:v};function I(E=a(b.seed)){return H(E,b.seed,"seed")}function N(E){return le(E)&&E.length===i.BYTES}function M(E,w){try{return!!e.fromBytes(E,w)}catch{return!1}}let $={getExtendedPublicKey:d,randomSecretKey:I,isValidSecretKey:N,isValidPublicKey:M,toMontgomery(E){let{y:w}=e.fromBytes(E),k=b.publicKey,q=k===32;if(!q&&k!==57)throw new Error("only defined for 25519 and 448");let L=q?s.div(it+w,it-w):s.div(w-it,w+it);return s.toBytes(L)},toMontgomerySecret(E){let w=b.secretKey;H(E,w);let k=t(E.subarray(0,w));return c(k).subarray(0,w)}};return Object.freeze({keygen:Jr(I,x),getPublicKey:x,sign:C,verify:g,utils:$,Point:e,lengths:b})}var Kl=BigInt(1),La=BigInt(2);var Hl=BigInt(5),Ml=BigInt(8),$o=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),$l={p:$o,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Ml,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function ql(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=$o,a=e*e%s*e%s,c=G(a,La,s)*a%s,u=G(c,Kl,s)*e%s,f=G(u,Hl,s)*u%s,l=G(f,t,s)*f%s,d=G(l,r,s)*l%s,x=G(d,n,s)*d%s,p=G(x,o,s)*x%s,C=G(p,o,s)*x%s,A=G(C,t,s)*f%s;return{pow_p_5_8:G(A,La,s)*e%s,b2:a}}function Vl(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Da=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function zl(e,t){let r=$o,n=tt(t*t*t,r),o=tt(n*n*t,r),s=ql(e*o).pow_p_5_8,i=tt(e*n*s,r),a=tt(t*i*i,r),c=i,u=tt(i*Da,r),f=a===e,l=a===tt(-e,r),d=a===tt(-e*Da,r);return f&&(i=c),(l||d)&&(i=u),Sa(i,r)&&(i=tt(-i,r)),{isValid:f||l,value:i}}var Fl=Oa($l,{uvRatio:zl});function Gl(e){return Ba(Fl,ua,Object.assign({adjustScalarBytes:Vl},e))}var Pa=Gl({});var mr=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},tn=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Ua={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new tn("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var At=Ua;var en=32;var qo,Wl=(async()=>{try{return await At.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Yl(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await At.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await At.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function jl(e,t,r){return Pa.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function Na(e,t,r){return qo==null&&(qo=await Wl),qo?Yl(e,t,r):jl(e,t,r)}function rn(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var nn=class{type="Ed25519";raw;constructor(t){this.raw=Vo(t,en)}toMultihash(){return vt.digest(xt(this))}toCID(){return nt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=Na(this.raw,r,t);return rn(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function zo(e){return e=Vo(e,en),new nn(e)}function Vo(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new V(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Xl=Math.pow(2,7),Ql=Math.pow(2,14),Jl=Math.pow(2,21),Fo=Math.pow(2,28),Go=Math.pow(2,35),Wo=Math.pow(2,42),Yo=Math.pow(2,49),W=128,dt=127;function Et(e){if(e<Xl)return 1;if(e<Ql)return 2;if(e<Jl)return 3;if(e<Fo)return 4;if(e<Go)return 5;if(e<Wo)return 6;if(e<Yo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function be(e,t,r=0){switch(Et(e)){case 8:t[r++]=e&255|W,e/=128;case 7:t[r++]=e&255|W,e/=128;case 6:t[r++]=e&255|W,e/=128;case 5:t[r++]=e&255|W,e/=128;case 4:t[r++]=e&255|W,e>>>=7;case 3:t[r++]=e&255|W,e>>>=7;case 2:t[r++]=e&255|W,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function jo(e,t){let r=e[t],n=0;if(n+=r&dt,r<W||(r=e[t+1],n+=(r&dt)<<7,r<W)||(r=e[t+2],n+=(r&dt)<<14,r<W)||(r=e[t+3],n+=(r&dt)<<21,r<W)||(r=e[t+4],n+=(r&dt)*Fo,r<W)||(r=e[t+5],n+=(r&dt)*Go,r<W)||(r=e[t+6],n+=(r&dt)*Wo,r<W)||(r=e[t+7],n+=(r&dt)*Yo,r<W))return n;throw new RangeError("Could not decode varint")}function th(e,t){let r=e.get(t),n=0;if(n+=r&dt,r<W||(r=e.get(t+1),n+=(r&dt)<<7,r<W)||(r=e.get(t+2),n+=(r&dt)<<14,r<W)||(r=e.get(t+3),n+=(r&dt)<<21,r<W)||(r=e.get(t+4),n+=(r&dt)*Fo,r<W)||(r=e.get(t+5),n+=(r&dt)*Go,r<W)||(r=e.get(t+6),n+=(r&dt)*Wo,r<W)||(r=e.get(t+7),n+=(r&dt)*Yo,r<W))return n;throw new RangeError("Could not decode varint")}function Zo(e,t=0){return e instanceof Uint8Array?jo(e,t):th(e,t)}var Xo=new Float32Array([-0]),oe=new Uint8Array(Xo.buffer);function Ha(e,t,r){Xo[0]=e,t[r]=oe[0],t[r+1]=oe[1],t[r+2]=oe[2],t[r+3]=oe[3]}function Ma(e,t){return oe[0]=e[t],oe[1]=e[t+1],oe[2]=e[t+2],oe[3]=e[t+3],Xo[0]}var Qo=new Float64Array([-0]),pt=new Uint8Array(Qo.buffer);function $a(e,t,r){Qo[0]=e,t[r]=pt[0],t[r+1]=pt[1],t[r+2]=pt[2],t[r+3]=pt[3],t[r+4]=pt[4],t[r+5]=pt[5],t[r+6]=pt[6],t[r+7]=pt[7]}function qa(e,t){return pt[0]=e[t],pt[1]=e[t+1],pt[2]=e[t+2],pt[3]=e[t+3],pt[4]=e[t+4],pt[5]=e[t+5],pt[6]=e[t+6],pt[7]=e[t+7],Qo[0]}var eh=BigInt(Number.MAX_SAFE_INTEGER),rh=BigInt(Number.MIN_SAFE_INTEGER),St=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return we;if(t<eh&&t>rh)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>Va&&(o=0n,++n>Va&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return we;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):we}},we=new St(0,0);we.toBigInt=function(){return 0n};we.zzEncode=we.zzDecode=function(){return this};we.length=function(){return 1};var Va=4294967296n;function za(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Fa(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Jo(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Ct(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function on(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var ts=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ct(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Ct(this,4);return on(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ct(this,4);return on(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Ct(this,4);let t=Ma(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Ct(this,4);let t=qa(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Ct(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return Fa(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Ct(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Ct(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new St(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Ct(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Ct(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ct(this,8);let t=on(this.buf,this.pos+=4),r=on(this.buf,this.pos+=4);return new St(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=jo(this.buf,this.pos);return this.pos+=Et(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function es(e){return new ts(e instanceof Uint8Array?e:e.subarray())}function sn(e,t,r){let n=es(e);return t.decode(n,void 0,r)}function rs(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return gt(i);o+i>t&&(n=gt(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var xe=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function ns(){}var ss=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},nh=rs();function oh(e){return globalThis.Buffer!=null?gt(e):nh(e)}var gr=class{len;head;tail;states;constructor(){this.len=0,this.head=new xe(ns,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new xe(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new is((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(an,10,St.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=St.fromBigInt(t);return this._push(an,r.length(),r)}uint64Number(t){return this._push(be,Et(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=St.fromBigInt(t).zzEncode();return this._push(an,r.length(),r)}sint64Number(t){let r=St.fromNumber(t).zzEncode();return this._push(an,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(os,1,t?1:0)}fixed32(t){return this._push(yr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=St.fromBigInt(t);return this._push(yr,4,r.lo)._push(yr,4,r.hi)}fixed64Number(t){let r=St.fromNumber(t);return this._push(yr,4,r.lo)._push(yr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Ha,4,t)}double(t){return this._push($a,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(os,1,0):this.uint32(r)._push(ih,r,t)}string(t){let r=za(t);return r!==0?this.uint32(r)._push(Jo,r,t):this._push(os,1,0)}fork(){return this.states=new ss(this),this.head=this.tail=new xe(ns,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new xe(ns,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=oh(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function os(e,t,r){t[r]=e&255}function sh(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var is=class extends xe{next;constructor(t,r){super(sh,t,r),this.next=void 0}};function an(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function yr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function ih(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(gr.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(ah,t,e),this},gr.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(ch,t,e),this});function ah(e,t,r){t.set(e,r)}function ch(e,t,r){e.length<40?Jo(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(R(e),r)}function as(){return new gr}function cn(e,t){let r=as();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var He;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(He||(He={}));function un(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function cs(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return un("enum",He.VARINT,r,n)}function fn(e,t){return un("message",He.LENGTH_DELIMITED,e,t)}var et;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(et||(et={}));var us;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(us||(us={}));(function(e){e.codec=()=>cs(us)})(et||(et={}));var Pt;(function(e){let t;e.codec=()=>(t==null&&(t=fn((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),et.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=et.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>cn(r,e.codec()),e.decode=(r,n)=>sn(r,e.codec(),n)})(Pt||(Pt={}));var fs;(function(e){let t;e.codec=()=>(t==null&&(t=fn((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),et.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=et.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>cn(r,e.codec()),e.decode=(r,n)=>sn(r,e.codec(),n)})(fs||(fs={}));var wr={};yt(wr,{MAX_RSA_KEY_SIZE:()=>ls,generateRSAKeyPair:()=>Xa,jwkToJWKKeyPair:()=>Qa,jwkToPkcs1:()=>hh,jwkToPkix:()=>ms,jwkToRSAPrivateKey:()=>ws,pkcs1MessageToJwk:()=>ds,pkcs1MessageToRSAPrivateKey:()=>ys,pkcs1ToJwk:()=>lh,pkcs1ToRSAPrivateKey:()=>Za,pkixMessageToJwk:()=>ps,pkixMessageToRSAPublicKey:()=>bs,pkixToJwk:()=>dh,pkixToRSAPublicKey:()=>gs});var Me=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=wr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return nt.createV1(114,this._multihash)}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){return ja(this.jwk,r,t,n)}},br=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=wr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}sign(t,r){return Ya(this.jwk,t,r)}};var ls=8192,hs=18,uh=1062,fh=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function lh(e){let t=Ht(e);return ds(t)}function ds(e){return{n:U(e[1],"base64url"),e:U(e[2],"base64url"),d:U(e[3],"base64url"),p:U(e[4],"base64url"),q:U(e[5],"base64url"),dp:U(e[6],"base64url"),dq:U(e[7],"base64url"),qi:U(e[8],"base64url"),kty:"RSA"}}function hh(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new V("JWK was missing components");return Qt([bt(Uint8Array.from([0])),bt(R(e.n,"base64url")),bt(R(e.e,"base64url")),bt(R(e.d,"base64url")),bt(R(e.p,"base64url")),bt(R(e.q,"base64url")),bt(R(e.dp,"base64url")),bt(R(e.dq,"base64url")),bt(R(e.qi,"base64url"))]).subarray()}function dh(e){let t=Ht(e,{offset:0});return ps(t)}function ps(e){let t=Ht(e[1],{offset:0});return{kty:"RSA",n:U(t[0],"base64url"),e:U(t[1],"base64url")}}function ms(e){if(e.n==null||e.e==null)throw new V("JWK was missing components");return Qt([fh,Fr(Qt([bt(R(e.n,"base64url")),bt(R(e.e,"base64url"))]))]).subarray()}function Za(e){let t=Ht(e);return ys(t)}function ys(e){let t=ds(e);return ws(t)}function gs(e,t){if(e.byteLength>=uh)throw new Re("Key size is too large");let r=Ht(e,{offset:0});return bs(r,e,t)}function bs(e,t,r){let n=ps(e);if(r==null){let o=De(Pt.encode({Type:et.RSA,Data:t}));r=Ot(hs,o)}return new Me(n,r)}function ws(e){if(tc(e)>ls)throw new V("Key size is too large");let t=Qa(e),r=De(Pt.encode({Type:et.RSA,Data:ms(t.publicKey)})),n=Ot(hs,r);return new br(t.privateKey,new Me(t.publicKey,n))}async function Xa(e){if(e>ls)throw new V("Key size is too large");let t=await Ja(e),r=De(Pt.encode({Type:et.RSA,Data:ms(t.publicKey)})),n=Ot(hs,r);return new br(t.privateKey,new Me(t.publicKey,n))}function Qa(e){if(e==null)throw new V("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function Ja(e,t){let r=await At.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await ph(r,t);return{privateKey:n[0],publicKey:n[1]}}async function Ya(e,t,r){let n=await At.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await At.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function ja(e,t,r,n){let o=await At.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await At.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function ph(e,t){if(e.privateKey==null||e.publicKey==null)throw new V("Private and public key are required");let r=await Promise.all([At.get().subtle.exportKey("jwk",e.privateKey),At.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function tc(e){if(e.kty!=="RSA")throw new V("invalid key type");if(e.n==null)throw new V("invalid key modulus");return R(e.n,"base64url").length*8}var ln=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(Gr(t),H(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),$t(o)}update(t){return Be(this),this.iHash.update(t),this}digestInto(t){Be(this),H(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},xs=(e,t,r)=>new ln(e,t).update(r).digest();xs.create=(e,t)=>new ln(e,t);var ec=(e,t)=>(e+(e>=0?t:-t)/rc)/t;function mh(e,t,r){let[[n,o],[s,i]]=t,a=ec(i*e,r),c=ec(-o*e,r),u=e-a*n-c*s,f=-a*o-c*i,l=u<Gt,d=f<Gt;l&&(u=-u),d&&(f=-f);let x=hr(Math.ceil(Bo(r)/2))+$e;if(u<Gt||u>=x||f<Gt||f>=x)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:l,k1:u,k2neg:d,k2:f}}function Ss(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Es(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return Ft(r.lowS,"lowS"),Ft(r.prehash,"prehash"),r.format!==void 0&&Ss(r.format),r}var As=class extends Error{constructor(t=""){super(t)}},se={Err:As,_tlv:{encode:(e,t)=>{let{Err:r}=se;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=fr(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?fr(o.length/2|128):"";return fr(e)+s+o+t},decode(e,t){let{Err:r}=se,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let f of u)i=i<<8|f;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=se;if(e<Gt)throw new t("integer: negative integers are not allowed");let r=fr(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=se;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Pe(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=se,o=H(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:u,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(e){let{_tlv:t,_int:r}=se,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Gt=BigInt(0),$e=BigInt(1),rc=BigInt(2),hn=BigInt(3),yh=BigInt(4);function nc(e,t={}){let r=Qr("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:a}=s;re(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:c}=t;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=sc(n,o);function f(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function l(L,m,y){let{x:h,y:S}=m.toAffine(),_=n.toBytes(h);if(Ft(y,"isCompressed"),y){f();let B=!n.isOdd(S);return wt(oc(B),_)}else return wt(Uint8Array.of(4),_,n.toBytes(S))}function d(L){H(L,void 0,"Point");let{publicKey:m,publicKeyUncompressed:y}=u,h=L.length,S=L[0],_=L.subarray(1);if(h===m&&(S===2||S===3)){let B=n.fromBytes(_);if(!n.isValid(B))throw new Error("bad point: is not on curve, wrong x");let D=C(B),O;try{O=n.sqrt(D)}catch(Y){let F=Y instanceof Error?": "+Y.message:"";throw new Error("bad point: is not on curve, sqrt error"+F)}f();let P=n.isOdd(O);return(S&1)===1!==P&&(O=n.neg(O)),{x:B,y:O}}else if(h===y&&S===4){let B=n.BYTES,D=n.fromBytes(_.subarray(0,B)),O=n.fromBytes(_.subarray(B,B*2));if(!A(D,O))throw new Error("bad point: is not on curve");return{x:D,y:O}}else throw new Error(`bad point: got length ${h}, expected compressed=${m} or uncompressed=${y}`)}let x=t.toBytes||l,p=t.fromBytes||d;function C(L){let m=n.sqr(L),y=n.mul(m,L);return n.add(n.add(y,n.mul(L,s.a)),s.b)}function A(L,m){let y=n.sqr(m),h=C(L);return n.eql(y,h)}if(!A(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let g=n.mul(n.pow(s.a,hn),yh),v=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(g,v)))throw new Error("bad curve params: a or b");function b(L,m,y=!1){if(!n.isValid(m)||y&&n.is0(m))throw new Error(`bad point coordinate ${L}`);return m}function I(L){if(!(L instanceof w))throw new Error("Weierstrass Point expected")}function N(L){if(!c||!c.basises)throw new Error("no endo");return mh(L,c.basises,o.ORDER)}let M=Ue((L,m)=>{let{X:y,Y:h,Z:S}=L;if(n.eql(S,n.ONE))return{x:y,y:h};let _=L.is0();m==null&&(m=_?n.ONE:n.inv(S));let B=n.mul(y,m),D=n.mul(h,m),O=n.mul(S,m);if(_)return{x:n.ZERO,y:n.ZERO};if(!n.eql(O,n.ONE))throw new Error("invZ was invalid");return{x:B,y:D}}),$=Ue(L=>{if(L.is0()){if(t.allowInfinityPoint&&!n.is0(L.Y))return;throw new Error("bad point: ZERO")}let{x:m,y}=L.toAffine();if(!n.isValid(m)||!n.isValid(y))throw new Error("bad point: x or y not field elements");if(!A(m,y))throw new Error("bad point: equation left != right");if(!L.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function E(L,m,y,h,S){return y=new w(n.mul(y.X,L),y.Y,y.Z),m=pr(h,m),y=pr(S,y),m.add(y)}class w{static BASE=new w(s.Gx,s.Gy,n.ONE);static ZERO=new w(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(m,y,h){this.X=b("x",m),this.Y=b("y",y,!0),this.Z=b("z",h),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){let{x:y,y:h}=m||{};if(!m||!n.isValid(y)||!n.isValid(h))throw new Error("invalid affine point");if(m instanceof w)throw new Error("projective point not allowed");return n.is0(y)&&n.is0(h)?w.ZERO:new w(y,h,n.ONE)}static fromBytes(m){let y=w.fromAffine(p(H(m,void 0,"point")));return y.assertValidity(),y}static fromHex(m){return w.fromBytes(Vt(m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,y=!0){return q.createCache(this,m),y||this.multiply(hn),this}assertValidity(){$(this)}hasEvenY(){let{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){I(m);let{X:y,Y:h,Z:S}=this,{X:_,Y:B,Z:D}=m,O=n.eql(n.mul(y,D),n.mul(_,S)),P=n.eql(n.mul(h,D),n.mul(B,S));return O&&P}negate(){return new w(this.X,n.neg(this.Y),this.Z)}double(){let{a:m,b:y}=s,h=n.mul(y,hn),{X:S,Y:_,Z:B}=this,D=n.ZERO,O=n.ZERO,P=n.ZERO,K=n.mul(S,S),Y=n.mul(_,_),F=n.mul(B,B),z=n.mul(S,_);return z=n.add(z,z),P=n.mul(S,B),P=n.add(P,P),D=n.mul(m,P),O=n.mul(h,F),O=n.add(D,O),D=n.sub(Y,O),O=n.add(Y,O),O=n.mul(D,O),D=n.mul(z,D),P=n.mul(h,P),F=n.mul(m,F),z=n.sub(K,F),z=n.mul(m,z),z=n.add(z,P),P=n.add(K,K),K=n.add(P,K),K=n.add(K,F),K=n.mul(K,z),O=n.add(O,K),F=n.mul(_,B),F=n.add(F,F),K=n.mul(F,z),D=n.sub(D,K),P=n.mul(F,Y),P=n.add(P,P),P=n.add(P,P),new w(D,O,P)}add(m){I(m);let{X:y,Y:h,Z:S}=this,{X:_,Y:B,Z:D}=m,O=n.ZERO,P=n.ZERO,K=n.ZERO,Y=s.a,F=n.mul(s.b,hn),z=n.mul(y,_),j=n.mul(h,B),ct=n.mul(S,D),Rt=n.add(y,h),Z=n.add(_,B);Rt=n.mul(Rt,Z),Z=n.add(z,j),Rt=n.sub(Rt,Z),Z=n.add(y,S);let ht=n.add(_,D);return Z=n.mul(Z,ht),ht=n.add(z,ct),Z=n.sub(Z,ht),ht=n.add(h,S),O=n.add(B,D),ht=n.mul(ht,O),O=n.add(j,ct),ht=n.sub(ht,O),K=n.mul(Y,Z),O=n.mul(F,ct),K=n.add(O,K),O=n.sub(j,K),K=n.add(j,K),P=n.mul(O,K),j=n.add(z,z),j=n.add(j,z),ct=n.mul(Y,ct),Z=n.mul(F,Z),j=n.add(j,ct),ct=n.sub(z,ct),ct=n.mul(Y,ct),Z=n.add(Z,ct),z=n.mul(j,Z),P=n.add(P,z),z=n.mul(ht,Z),O=n.mul(Rt,O),O=n.sub(O,z),z=n.mul(Rt,j),K=n.mul(ht,K),K=n.add(K,z),new w(O,P,K)}subtract(m){return this.add(m.negate())}is0(){return this.equals(w.ZERO)}multiply(m){let{endo:y}=t;if(!o.isValidNot0(m))throw new Error("invalid scalar: out of range");let h,S,_=B=>q.cached(this,B,D=>ge(w,D));if(y){let{k1neg:B,k1:D,k2neg:O,k2:P}=N(m),{p:K,f:Y}=_(D),{p:F,f:z}=_(P);S=Y.add(z),h=E(y.beta,K,F,B,O)}else{let{p:B,f:D}=_(m);h=B,S=D}return ge(w,[h,S])[0]}multiplyUnsafe(m){let{endo:y}=t,h=this;if(!o.isValid(m))throw new Error("invalid scalar: out of range");if(m===Gt||h.is0())return w.ZERO;if(m===$e)return h;if(q.hasCache(this))return this.multiply(m);if(y){let{k1neg:S,k1:_,k2neg:B,k2:D}=N(m),{p1:O,p2:P}=Ra(w,h,_,D);return E(y.beta,O,P,S,B)}else return q.unsafe(h,m)}toAffine(m){return M(this,m)}isTorsionFree(){let{isTorsionFree:m}=t;return i===$e?!0:m?m(w,this):q.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:m}=t;return i===$e?this:m?m(w,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(m=!0){return Ft(m,"isCompressed"),this.assertValidity(),x(w,this,m)}toHex(m=!0){return qt(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let k=o.BITS,q=new Ke(w,t.endo?Math.ceil(k/2):k);return w.BASE.precompute(8),w}function oc(e){return Uint8Array.of(e?2:3)}function sc(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function gh(e,t={}){let{Fn:r}=e,n=t.randomBytes||Le,o=Object.assign(sc(e.Fp,r),{seed:Uo(r.ORDER)});function s(x){try{let p=r.fromBytes(x);return r.isValidNot0(p)}catch{return!1}}function i(x,p){let{publicKey:C,publicKeyUncompressed:A}=o;try{let g=x.length;return p===!0&&g!==C||p===!1&&g!==A?!1:!!e.fromBytes(x)}catch{return!1}}function a(x=n(o.seed)){return No(H(x,o.seed,"seed"),r.ORDER)}function c(x,p=!0){return e.BASE.multiply(r.fromBytes(x)).toBytes(p)}function u(x){let{secretKey:p,publicKey:C,publicKeyUncompressed:A}=o;if(!le(x)||"_lengths"in r&&r._lengths||p===C)return;let g=H(x,void 0,"key").length;return g===C||g===A}function f(x,p,C=!0){if(u(x)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");let A=r.fromBytes(x);return e.fromBytes(p).multiply(A).toBytes(C)}let l={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:a},d=Jr(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:f,keygen:d,Point:e,utils:l,lengths:o})}function ic(e,t,r={}){Gr(t),re(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||Le,o=r.hmac||((y,h)=>xs(t,y,h)),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i,{keygen:u,getPublicKey:f,getSharedSecret:l,utils:d,lengths:x}=gh(e,r),p={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},C=a*rc<s.ORDER;function A(y){let h=a>>$e;return y>h}function g(y,h){if(!i.isValidNot0(h))throw new Error(`invalid signature ${y}: out of range 1..Point.Fn.ORDER`);return h}function v(){if(C)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function b(y,h){Ss(h);let S=x.signature,_=h==="compact"?S:h==="recovered"?S+1:void 0;return H(y,_)}class I{r;s;recovery;constructor(h,S,_){if(this.r=g("r",h),this.s=g("s",S),_!=null){if(v(),![0,1,2,3].includes(_))throw new Error("invalid recovery id");this.recovery=_}Object.freeze(this)}static fromBytes(h,S=p.format){b(h,S);let _;if(S==="der"){let{r:P,s:K}=se.toSig(H(h));return new I(P,K)}S==="recovered"&&(_=h[0],S="compact",h=h.subarray(1));let B=x.signature/2,D=h.subarray(0,B),O=h.subarray(B,B*2);return new I(i.fromBytes(D),i.fromBytes(O),_)}static fromHex(h,S){return this.fromBytes(Vt(h),S)}assertRecovery(){let{recovery:h}=this;if(h==null)throw new Error("invalid recovery id: must be present");return h}addRecoveryBit(h){return new I(this.r,this.s,h)}recoverPublicKey(h){let{r:S,s:_}=this,B=this.assertRecovery(),D=B===2||B===3?S+a:S;if(!s.isValid(D))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let O=s.toBytes(D),P=e.fromBytes(wt(oc((B&1)===0),O)),K=i.inv(D),Y=M(H(h,void 0,"msgHash")),F=i.create(-Y*K),z=i.create(_*K),j=e.BASE.multiplyUnsafe(F).add(P.multiplyUnsafe(z));if(j.is0())throw new Error("invalid recovery: point at infinify");return j.assertValidity(),j}hasHighS(){return A(this.s)}toBytes(h=p.format){if(Ss(h),h==="der")return Vt(se.hexFromSig(this));let{r:S,s:_}=this,B=i.toBytes(S),D=i.toBytes(_);return h==="recovered"?(v(),wt(Uint8Array.of(this.assertRecovery()),B,D)):wt(B,D)}toHex(h){return qt(this.toBytes(h))}}let N=r.bits2int||function(h){if(h.length>8192)throw new Error("input is too large");let S=Pe(h),_=h.length*8-c;return _>0?S>>BigInt(_):S},M=r.bits2int_modN||function(h){return i.create(N(h))},$=hr(c);function E(y){return lr("num < 2^"+c,y,Gt,$),i.toBytes(y)}function w(y,h){return H(y,void 0,"message"),h?H(t(y),void 0,"prehashed message"):y}function k(y,h,S){let{lowS:_,prehash:B,extraEntropy:D}=Es(S,p);y=w(y,B);let O=M(y),P=i.fromBytes(h);if(!i.isValidNot0(P))throw new Error("invalid private key");let K=[E(P),E(O)];if(D!=null&&D!==!1){let j=D===!0?n(x.secretKey):D;K.push(H(j,void 0,"extraEntropy"))}let Y=wt(...K),F=O;function z(j){let ct=N(j);if(!i.isValidNot0(ct))return;let Rt=i.inv(ct),Z=e.BASE.multiply(ct).toAffine(),ht=i.create(Z.x);if(ht===Gt)return;let Pr=i.create(Rt*i.create(F+ht*P));if(Pr===Gt)return;let fi=(Z.x===ht?0:2)|Number(Z.y&$e),li=Pr;return _&&A(Pr)&&(li=i.neg(Pr),fi^=1),new I(ht,li,C?void 0:fi)}return{seed:Y,k2sig:z}}function q(y,h,S={}){let{seed:_,k2sig:B}=k(y,h,S);return ha(t.outputLen,i.BYTES,o)(_,B).toBytes(S.format)}function L(y,h,S,_={}){let{lowS:B,prehash:D,format:O}=Es(_,p);if(S=H(S,void 0,"publicKey"),h=w(h,D),!le(y)){let P=y instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+P)}b(y,O);try{let P=I.fromBytes(y,O),K=e.fromBytes(S);if(B&&P.hasHighS())return!1;let{r:Y,s:F}=P,z=M(h),j=i.inv(F),ct=i.create(z*j),Rt=i.create(Y*j),Z=e.BASE.multiplyUnsafe(ct).add(K.multiplyUnsafe(Rt));return Z.is0()?!1:i.create(Z.x)===Y}catch{return!1}}function m(y,h,S={}){let{prehash:_}=Es(S,p);return h=w(h,_),I.fromBytes(y,"recovered").recoverPublicKey(h).toBytes()}return Object.freeze({keygen:u,getPublicKey:f,getSharedSecret:l,utils:d,lengths:x,Point:e,sign:q,verify:L,recoverPublicKey:m,Signature:I,hash:t})}var Ts={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},bh={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var ac=BigInt(2);function wh(e){let t=Ts.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=G(f,r,t)*f%t,d=G(l,r,t)*f%t,x=G(d,ac,t)*u%t,p=G(x,o,t)*x%t,C=G(p,s,t)*p%t,A=G(C,a,t)*C%t,g=G(A,c,t)*A%t,v=G(g,a,t)*C%t,b=G(v,r,t)*f%t,I=G(b,i,t)*p%t,N=G(I,n,t)*u%t,M=G(N,ac,t);if(!vs.eql(vs.sqr(M),e))throw new Error("Cannot find square root");return M}var vs=Ne(Ts.p,{sqrt:wh}),xh=nc(Ts,{Fp:vs,endo:bh}),qe=ic(xh,De);function cc(e,t,r,n){let o=tr.digest(r instanceof Uint8Array?r:r.subarray());if(rn(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),qe.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new mr(String(s))});try{return n?.signal?.throwIfAborted(),qe.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new mr(String(s))}}var dn=class{type="secp256k1";raw;_key;constructor(t){this._key=fc(t),this.raw=uc(this._key)}toMultihash(){return vt.digest(xt(this))}toCID(){return nt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ut(this.raw,t.raw)}verify(t,r,n){return cc(this._key,r,t,n)}};function Cs(e){return new dn(e)}function uc(e){return qe.Point.fromBytes(e).toBytes()}function fc(e){try{return qe.Point.fromBytes(e),e}catch(t){throw new Re(String(t))}}function pn(e,t){let{Type:r,Data:n}=Pt.decode(e),o=n??new Uint8Array;switch(r){case et.RSA:return gs(o,t);case et.Ed25519:return zo(o);case et.secp256k1:return Cs(o);case et.ECDSA:return wo(o);default:throw new fe}}function lc(e){let{Type:t,Data:r}=Pt.decode(e.digest),n=r??new Uint8Array;switch(t){case et.Ed25519:return zo(n);case et.secp256k1:return Cs(n);case et.ECDSA:return wo(n);default:throw new fe}}function xt(e){return Pt.encode({Type:et[e.type],Data:e.raw})}var hc=Symbol.for("nodejs.util.inspect.custom"),Eh=114,xr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[qr]=!0;toString(){return this.string==null&&(this.string=Q.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return nt.createV1(Eh,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ut(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ut(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[hc](){return`PeerId(${this.toString()})`}},Er=class extends xr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Sr=class extends xr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Ar=class extends xr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Sh=2336,vr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=vt.digest(R(this.url))}[hc](){return`PeerId(${this.url})`}[qr]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return nt.createV1(Sh,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=U(t)),t.toString()===this.toString())}};var Ah=114,dc=2336;function mn(e,t){let r;if(e.charAt(0)==="1"||e.charAt(0)==="Q")r=Qe(Q.decode(`z${e}`));else{if(e.startsWith("k51qzi5uqu5")||e.startsWith("kzwfwjn5ji4")||e.startsWith("k2k4r8")||e.startsWith("bafz"))return vh(nt.parse(e));if(t==null)throw new V('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=Qe(t.decode(e))}return pc(r)}function yn(e){if(e.type==="Ed25519")return new Sr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new Ar({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Er({multihash:e.toCID().multihash,publicKey:e});throw new fe}function pc(e){if(Ch(e))return new Er({multihash:e});if(Th(e))try{let t=lc(e);if(t.type==="Ed25519")return new Sr({multihash:e,publicKey:t});if(t.type==="secp256k1")return new Ar({multihash:e,publicKey:t})}catch{let r=U(e.digest);return new vr(new URL(r))}throw new $r("Supplied PeerID Multihash is invalid")}function vh(e){if(e?.multihash==null||e.version==null||e.version===1&&e.code!==Ah&&e.code!==dc)throw new Mr("Supplied PeerID CID is invalid");if(e.code===dc){let t=U(e.multihash.digest);return new vr(new URL(t))}return pc(e.multihash)}function Th(e){return e.code===vt.code}function Ch(e){return e.code===tr.code}function Is(e){let t=e.getComponents(),r={},n=0;if(t[n]?.name==="ip6zone"&&(r.zone=`${t[n].value}`,n++),t[n].name==="ip4"||t[n].name==="ip6"||t[n].name==="dns"||t[n].name==="dns4"||t[n].name==="dns6"?(r.type=t[n].name,r.host=t[n].value,n++):t[n].name==="dnsaddr"&&(r.type=t[n].name,r.host=`_dnsaddr.${t[n].value}`,n++),(t[n]?.name==="tcp"||t[n]?.name==="udp")&&(r.protocol=t[n].name==="tcp"?"tcp":"udp",r.port=parseInt(`${t[n].value}`),n++),t[n]?.name==="ipcidr"&&(r.type==="ip4"?r.cidr=parseInt(`${t[n].value}`):r.type==="ip6"&&(r.cidr=`${t[n].value}`),n++),r.type==null||r.host==null)throw new V(`Multiaddr ${e} was not an IPv4, IPv6, DNS, DNS4, DNS6 or DNSADDR address`);return t[n]?.name==="tls"&&t[n+1]?.name==="sni"&&(r.sni=t[n+1].value,n+=2),r}var gn=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*o)-1;for(;;){let f=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let d=Number.parseInt(l,t);if(!Number.isNaN(d))return d});if(f===void 0)break;if(s*=t,s+=f,s>u||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&c&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[a]=t(s.subarray(0,i));return r.set(s.subarray(0,a),16-a),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Ih=45,_h=15,bn=new gn;function mc(e){if(!(e.length>_h))return bn.new(e).parseWith(()=>bn.readIPv4Addr())}function yc(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>Ih))return bn.new(e).parseWith(()=>bn.readIPv6Addr())}function wn(e){return!!mc(e)}function gc(e){return!!yc(e)}function bc(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var lt=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},Wt=class extends Error{static name="ValidationError";name="ValidationError"},xn=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},En=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};function Rs(e){return t=>U(t,e)}function Os(e){return t=>R(t,e)}function Ve(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function Ee(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function wc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=R(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ee(n);return Bt([r,o],r.length+o.length)}function xc(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=Xt.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ee(n);return Bt([r,o],r.length+o.length)}function Bs(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=U(t,"base32"),o=Ve(r);return`${n}:${o}`}var Ls=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new lt("Invalid byte value in IP address");t[n]=o}),t},Ec=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=wn(r[n]),i;s&&(i=Ls(r[n]),r[n]=U(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,U(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new lt("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},Sc=function(e){if(e.byteLength!==4)throw new lt("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},Ac=function(e){if(e.byteLength!==16)throw new lt("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new lt(`Invalid IPv6 address "${r}"`)}};function vc(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new lt(`Invalid IPv6 address "${e}"`)}}var _s=Object.values(rr).map(e=>e.decoder),Rh=(function(){let e=_s[0].or(_s[1]);return _s.slice(2).forEach(t=>e=e.or(t)),e})();function Tc(e){return Rh.decode(e)}function Cc(e){return t=>e.encoder.encode(t)}function Oh(e){if(parseInt(e).toString()!==e)throw new Wt("Value must be an integer")}function Bh(e){if(e<0)throw new Wt("Value must be a positive integer, or zero")}function Lh(e){return t=>{if(t>e)throw new Wt(`Value must be smaller than or equal to ${e}`)}}function Dh(...e){return t=>{for(let r of e)r(t)}}var Tr=Dh(Oh,Bh,Lh(65535));var at=-1,Ds=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new En(`Protocol ${t} was unknown`);return r}addProtocol(t){this.protocolsByCode.set(t.code,t),this.protocolsByName.set(t.name,t),t.aliases?.forEach(r=>{this.protocolsByName.set(r,t)})}removeProtocol(t){let r=this.protocolsByCode.get(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},Yt=new Ds,hd=[{code:4,name:"ip4",size:32,valueToBytes:Ls,bytesToValue:Sc,validate:e=>{if(!wn(e))throw new Wt(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:Ee,bytesToValue:Ve,validate:Tr},{code:273,name:"udp",size:16,valueToBytes:Ee,bytesToValue:Ve,validate:Tr},{code:33,name:"dccp",size:16,valueToBytes:Ee,bytesToValue:Ve,validate:Tr},{code:41,name:"ip6",size:128,valueToBytes:Ec,bytesToValue:Ac,stringToValue:vc,validate:e=>{if(!gc(e))throw new Wt(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:at},{code:43,name:"ipcidr",size:8,bytesToValue:Rs("base10"),valueToBytes:Os("base10")},{code:53,name:"dns",size:at},{code:54,name:"dns4",size:at},{code:55,name:"dns6",size:at},{code:56,name:"dnsaddr",size:at},{code:132,name:"sctp",size:16,valueToBytes:Ee,bytesToValue:Ve,validate:Tr},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:at,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:at,bytesToValue:Rs("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?Os("base58btc")(e):nt.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Bs,valueToBytes:wc},{code:445,name:"onion3",size:296,bytesToValue:Bs,valueToBytes:xc},{code:446,name:"garlic64",size:at},{code:447,name:"garlic32",size:at},{code:448,name:"tls"},{code:449,name:"sni",size:at},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:at,bytesToValue:Cc(eo),valueToBytes:Tc},{code:480,name:"http"},{code:481,name:"http-path",size:at,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:at}];hd.forEach(e=>{Yt.addProtocol(e)});function Ic(e){let t=[],r=0;for(;r<e.length;){let n=Zo(e,r),o=Yt.getProtocol(n),s=Et(n),i=dd(o,e,r+s),a=0;i>0&&o.size===at&&(a=Et(i));let c=s+a+i,u={code:n,name:o.name,bytes:e.subarray(r,r+c)};if(i>0){let f=r+s+a,l=e.subarray(f,f+i);u.value=o.bytesToValue?.(l)??U(l)}t.push(u),r+=c}return t}function _c(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=Yt.getProtocol(n.code),s=Et(n.code),i,a=0,c=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??R(n.value),a=i.byteLength,o.size===at&&(c=Et(a)));let u=new Uint8Array(s+c+a),f=0;be(n.code,u,f),f+=s,i!=null&&(o.size===at&&(be(a,u,f),f+=c),u.set(i,f)),n.bytes=u}r.push(n.bytes),t+=n.bytes.byteLength}return Bt(r,t)}function Rc(e){if(e.charAt(0)!=="/")throw new lt('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let a=s===e.length-1;if(i==="/"||a){let c=Yt.getProtocol(o);if(r==="protocol"){if(c.size==null||c.size===0){t.push({code:c.code,name:c.name}),n="",o="",r="protocol";continue}else if(a)throw new lt(`Component ${o} was missing value`);r="value"}else if(r==="value"){let u={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new lt(`Component ${o} was missing value`);u.value=c.stringToValue?.(n)??n}t.push(u),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new lt("Incomplete multiaddr");return t}function Oc(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=Yt.getProtocol(t.code);if(r==null)throw new lt(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function dd(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:Zo(t,r)}var pd=Symbol.for("nodejs.util.inspect.custom"),qs=Symbol.for("@multiformats/multiaddr");function md(e){if(e==null&&(e="/"),An(e))return e.getComponents();if(e instanceof Uint8Array)return Ic(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),Rc(e);if(Array.isArray(e))return e;throw new lt("Must be a string, Uint8Array, Component[], or another Multiaddr")}var Sn=class e{[qs]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=md(t),r.validate!==!1&&yd(this)}get bytes(){return this.#r==null&&(this.#r=_c(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=Oc(this.#t)),this.#e}toJSON(){return this.toString()}getComponents(){return[...this.#t.map(t=>({...t}))]}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new xn(`Address ${this.toString()} does not contain subaddress: ${r}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}equals(t){return ut(this.bytes,t.bytes)}[pd](){return`Multiaddr(${this.toString()})`}};function yd(e){e.getComponents().forEach(t=>{let r=Yt.getProtocol(t.code);t.value!=null&&r.validate?.(t.value)})}function An(e){return!!e?.[qs]}function ie(e){return new Sn(e)}var gd=[6,53,56,54,55];function Bc(e){return Pc("sni",e)?.value}function Lc(e){let t=Pc("tcp",e)?.value;return t==null?"":`:${t}`}function Pc(e,t){return t.find(r=>r.name===e)}function Dc(e){return e.some(({code:t})=>t===448)}function It(e,t){let r=Uc[e.name];if(r==null)throw new Error(`Can't interpret protocol ${e.name}`);let n=r(e,t);return e.code===41?`[${n}]`:n}var Uc={ip4:(e,t)=>e.value,ip6:(e,t)=>t.length===0?e.value:`[${e.value}]`,tcp:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return`tcp://${It(r,t)}:${e.value}`},udp:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return`udp://${It(r,t)}:${e.value}`},dnsaddr:(e,t)=>e.value,dns4:(e,t)=>e.value,dns6:(e,t)=>e.value,dns:(e,t)=>e.value,ipfs:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return`${It(r,t)}`},p2p:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return`${It(r,t)}`},http:(e,t)=>{let r=Dc(t),n=Bc(t),o=Lc(t);if(r&&n!=null)return`https://${n}${o}`;let s=r?"https://":"http://",i=t.pop();if(i==null)throw new Error("Unexpected end of multiaddr");let a=It(i,t);return a=a?.replace("tcp://",""),`${s}${a}`},"http-path":(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");let n=It(r,t),o=decodeURIComponent(e.value??"");return`${n}${o}`},tls:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return It(r,t)},sni:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");return It(r,t)},https:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");let n=It(r,t);return n=n?.replace("tcp://",""),`https://${n}`},ws:(e,t)=>{let r=Dc(t),n=Bc(t),o=Lc(t);if(r&&n!=null)return`wss://${n}${o}`;let s=r?"wss://":"ws://",i=t.pop();if(i==null)throw new Error("Unexpected end of multiaddr");let a=It(i,t);return a=a?.replace("tcp://",""),`${s}${a}`},wss:(e,t)=>{let r=t.pop();if(r==null)throw new Error("Unexpected end of multiaddr");let n=It(r,t);return n=n?.replace("tcp://",""),`wss://${n}`}};function Nc(e,t){let n=ie(e).getComponents(),o=n.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let s=Uc[o.name];if(s==null)throw new Error(`No interpreter found for ${o.name}`);let i=s(o,n)??"";return t?.assumeHttp!==!1&&gd.includes(o.code)&&(i=i.replace(/^.*:\/\//,""),o.value==="443"?i=`https://${i}`:i=`http://${i}`),(i.startsWith("http://")||i.startsWith("https://")||i.startsWith("ws://")||i.startsWith("wss://"))&&(i=new URL(i).toString(),i.endsWith("/")&&(i=i.substring(0,i.length-1))),i}var kc="[a-fA-F\\d:]",ae=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${kc})|(?<=${kc})(?=\\s|$))`:"",_t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",rt="[a-fA-F\\d]{1,4}",vn=`
(?:
(?:${rt}:){7}(?:${rt}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${rt}:){6}(?:${_t}|:${rt}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${rt}:){5}(?::${_t}|(?::${rt}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${rt}:){4}(?:(?::${rt}){0,1}:${_t}|(?::${rt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${rt}:){3}(?:(?::${rt}){0,2}:${_t}|(?::${rt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${rt}:){2}(?:(?::${rt}){0,3}:${_t}|(?::${rt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${rt}:){1}(?:(?::${rt}){0,4}:${_t}|(?::${rt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${rt}){0,5}:${_t}|(?::${rt}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),bd=new RegExp(`(?:^${_t}$)|(?:^${vn}$)`),wd=new RegExp(`^${_t}$`),xd=new RegExp(`^${vn}$`),Vs=e=>e&&e.exact?bd:new RegExp(`(?:${ae(e)}${_t}${ae(e)})|(?:${ae(e)}${vn}${ae(e)})`,"g");Vs.v4=e=>e&&e.exact?wd:new RegExp(`${ae(e)}${_t}${ae(e)}`,"g");Vs.v6=e=>e&&e.exact?xd:new RegExp(`${ae(e)}${vn}${ae(e)}`,"g");var zs=Vs;function Fs(e){let t=(...r)=>e(...r);return Object.defineProperty(t,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),t}function Kc(){return!1}var{toString:Ed}=Object.prototype;function Gs(e){return Ed.call(e)==="[object RegExp]"}var Hc={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Ws(e,t={}){if(!Gs(e))throw new TypeError("Expected a RegExp instance");let r=Object.keys(Hc).map(o=>(typeof t[o]=="boolean"?t[o]:e[o])?Hc[o]:"").join(""),n=new RegExp(t.source||e.source,r);return n.lastIndex=typeof t.lastIndex=="number"?t.lastIndex:e.lastIndex,n}function Ys(e,t,{timeout:r}={}){try{return Fs(()=>Ws(e).test(t),{timeout:r})()}catch(n){if(Kc(n))return!1;throw n}}var Sd=15,Ad=45,Mc={timeout:400};function js(e){return e.length>Ad?!1:Ys(zs.v6({exact:!0}),e,Mc)}function $c(e){return e.length>Sd?!1:Ys(zs.v4({exact:!0}),e,Mc)}var qc={http:"80",https:"443",ws:"80",wss:"443"},vd=["http","https","ws","wss"];function Vc(e,t){t=t??{};let r=t.defaultDnsType??"dns",{scheme:n,hostname:o,port:s,path:i}=Td(e),a=[Cd(o,r),Id(s,n),_d(n)];i!=null&&a.push(Rd(i));let c="/"+a.filter(u=>!!u).reduce((u,f)=>u.concat(f),[]).join("/");return ie(c)}function Td(e){let[t]=e.split(":");vd.includes(t)||(e="http"+e.substring(t.length));let{protocol:r,hostname:n,port:o,pathname:s,search:i}=new URL(e);if(o==null||o===""){let c=Od(t);c!=null&&(o=c),c==null&&r==="http:"&&(o="80")}let a;return s!=null&&s!==""&&s!=="/"&&(s.startsWith("/")&&(s=s.substring(1)),a=s),i!=null&&i!==""&&(a=a??"",a+=i),{scheme:t,hostname:n,port:o,path:a}}function Cd(e,t){if(!(e==null||e==="")){if($c(e))return["ip4",e];if(js(e))return["ip6",e];if(e[0]==="["){let r=e.substring(1,e.length-1);if(js(r))return["ip6",r]}return[t,e]}}function Id(e,t){if(!(e==null||e===""))return t==="udp"?["udp",e]:["tcp",e]}function _d(e){if(e.match(/^tcp$|^udp$/)==null)return e==="https"?["/tls/http"]:e==="wss"?["/tls/ws"]:[e]}function Rd(e){if(!(e==null||e===""))return["http-path",encodeURIComponent(e)]}function Od(e){if(!(e==null||e===""||qc[e]==null))return qc[e]}function zc(e){if(e!=null){if(typeof e[Symbol.iterator]=="function")return e[Symbol.iterator]();if(typeof e[Symbol.asyncIterator]=="function")return e[Symbol.asyncIterator]();if(typeof e.next=="function")return e}throw new Error("argument is not an iterator or iterable")}function Zs(e,t={}){let r=zc(e),n={_cancelled:!1,async start(){this._cancelled=!1},async pull(o){try{let{value:s,done:i}=await r.next();if(this._cancelled)return;if(i===!0){o.close();return}o.enqueue(s)}catch(s){o.error(s)}},cancel(){this._cancelled=!0}};return new globalThis.ReadableStream(n,t)}var Bd=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Fc=Je({name:"sha-1",code:17,encode:Bd("SHA-1")});var Tn=class extends Error{static name="AbortError";name="AbortError";constructor(t="The operation was aborted",...r){super(t,...r)}};async function Cn(e,t,r,n){let o=new Tn(n?.errorMessage);n?.errorCode!=null&&(o.code=n.errorCode);let s=n?.errorEvent??"error";return r?.aborted===!0?Promise.reject(o):new Promise((i,a)=>{function c(){Qs(r,"abort",l),Qs(e,t,u),Qs(e,s,f)}let u=d=>{try{if(n?.filter?.(d)===!1)return}catch(x){c(),a(x);return}c(),i(d)},f=d=>{if(c(),d instanceof Error){a(d);return}a(d.detail??n?.error??new Error(`The "${n?.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},l=()=>{c(),a(o)};Xs(r,"abort",l),Xs(e,t,u),Xs(e,s,f)})}function Xs(e,t,r){e!=null&&(Gc(e)?e.addEventListener(t,r):e.addListener(t,r))}function Qs(e,t,r){e!=null&&(Gc(e)?e.removeEventListener(t,r):e.removeListener(t,r))}function Gc(e){return typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"}var In=class extends globalThis.Request{constructor(t,r={}){let n=r.method??"GET",o=Ut(r),s=r.body;_n(n,o)&&(r.method="UPGRADE"),super(t,r),Object.defineProperties(this,{body:{value:s,writable:!1},method:{value:n,writable:!1},headers:{value:o,writable:!1}})}};var Wc={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var Nt=class extends globalThis.Response{constructor(t,r={}){let n=Ut(r),o=r.status??200;(o<200||o>599)&&(r.status=200),super(t,r),Object.defineProperties(this,{status:{value:o,writable:!1},statusText:{value:Wc[o],writable:!1},headers:{value:n,writable:!1}})}};var Ld=["dns","dns4","dns6","dnsaddr"];function Ir(e,t){if(e instanceof URL)return e;let r=On(e,t),{httpPath:n}=Bn(e);return new URL(`http://${r}${n}`)}function _r(e){return e instanceof Uint8Array?e:e instanceof DataView?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e,0,e.byteLength)}function jc(e,t){let r={method:e.method,headers:e.headers};if((r.method!=="GET"||e.upgrade)&&r.method!=="HEAD"){let n=t;e.upgrade||(n=Pd(t,e.headers.get("content-length"))),r.body=Zs(n),r.duplex="half"}return new In(Js(e).toString(),r)}async function Zc(e,t){if(t.send(R([`HTTP/1.1 ${e.status} ${e.statusText}`,...Rn(e.headers),"",""].join(`\r
`))),e.body==null){await t.close().catch(n=>{t.abort(n)});return}let r=e.body.getReader();for(;;){let n=await r.read();if(n.value!=null&&(t.send(n.value)||await t.onDrain()),n.done)break}await t.close().catch(n=>{t.abort(n)})}var Xc=R(["HTTP/1.1 404 Not Found","Connection: close","",""].join(`\r
`)),Dd=R(["HTTP/1.1 400 Bad Request","Connection: close","",""].join(`\r
`)),fx=R(["HTTP/1.1 500 Internal Server Error","Connection: close","",""].join(`\r
`)),lx=R(["HTTP/1.1 501 Not Implemented","Connection: close","",""].join(`\r
`));function Rn(e){let t=[];e.get("Connection")==null&&e.set("Connection","close");for(let[r,n]of e.entries())t.push(`${r}: ${n}`);return t}async function*Pd(e,t){if(t=parseInt(`${t??""}`),t==null||isNaN(t))return e;let r=0;for await(let n of e){if(r+=n.byteLength,r>t){yield n.subarray(0,r-t);return}if(yield n.subarray(),r===t)return}}function ze(e,t){if(typeof e=="string"&&(e.startsWith("/")?e=ie(e):e=new URL(e)),Ki(e)&&(e=ie(`/p2p/${e}`)),e instanceof URL&&e.protocol==="multiaddr:"&&(e=Vc(e.toString())),An(e)&&(e=[e]),Array.isArray(e)){for(let r of e)if(r.getComponents().some(({name:o})=>o==="http")){let o=Nc(r);return new URL(`${o}${t??""}`)}}return t==null?e:e instanceof URL?new URL(`${e}${t.substring(1)}`):e.map(r=>r.encapsulate(`/http-path/${encodeURIComponent(t.substring(1))}`))}function Ut(e={}){return e.headers instanceof Headers||(e.headers=new Headers(e.headers)),e.headers}function Cr(e){return e!=null&&e!==""}function On(e,t){let r,n=80,o="http:";if(e instanceof URL&&(r=e.hostname,n=parseInt(e.port,10),o=e.protocol),Cr(r)||(r=t.get("host")??void 0),!Cr(r)&&Array.isArray(e))for(let s of e){let a=s.getComponents().filter(({name:c})=>Ld.includes(c))?.[0]?.value;if(a!=null){r=a;break}}if(!Cr(r)&&Array.isArray(e))for(let s of e){let i=s.getComponents().findLast(a=>a.code===421)?.value;try{let a=Is(s);a.port!=null&&(n=a.port)}catch{}if(i!=null){r=mn(i).toCID().toString(ue);break}}if(!Cr(r)&&Array.isArray(e))for(let s of e)try{let i=Is(s);i.host!=null&&(r=i.host);break}catch{}if(Cr(r))return o==="http:"&&n!==80&&(r=`${r}:${n}`),o==="https:"&&n!==443&&(r=`${r}:${n}`),r;throw new V("Could not determine request host name - a request must have a host header, be made to a DNS or IP-based multiaddr or an http(s) URL")}function Bn(e){let t="/";return e=e.map(r=>ie(r.getComponents().filter(n=>n.name==="http-path"?(t=n.value??"/",!1):!0))),{httpPath:t,addresses:e}}function Se(e,t=["GET"]){return e==null?t:(typeof e=="string"&&(e=[e]),e.map(r=>r.toUpperCase()))}function Js(e){let t=e.url??"/";if(t.startsWith("http"))return new URL(t);let r=Ud(e);return new URL(`http://${r}${t}`)}function Ud(e){let t=e.headers?.host;if(t==null&&(t=e.headers?.Host),t==null&&typeof e.headers.get=="function"&&(t=e.headers.get("host")),t==null)throw new V("Could not read host");return t}function _n(e,t){return e==="GET"&&t.get("connection")?.toLowerCase()==="upgrade"&&t.get("upgrade")?.toLowerCase()==="websocket"}function Yc(e,t){if(e instanceof Headers)return e.get(t)??void 0;let r=e[t];return Array.isArray(r)?r.join(","):r}async function ti(e){if(Yc(e,"sec-websocket-version")!=="13")throw new or("Invalid version");let t=Yc(e,"sec-websocket-key");if(t==null)throw new or("Missing sec-websocket-key");let r=`${t}258EAFA5-E914-47DA-95CA-C5AB0DC85B11`,n=await Fc.digest(R(r)),o=je.encode(n.digest).substring(1);return new Headers({Upgrade:"websocket",Connection:"upgrade","Sec-WebSocket-Accept":o})}async function Qc(e,t){let r=new T("REQUEST"),n=new J,o;r[T.kOnHeadersComplete]=s=>{let i=new Headers;for(let a=0;a<s.headers.length;a+=2)i.set(s.headers[a].toLowerCase(),s.headers[a+1]);o={...s,headers:i,raw:n,method:T.methods[s.method]}};try{for(;;){let{data:s}=await Cn(e,"message",t?.signal),i=s.subarray(),a=r.execute(i,0,i.byteLength);if(a instanceof Error)throw a;if(n.append(i.subarray(0,a)),a<i.byteLength&&e.push(i.subarray(a)),o!=null)return o}}catch(s){e.abort(s)}finally{r.finish()}throw new Error("Failed to read header info from request")}var Ln=class extends Error{static name="InvalidResponseError";name="InvalidResponseError"};var Nd=[101,204,205,304];async function Jc(e,t,r){let n=Promise.withResolvers(),o=new TransformStream,s=o.writable.getWriter(),i=!1,a=new T("RESPONSE");a.maxHeaderSize=r.maxHeaderSize??T.maxHeaderSize,a[T.kOnHeadersComplete]=u=>{r.log("response headers complete"),i=!0;let f=new Headers;for(let x=0;x<u.headers.length;x+=2)f.append(u.headers[x],u.headers[x+1]);let l=o.readable;Nd.includes(u.statusCode)&&(o.writable.close().catch(()=>{}),o.readable.cancel().catch(()=>{}),l=null);let d=new Nt(l,{status:u.statusCode,statusText:u.statusMessage,headers:f});n.resolve(d)},a[T.kOnBody]=u=>{r.log("response read body %d bytes",u.byteLength),s.write(u).catch(f=>{n.reject(f)})},a[T.kOnMessageComplete]=()=>{r.log("response message complete"),s.close().catch(u=>{n.reject(u)})};let c=0;return e.addEventListener("message",({data:u})=>{r.log("response stream read %d bytes",u.byteLength),c+=u.byteLength;let f=a.execute(u.subarray(),0,u.byteLength);f instanceof Error&&(e.abort(f),a.finish())}),e.addEventListener("remoteCloseWrite",()=>{i||n.reject(new Ln(`Response ended before headers were received, read ${c} bytes`)),a.finish()}),n.promise}function tu(e,t){return t.set("Content-Length",`${e.size}`),t.set("Content-Type",e.type!=null&&e.type!==""?e.type:"application/octet-stream"),e.stream()}function eu(e,t){return t.set("Content-Length",`${e.byteLength}`),t.set("Content-Type","application/octet-stream"),new ReadableStream({start(r){r.enqueue(_r(e)),r.close()}})}function kd(e,t,r){let n=[`--${r}`],o=0,s=2;return typeof t=="string"?(n.push(`Content-Disposition: form-data; name="${e}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${t.length}`,""),o=t.length+s):(n.push(`Content-Disposition: form-data; name="${e}"; filename="${encodeURIComponent(t.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${t.size}`,""),o=t.size+s),R(n.join(`\r
`)).byteLength+o}function ru(e,t){let r=`-----------------------------${crypto.randomUUID()}`;t.set("Content-Type",`multipart/form-data; boundary=${r}`);let n=0;for(let[c,u]of e.entries())n+=kd(c,u,r);t.set("Content-Length",`${n}`);let o=e.entries(),s;function i(c,u,f,l){let d=[`--${l}`];typeof f=="string"?d.push(`Content-Disposition: form-data; name="${u}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${f.length}`,"",f,""):(d.push(`Content-Disposition: form-data; name="${u}"; filename="${encodeURIComponent(f.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${f.size}`,""),s=f.stream().getReader()),c.enqueue(R(d.join(`\r
`)))}async function a(c,u){if(s!=null){let d=await s.read();d.value!=null&&c.enqueue(d.value),d.done&&(c.enqueue(R(`\r
`)),s=void 0);return}let{done:f,value:l}=o.next();if(l!=null){let[d,x]=l;i(c,d,x,u)}f===!0&&c.close()}return new ReadableStream({async pull(c){await a(c,r)}})}function nu(e,t){t.set("Content-Type","application/octet-stream"),t.set("Transfer-Encoding","chunked");let r=e.getReader();return new ReadableStream({async pull(n){let{done:o,value:s}=await r.read();s!=null&&(n.enqueue(R(`${s.byteLength}\r
`)),n.enqueue(s),n.enqueue(R(`\r
`))),o&&(n.enqueue(R(`0\r
\r
`)),n.close())}})}function ei(e,t){return t.set("Content-Length",`${e.length}`),t.set("Content-Type",'text/plain; charset="UTF-8"'),new ReadableStream({start(r){r.enqueue(R(e)),r.close()}})}function ou(e,t){if(e!=null){if(typeof e=="string")return ei(e,t);if(e instanceof Blob)return tu(e,t);if(Kd(e))return eu(e,t);if(e instanceof URLSearchParams)return ei(e.toString(),t);if(e instanceof ReadableStream)return nu(e,t);if(e instanceof FormData)return ru(e,t);throw new Error("Unsupported body type")}}function Kd(e){return e==null?!1:e.byteLength!=null}async function su(e,t,r){let n=new Headers(r.headers),o=n.get("host")??t.hostname;n.set("host",o),n.get("user-agent")==null&&n.set("user-agent","libp2p/fetch");let s=ou(r.body,n),i=[`${r?.method?.toUpperCase()??"GET"} ${t.pathname??"/"} HTTP/1.1`,...Rn(n),"",""];e.send(R(i.join(`\r
`)))||await e.onDrain({signal:r.signal??void 0}),s!=null&&(r.log("request sending body"),await Hd(e,s,r))}async function Hd(e,t,r){let n=t.getReader();for(;;){let{done:o,value:s}=await n.read();if(s!=null&&(r.log("request send %d bytes",s.byteLength),e.send(s)||await e.onDrain({signal:r.signal??void 0})),o){r.log("request finished sending body");break}}}async function iu(e,t,r={}){let n=e.log.newScope("http-fetch");t=typeof t=="string"?new URL(t):t;let[o]=await Promise.all([Jc(e,t,{...r,log:n}),su(e,t,{...r,log:n})]);return await e.close({signal:r.signal??void 0}),o}var Dn=class extends Event{message;error;filename="";lineno=0;colno=0;constructor(t){super("error"),this.error=t,this.message=t.message}},Rr=class extends Event{code;reason;wasClean;constructor(t,r){super(t),this.code=r?.code??0,this.reason=r?.reason??"",this.wasClean=r?.wasClean??!0}};var Md={CONTINUATION:0,TEXT:1,BINARY:2,CONNECTION_CLOSE:8,PING:9,PONG:10},ri={0:"CONTINUATION",1:"TEXT",2:"BINARY",8:"CONNECTION_CLOSE",9:"PING",10:"PONG"};var Or={NORMAL_CLOSURE:1e3,GOING_AWAY:1001,PROTOCOL_ERROR:1002,UNSUPPORTED_DATA:1003,RESERVED:1004,NO_STATUS_RECEIVED:1005,ABNORMAL_CLOSURE:1006,INVALID_FRAME_PAYLOAD_DATA:1007,POLICY_VIOLATION:1008,MESSAGE_TOO_BIG:1009,MANDATORY_EXT:1010,INTERNAL_SERVER_ERROR:1011,TLS_HANDSHAKE:1015};function au(e){let t=0;if(e.byteLength<t+1)return;let n=e.get(t)&15;if(t++,ri[n]==null)throw new Error(`Unknown opcode: ${n}`);if(e.byteLength<t+1)return;let o=e.get(t),s=(o&128)===128,i=o&127;if(t++,i===126){if(e.byteLength<t+2)return;i=e.getUint16(t),t+=2}else if(i===127){if(e.byteLength<t+8)return;i=e.getUint32(t),t+=8}if(i===0)return e.consume(t),{type:ri[n]};let a;if(s){if(e.byteLength<t+4)return;a=e.subarray(t,t+4),t+=4}if(e.byteLength<t+i)return;let c=e.subarray(t,t+i);return t+=i,a!=null&&(c=cu(c,a)),e.consume(t),{type:ri[n],data:c}}function cu(e,t){let r=0;for(let n=0;n<e.byteLength;n++)e[n]=e[n]^t[r],r++,r===t.byteLength&&(r=0);return e}function uu(e,t,r){let o=new J(Uint8Array.from([128|Md[e]])),s=t?.byteLength??0;if(s<126)o.append(Uint8Array.from([s|(r===!0?128:0)]));else if(s<65535){let i=new J(new Uint8Array(3));i.set(0,126|(r===!0?128:0)),i.setUint16(1,s),o.append(i)}else if(s<18446744073709552e3){let i=new J(new Uint8Array(9));i.set(0,127|(r===!0?128:0)),i.setUint32(1,s),o.append(i)}else throw new Error("Payload too large");if(r===!0&&t!=null){let i=Uint8Array.from([0,0,0,0]);o.append(i),t=cu(t,i)}return t!=null&&o.append(t),o}function fu(e){if(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView)return _r(e);if(typeof e=="string")return R(e);if(e instanceof Blob)return e.arrayBuffer().then(t=>_r(t));throw new V("Unsupported data type")}async function lu(e,t){return new Promise((r,n)=>{let o=!1,s=new T("RESPONSE");s[T.kOnHeadersComplete]=i=>{o=!0;let a=[];for(let c=0;c<i.headers.length;c+=2)a.push([i.headers[c],i.headers[c+1]]);r(new Nt(null,{status:i.statusCode,statusText:i.statusMessage,headers:new Headers(a)}))},Promise.resolve().then(async()=>{for(;;){let{data:i}=await Cn(e,"message",t.signal),a=i.subarray(),c=s.execute(a,0,a.byteLength);if(c instanceof Error)throw c;if(c<a.byteLength&&e.push(a.subarray(c)),o)break}}).catch(i=>{n(i)})})}async function*hu(e,t=[],r){let n=je.encode(crypto.getRandomValues(new Uint8Array(16))).substring(1);r.set("host",e.hostname),r.set("connection","upgrade"),r.set("upgrade","websocket"),r.set("pragma","no-cache"),r.set("cache-control","no-cache"),r.set("sec-websocket-version","13"),r.set("sec-websocket-key",n),t.length>0&&r.set("sec-websocket-protocol",t.join(", ")),yield R([`GET ${e.pathname??"/"} HTTP/1.1`,...[...r.entries()].map(([o,s])=>`${o}: ${s}`),"",""].join(`\r
`))}var $d=["BINARY","TEXT","CONTINUATION"],qd=10485760;var Vd="/http/1.1",Pn=class extends Vr{binaryType="arraybuffer";bufferedAmount=0;extensions="";protocol="";readyState;url;CONNECTING=0;OPEN=1;CLOSING=2;CLOSED=3;_onclose;_onerror;_onmessage;_onopen;sentClose;isClient;buffer;maxMessageSize;_url;closeController;constructor(t,r={}){super(),this.readyState=this.CONNECTING,this.url=t.pathname,this.sentClose=!1,this.isClient=r.isClient??!0,this.buffer=new J,this.closeController=new AbortController,this.maxMessageSize=r.maxMessageSize??qd}send(t){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");let r=fu(t);bc(r)?r.then(n=>{this._send("BINARY",n)}).catch(n=>{this._errored(n)}):this._send("BINARY",r)}_send(t,r){if(this.readyState!==this.OPEN)return;let n=uu(t,r,this.isClient),o=n.byteLength;this.bufferedAmount+=o,this._write(n,s=>{this.bufferedAmount-=o,s!=null&&this._errored(s)})}close(t,r){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");this.readyState=this.CLOSING,this.sentClose=!0,this._send("CONNECTION_CLOSE")}_errored(t){this.readyState=this.CLOSED,this.dispatchEvent(new Dn(t))}set onclose(t){this._onclose=t,this.addEventListener("close",t)}get onclose(){return this._onclose??null}set onerror(t){this._onerror=t,this.addEventListener("error",t)}get onerror(){return this._onerror??null}set onmessage(t){this._onmessage=t,this.addEventListener("message",t)}get onmessage(){return this._onmessage??null}set onopen(t){this._onopen=t,this.addEventListener("open",t)}get onopen(){return this._onopen??null}_push(t){if(this.buffer.append(t),this.buffer.byteLength>this.maxMessageSize){this.close(Or.MESSAGE_TOO_BIG,"Max message size exceeded");return}for(;;){let r=au(this.buffer);if(r==null)break;if($d.includes(r.type)&&r.data!=null){let n;this.binaryType==="blob"?n=new Blob([r.data]):r.data.byteOffset===0&&r.data.byteLength===r.data.buffer.byteLength?n=r.data.buffer:(n=new ArrayBuffer(r.data.byteLength),new Uint8Array(n,0,n.byteLength).set(r.data)),this.dispatchEvent(new MessageEvent("message",{data:n,origin:this._url?.hostname}))}r.type==="PING"&&this._send("PONG",r.data),r.type==="CONNECTION_CLOSE"&&(this.sentClose||this.close(),this.closeController.abort(),this._close(void 0,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new Rr("close"))}))}}_remoteClosed(t){this.readyState=this.CLOSING,this._close(t,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new Rr("close"))})}};var Br=class extends Pn{writer;writable;constructor(t,r,n={}){if(super(new URL(t.url),{...n,isClient:!1}),t.body==null)throw new V("Request body cannot be null");this.readyState=this.OPEN,this.writable=r,this.writer=r.getWriter();let o=t.body.getReader();Promise.resolve().then(async()=>{for(this.dispatchEvent(new Event("open"));;){let{value:s,done:i}=await o.read();if(s!=null&&this._push(s),i){this._remoteClosed();break}}}).catch(s=>{this._errored(s)})}_write(t,r){this.writer?.write(t).then(()=>{r()},n=>{r(n)})}_close(t,r){t!=null?this.writable.abort(t).then(()=>{r()},()=>{r()}):this.writable.close().then(()=>{r()},()=>{r()})}},Lr=class extends Pn{stream;handshakeTimeout;drainTimeout;constructor(t,r,n,o){super(r,{...o,isClient:!0}),this.handshakeTimeout=o.handshakeTimeout??1e4,this.drainTimeout=o.drainTimeout??1e4,Promise.resolve().then(async()=>{let s=AbortSignal.timeout(this.handshakeTimeout);this.stream=await n.openStream(t,Vd,{...o,signal:s});for await(let a of hu(r,o.protocols,Ut(o)))this.stream.send(a)||await this.stream.onDrain({signal:s});let i=await lu(this.stream,{signal:s});if(i.status!==101)throw new Error("Invalid WebSocket handshake - response status "+i.status);await o.onHandshakeResponse?.(i,{signal:s}),this.protocol=i.headers.get("Sec-WebSocket-Protocol")??"",this.readyState=this.OPEN,this.dispatchEvent(new Event("open"));for await(let a of this.stream)this._push(a)}).catch(s=>{this._errored(s)})}_write(t,r){if(this.stream==null){r(new Error("WebSocket was not open"));return}this.stream.send(t)?r():this.stream.onDrain({signal:AbortSignal.timeout(this.drainTimeout)}).then(()=>{r()},n=>{r(n)})}_close(t,r){if(this.stream==null){r();return}if(t!=null){this.stream.abort(t),r();return}this.stream.close().catch(n=>{this.stream?.abort(n)}).finally(()=>{r()})}};var Ae="/http/1.1";var Fe=Symbol.for("@libp2p/http/websocket-handler");var gu=Fu(mu(),1),Nn=class{log;cookies;constructor(t,r={}){this.log=t.logger.forComponent("libp2p:http:cookies"),this.cookies=new Map}async prepareRequest(t,r){if((r.credentials??"same-origin")==="omit")return;let o=r.headers.get("origin");if(o==null||o==="null")return;let s=Ir(t,r.headers),i=(this.cookies.get(s.hostname)??[]).filter(a=>!(a.expires!=null&&a.expires<Date.now()||a.path!=null&&!s.pathname.startsWith(a.path))).map(a=>`${a.name}=${a.value}`).join("; ");i.length>0&&r.headers.set("cookie",i)}async processResponse(t,r,n){if((r.credentials??"same-origin")==="omit"){yu(n);return}let s=r.headers.get("origin");if(s==null||s==="null")return;let i=Ir(t,r.headers);for(let a of n.headers.getSetCookie()){let c=[...this.cookies.get(i.hostname)??[],...tp(gu.default.parse(a))];this.cookies.set(i.hostname,c)}yu(n)}};function yu(e){return e.headers.has("set-cookie")&&e.headers.delete("set-cookie"),e}function tp(e){let t={},r=[];return Object.entries(e).forEach(([n,o])=>{n.toLowerCase()==="domain"&&o!=null&&(t.domain=o),n.toLowerCase()==="max-age"&&o!=null&&(t.expires=Date.now()+parseInt(o,10)*1e3),!ep.includes(n.toLowerCase())&&o!=null&&r.push({name:n,value:o})}),r.map(n=>({...n,...t}))}var ep=["domain","expires","httponly","max-age","partitioned","path","samesite","secure"];var kn=class{async prepareRequest(t,r){if(r.headers.get("origin")!=null||r.mode==="no-cors")return;let n=Ir(t,r.headers);r.headers.set("origin",`${n.protocol}//${n.host}`)}};function rp(e){return typeof e.init=="function"}function ce(e,t){if(rp(e)){let r=e;return r.handler=e.init(t),delete r.init,r}return e}function Ge(e){let t=Se(e.method,["GET"]);if(e.fallback==null&&t.filter(n=>n!=="GET").length>0)throw new V("WebSocket handlers only support the GET HTTP method");let r={...e,init:n=>{let o=ce(e,n);return r[Fe]=o.handler,async s=>{if(!_n(s.method,s.headers))return e?.fallback!=null?e.fallback(s):new Nt(null,{status:400});let i=new TransformStream;try{let a=new Nt(i.readable,{status:101,headers:await ti(s.headers)}),c=new Br(s,i.writable,e);return o.handler(c),a}catch{return new Nt(null,{status:500})}}}};return r}var Dr="/.well-known/libp2p/protocols";function bu(e){return Ge({path:Dr,method:["GET"],cors:!0,handler:t=>{let r=JSON.stringify(e.getProtocolMap());t.send(r),t.close()},fallback:async t=>{let r=JSON.stringify(e.getProtocolMap());return new Response(r,{headers:{"Content-Type":"application/json","Content-Length":`${r.length}`}})}})}var Kn=class{log;components;protocols;endpoint;constructor(t,r={}){this.components=t,this.log=t.logger.forComponent("libp2p:http:registrar"),this.protocols=[],this.onStream=this.onStream.bind(this),this.endpoint=r.server,this.handle("",bu(this))}async start(){await this.components.registrar.handle(Ae,this.onStream.bind(this))}async stop(){await this.components.registrar.unhandle(Ae)}async onStream(t,r){let n=await Qc(t);if(this.canHandle(n)){this.log("handling incoming request %s %s",n.method,n.url);let o=await this.onRequest(jc(n,t));await Zc(o,t),await t.close();return}if(this.endpoint==null){this.log("cannot handle incoming request %s %s and no endpoint configured",n.method,n.url),t.send(Xc),await t.close();return}this.log("passing incoming request %s %s to endpoint",n.method,n.url),this.endpoint.inject(n,t,r).catch(o=>{this.log.error("error injecting request to endpoint - %e",o),t.abort(o)})}canHandle(t){let r=Js(t).pathname;return this.protocols.find(n=>n.route.path===r)!=null?(this.log.trace("can handle %s",r),!0):(this.log.trace("cannot handle %s",r),!1)}async onRequest(t){this.log("incoming request %s %s",t.method,t.url);let r=this.findHandler(t.url);if(r==null)return new Response(null,{status:404});let n;return r.route.method.includes(t.method)?n=await r.route.handler(t):t.method==="OPTIONS"?n=new Response(null,{status:204}):n=new Response(null,{status:405}),np(n,t,r),this.log("%s %s %d %s",t.method,t.url,n.status,n.statusText),n}onWebSocket(t){let r=this.findHandler(t.url);if(r!=null){let n=r.route[Fe];if(n!=null){n(t);return}}t.close(Or.NORMAL_CLOSURE)}findHandler(t){let r=t.startsWith("/")?t:new URL(t).pathname;this.log("search for handler on path %s",r);let n=this.protocols.find(o=>o.route.path===r);return n!=null&&this.log("found handler for HTTP protocol %s on path %s",n.protocol,t),n}handle(t,r){if(r.path=r.path??t,this.protocols.find(n=>n.protocol===t)!=null)throw new V(`HTTP protocol handler for ${t} already registered`);(r.path===""||!r.path.startsWith("/"))&&(r.path=`/${r.path}`),r.cors=r.cors??!0,r.method=Se(r.method),r=ce(r,this.components),this.protocols.push({protocol:t,route:r}),this.protocols.sort(({route:{path:n}},{route:{path:o}})=>o.length-n.length)}unhandle(t){this.protocols=this.protocols.filter(r=>r.protocol===t)}getProtocolMap(){let t={};for(let r of this.protocols)r.protocol!==""&&(t[r.protocol]={path:r.route.path});return t}};function np(e,t,r){let n=[...new Set(["OPTIONS",...r.route.method])].join(", ");r.route.cors&&(t.headers.get("Access-Control-Request-Method")!=null&&e.headers.set("access-control-allow-methods",n),t.headers.get("Access-Control-Request-Headers")!=null&&e.headers.set("access-control-allow-headers",t.headers.get("Access-Control-Request-Headers")??""),t.headers.get("Origin")!=null&&(e.headers.set("access-control-allow-origin",t.headers.get("Origin")??""),e.headers.set("vary","Origin"))),t.method==="OPTIONS"&&e.headers.set("allow",n)}async function wu(e,t,r){for(let n of t.middleware)await n.prepareRequest?.(e,t);return r()}async function xu(e,t,r){for(let n of t.middleware)await n.prepareRequest?.(e,t);return r()}async function Eu(e,t,r){for(let n of t.middleware)await n.processResponse?.(e,t,r);return r}var Hn=class{log;components;httpRegistrar;origin;cookies;constructor(t,r={}){this.components=t,this.log=t.logger.forComponent("libp2p:http"),this.httpRegistrar=new Kn(t,r),this.origin=new kn,this.cookies=new Nn(t,r)}[Symbol.toStringTag]="@libp2p/http";[qi]=["@libp2p/http"];async start(){await Mi(this.httpRegistrar)}async stop(){await $i(this.httpRegistrar)}agent(...t){throw new nr("This method is not supported in browsers")}dispatcher(...t){throw new nr("This method is not supported in browsers")}async connect(t,r={}){let n=ze(t),o=Ut(r),s={...r,headers:o,method:"GET",middleware:r.middleware?.map(i=>i(this.components))??[]};return o.set("connection","upgrade"),o.set("upgrade","websocket"),xu(n,s,async()=>{if(n instanceof URL){let c=new globalThis.WebSocket(n,r.protocols);return c.binaryType="arraybuffer",c}let{addresses:i,httpPath:a}=Bn(n);return new Lr(i,new URL(`http://${On(n,s.headers)}${decodeURIComponent(a)}`),this.components.connectionManager,s)})}async fetch(t,r={}){let n=ze(t),o={...r,headers:Ut(r),method:"GET",middleware:[this.origin,this.cookies,...r.middleware?.map(i=>i(this.components))??[]]},s=await wu(n,o,async()=>this.sendRequest(n,r));return Eu(n,o,s)}async connectProtocol(t,r,n){let o=await this.getProtocolPath(t,r,n),s=ze(t,o);return this.connect(s,n)}async fetchProtocol(t,r,n={}){let o=await this.getProtocolPath(t,r,n),s=ze(t,o);return this.fetch(s,n)}async getSupportedProtocols(t,r={}){let n=ze(t,Dr),o=await this.fetch(n,{method:"GET",headers:{Accept:"application/json"},signal:r.signal});if(o.status!==200)throw new Error(`Unexpected status code: ${o.status}`);return o.json()}async getProtocolPath(t,r,n={}){let o=await this.getSupportedProtocols(t,n);if(o[r]==null)throw new Error(`Peer does not serve protocol: ${r}`);return o[r].path}canHandle(t){return this.httpRegistrar.canHandle(t)}async onRequest(t){return this.httpRegistrar.onRequest(t)}onWebSocket(t){this.httpRegistrar.onWebSocket(t)}handle(t,r){this.httpRegistrar.handle(t,r)}unhandle(t){this.httpRegistrar.unhandle(t)}getProtocolMap(){return this.httpRegistrar.getProtocolMap()}async sendRequest(t,r){if(t instanceof URL)return this.log("making request to %s with global fetch"),globalThis.fetch(t,r);this.log("making request to %s with libp2p fetch",t);let n=On(t,Ut(r)),{addresses:o,httpPath:s}=Bn(t),a=await(await this.components.connectionManager.openConnection(o,{signal:r.signal??void 0})).newStream(Ae,{signal:r.signal??void 0});return iu(a,new URL(`http://${n}${decodeURIComponent(s)}`),r)}};var op=2048;function $n(){let e=new Uint8Array(32);return crypto.getRandomValues(e),U(e,"base64urlpad")}function We(e){let t=Object.entries(e).map(([r,n])=>`${r}="${n}"`).join(", ");return`${jt} ${t}`}async function oi(e,t,r){let n=Au(t,r);return e.sign(n)}async function Su(e,t,r,n){let o=Au(t,r);return e.verify(o,n)}var Mn=new TextEncoder;function ni([e,t]){return e.length+1+t.length}function Au(e,t){t.sort((i,a)=>i[0].localeCompare(a[0]));let r=t.reduce((i,a)=>i+Et(ni(a))+ni(a),e.length),n=new Uint8Array(r),o=0,s=Mn.encodeInto(e,n);o+=s.written;for(let[i,a]of t){let c=ni([i,a]);be(c,n,o),o+=Et(c);let u=Mn.encodeInto(i,n.subarray(o));o+=u.written,u=Mn.encodeInto("=",n.subarray(o)),o+=u.written,typeof a=="string"?(u=Mn.encodeInto(a,n.subarray(o)),o+=u.written):(n.set(a,o),o+=a.length)}return n}function vu(e){if(e.length<jt.length+1)throw new ot("Authorization header too short");if(e.length>op)throw new ot("Authorization header too long");if(!e.includes(jt))throw new ot("No peer id auth scheme found");let t=e.substring(jt.length).trim(),r={},n=/(\w[^=]+)="([^"]+)"/g,o;for(;(o=n.exec(t))!==null;)r[o[1]]=o[2];return r}async function qn(e,t){return Cu(e,t)}async function Tu(e,t){let r=await si(e,t.opaque);if(typeof r.challengeClient!="string"||typeof r.hostname!="string"||typeof r.creationTime!="number")throw new Error("Invalid opaque");return r}async function Cu(e,t){let r=JSON.stringify(t),n=R(r),o=await e.sign(n),s=JSON.stringify({val:U(n,"base64urlpad"),sig:U(o,"base64urlpad")});return U(R(s),"base64urlpad")}async function si(e,t){let{sig:r,val:n}=JSON.parse(U(R(t,"base64urlpad"))),o=R(n,"base64urlpad");if(!await e.verify(o,R(r,"base64urlpad")))throw new Error("Invalid signature");let i=U(o);return JSON.parse(i)}async function ii(e,t,r){return Cu(e,{peer:t.toString(),h:r,t:Date.now()})}function Iu(e,t,r){if(e.hostname!==t)throw new ot("Invalid hostname");if(e.challengeClient==null)throw new ot("Missing challenge-client");if(Date.now()-e.creationTime>r)throw new ot("Token expired")}function _u(e){return e==null?!1:typeof e["challenge-server"]=="string"&&typeof e["public-key"]=="string"}function Ru(e){return e==null?!1:typeof e.opaque=="string"&&typeof e.sig=="string"}function Ou(e){return e==null?!1:typeof e["challenge-server"]=="string"&&typeof e["public-key"]=="string"&&typeof e.opaque=="string"&&typeof e.sig=="string"}async function Bu(e,t,r,n){let o=await Tu(r.publicKey,e);if(Iu(o,t,n),o.clientPublicKey==null)throw new ot("Missing client public key");let s=pn(R(o.clientPublicKey,"base64urlpad")),i=yn(s);if(!await Su(s,jt,[["challenge-client",o.challengeClient],["hostname",t],["server-public-key",xt(r.publicKey)]],R(e.sig,"base64urlpad")))throw new ot("Invalid signature");return{peerId:i,info:We({bearer:await ii(r,i,t)})}}async function Lu(e,t,r){let n=pn(R(e["public-key"],"base64urlpad")),o=yn(n),s=await oi(r,jt,[["challenge-server",e["challenge-server"]],["client-public-key",xt(n)],["hostname",t]]),i=$n();return{peerId:o,authenticate:We({"challenge-client":i,"public-key":U(xt(r.publicKey),"base64urlpad"),sig:U(s,"base64urlpad"),opaque:await qn(r,{challengeClient:i,creationTime:Date.now(),hostname:t,clientPublicKey:e["public-key"]})})}}async function Du(e,t,r){let n=pn(R(e["public-key"],"base64urlpad")),o=yn(n),s=await oi(r,jt,[["challenge-server",e["challenge-server"]],["client-public-key",xt(n)],["hostname",t]]);return{peerId:o,info:We({sig:U(s,"base64urlpad"),bearer:await ii(r,o,t)})}}async function Pu(e,t,r,n){let o=await si(r.publicKey,e.bearer);if(typeof o.peer!="string"||typeof o.h!="string"||typeof o.t!="number")throw new ot("Invalid bearer token");if(o.h!==t)throw new ot("Invalid hostname");if(Date.now()-o.t>(n??ai))throw new ot("Token expired");return mn(o.peer)}var jt="libp2p-PeerID";var ai=3600*1e3;function sp(e){return e==null?!1:typeof e.bearer=="string"}async function Uu(e,t){let r=$n();return We({"challenge-client":r,"public-key":U(xt(t.publicKey),"base64urlpad"),opaque:await qn(t,{challengeClient:r,hostname:e,creationTime:Date.now()})})}async function Nu(e,t,r,n=ai){let o=vu(e);if(Ou(o))return Du(o,t,r);if(_u(o))return Lu(o,t,r);if(Ru(o))return Bu(o,t,r,n);if(sp(o))return{peerId:await Pu(o,t,r,n)};throw new ot("Client sent invalid message")}var ip=3600*1e3,Vn=class{components;log;tokenTTL;verifyHostname;requireAuth;constructor(t,r){this.components=t,this.log=t.logger.forComponent("libp2p:http:server-peer-id-auth"),this.tokenTTL=r.tokenTTL??ip,this.requireAuth=r.requireAuth??!0,this.verifyHostname=r.verifyHostname??(()=>!0)}async authenticateRequest(t,r,n){if(!await this.verifyHostname(t))return this.log.error("hostname verification failed"),{status:400};if(n==null||n==="")return r==="OPTIONS"||this.requireAuth===!1?{status:200}:this.returnChallenge(t);try{let o=await Nu(n,t,this.components.privateKey,this.tokenTTL),s=new Headers,i=200;return o.info!=null&&(s.set("authentication-info",o.info),s.set("access-control-expose-headers","authentication-info")),o.authenticate!=null&&(i=401,s.set("www-authenticate",o.authenticate),s.set("access-control-expose-headers","www-authenticate")),{status:i,headers:s,peer:o.peerId}}catch(o){if(this.log.error("failed to respond to client challenge - %e",o),o.name==="InvalidMessageError")return{status:400};if(o.name==="NotAuthenticatedError")return this.returnChallenge(t);throw o}}async returnChallenge(t){return{status:401,headers:new Headers({"www-authenticate":await Uu(t,this.components.privateKey),"access-control-expose-headers":"www-authenticate"})}}};function ap(e){return e.requireAuth===!1}async function ci(e,t,r,n){if(!ap(n)&&(t.peer==null||t.status!==200))return new Response(void 0,{status:t.status,headers:t.headers});if(!r.includes(e.method)){let s;if(e.method==="OPTIONS"?s=new Response(void 0,{status:204,headers:t.headers}):s=new Response(void 0,{status:405}),t.headers!==void 0)for(let[i,a]of t.headers)s.headers.set(i,a);return s}return n.handler(e,t.peer)}function ku(e){let t=Se(e.method);return{path:e.path,method:["OPTIONS",...t],cors:e.cors,init:r=>{let n=new Vn(r,e),o=ce(e,r);return async s=>{let i=await n.authenticateRequest(ui(s),s.method,s.headers.get("Authorization"));return ci(s,i,t,o)}}}}function Ku(e){let t=Se(e.method),r={path:e.path,method:["OPTIONS",...t],cors:e.cors,init:n=>{let o=new Vn(n,e),s=ce(e,n);return r[Fe]=i=>{o.authenticateRequest(ui(i),"",fp(i)).then(a=>{s.handler(i,a.peer)}).catch(()=>{i.close()})},async i=>{let a=await o.authenticateRequest(ui(i),i.method,cp(i)??up(i));return ci(i,a,t,{...s,handler:async(c,u)=>ce(Ge({...s,handler:l=>{s.handler(l,u)},fallback:s.fallback==null?void 0:async l=>ci(l,a,t,{...s,handler:async(d,x)=>s.fallback==null?new Response(void 0,{status:500}):s.fallback(d,x)})}),n).handler(c)})}}};return r}function ui(e){let t=new URL(e.url),r=t.hostname;if(t.port===""||t.port===void 0)return r;if(t.protocol==="http:"&&t.port!=="80"&&(r+=":"+t.port),t.protocol==="https:"&&t.port!=="443"&&(r+=":"+t.port),r==="")throw new Error("No hostname");return r}function cp(e){let t=e.headers.get("Authorization");if(t!=null)return t}var Ye="authorization=";function up(e){let t=e.headers.get("Sec-WebSocket-Protocol");if(t==null)return;let r=t.split(","),n=r.filter(o=>o.startsWith(Ye)).pop();if(n!=null&&e.headers.set("Sec-WebSocket-Protocol",r.filter(o=>!o.startsWith(Ye)).join(",")),n!=null)return atob(n.substring(Ye.length))}function fp(e){let t=e.protocol;if(t==null)return;let r=t.split(","),n=r.filter(o=>o.startsWith(Ye)).pop();if(n!=null&&(e.protocol=r.filter(o=>!o.startsWith(Ye)).join(",")),n!=null)return atob(n.substring(Ye.length))}function lp(e={}){return t=>new Hn(t,e)}return Gu(hp);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PHttp}));
//# sourceMappingURL=index.min.js.map
