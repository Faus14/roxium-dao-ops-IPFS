/**
 * @packageDocumentation
 *
 * This is an implementation of the [fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
 * that uses libp2p streams as the underlying transport layer, instead of a TCP
 * socket.
 */
import { readResponse } from './read-response.js';
import { sendRequest } from './send-request.js';
export async function fetch(stream, resource, init = {}) {
    const log = stream.log.newScope('http-fetch');
    resource = typeof resource === 'string' ? new URL(resource) : resource;
    const [response] = await Promise.all([
        readResponse(stream, resource, {
            ...init,
            log
        }),
        sendRequest(stream, resource, {
            ...init,
            log
        })
    ]);
    // close our writable end we've sent the request
    await stream.close({
        signal: init.signal ?? undefined
    });
    return response;
}
//# sourceMappingURL=index.js.map