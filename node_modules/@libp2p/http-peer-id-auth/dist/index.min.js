(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PHttpPeerIdAuth = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PHttpPeerIdAuth=(()=>{var Hr=Object.defineProperty;var Ni=Object.getOwnPropertyDescriptor;var qi=Object.getOwnPropertyNames;var Mi=Object.prototype.hasOwnProperty;var ht=(e,t)=>{for(var r in t)Hr(e,r,{get:t[r],enumerable:!0})},Hi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of qi(t))!Mi.call(e,o)&&o!==r&&Hr(e,o,{get:()=>t[o],enumerable:!(n=Ni(t,o))||n.enumerable});return e};var Vi=e=>Hi(Hr({},"__esModule",{value:!0}),e);var If={};ht(If,{BadResponseError:()=>Ao,ClientInitiatedHandshake:()=>qr,DEFAULT_AUTH_TOKEN_TTL:()=>Nr,HTTP_PEER_ID_AUTH_PROTOCOL:()=>Sf,InvalidPeerError:()=>Ce,InvalidSignatureError:()=>De,InvalidStateError:()=>Nt,MissingAuthHeaderError:()=>vo,NotAuthenticatedError:()=>Bo,PEER_ID_AUTH_SCHEME:()=>lt,ServerInitiatedHandshake:()=>Mr,createServerChallenge:()=>Af,serverResponds:()=>Bf});var Q=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},fe=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var cr=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},fr=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}};var Z=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}};var Xt=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Vr=Symbol.for("@libp2p/peer-id");var Yr={};ht(Yr,{base58btc:()=>X,base58flickr:()=>ji});var Lf=new Uint8Array(0);function Ko(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Kt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function To(e){return new TextEncoder().encode(e)}function Lo(e){return new TextDecoder().decode(e)}function Fi(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,a=e.charAt(0),f=Math.log(c)/Math.log(256),m=Math.log(256)/Math.log(c);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var B=0,v=0,y=0,A=p.length;y!==A&&p[y]===0;)y++,B++;for(var b=(A-y)*m+1>>>0,I=new Uint8Array(b);y!==A;){for(var R=p[y],N=0,M=b-1;(R!==0||N<v)&&M!==-1;M--,N++)R+=256*I[M]>>>0,I[M]=R%c>>>0,R=R/c>>>0;if(R!==0)throw new Error("Non-zero carry");v=N,y++}for(var x=b-v;x!==b&&I[x]===0;)x++;for(var g=a.repeat(B);x<b;++x)g+=e.charAt(I[x]);return g}function w(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var B=0;if(p[B]!==" "){for(var v=0,y=0;p[B]===a;)v++,B++;for(var A=(p.length-B)*f+1>>>0,b=new Uint8Array(A);p[B];){var I=r[p.charCodeAt(B)];if(I===255)return;for(var R=0,N=A-1;(I!==0||R<y)&&N!==-1;N--,R++)I+=c*b[N]>>>0,b[N]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");y=R,B++}if(p[B]!==" "){for(var M=A-y;M!==A&&b[M]===0;)M++;for(var x=new Uint8Array(v+(A-M)),g=v;M!==A;)x[g++]=b[M++];return x}}}function S(p){var B=w(p);if(B)return B;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:w,decode:S}}var Zi=Fi,zi=Zi,Co=zi;var Fr=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Zr=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ro(this,t)}},zr=class{decoders;constructor(t){this.decoders=t}or(t){return Ro(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Ro(e,t){return new zr({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Gr=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Fr(t,r,n),this.decoder=new Zr(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function ue({name:e,prefix:t,encode:r,decode:n}){return new Gr(e,t,r,n)}function qt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Co(r,e);return ue({prefix:t,name:e,encode:n,decode:s=>Kt(o(s))})}function Gi(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,c=0,a=0;for(let f=0;f<o;++f){let m=t[e[f]];if(m===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|m,i+=r,i>=8&&(i-=8,s[a++]=255&c>>i)}if(i>=r||(255&c<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Yi(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let a=0;a<e.length;++a)for(c=c<<8|e[a],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function $i(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function j({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=$i(n);return ue({prefix:t,name:e,encode(s){return Yi(s,n,r)},decode(s){return Gi(s,o,r,e)}})}var X=qt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ji=qt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $r={};ht($r,{base32:()=>le,base32hex:()=>Qi,base32hexpad:()=>ea,base32hexpadupper:()=>ra,base32hexupper:()=>ta,base32pad:()=>Wi,base32padupper:()=>Ji,base32upper:()=>Xi,base32z:()=>na});var le=j({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Xi=j({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Wi=j({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ji=j({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qi=j({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ta=j({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ea=j({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ra=j({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),na=j({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jr={};ht(jr,{base36:()=>Re,base36upper:()=>oa});var Re=qt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oa=qt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sa=ko,Uo=128,ia=127,aa=~ia,ca=Math.pow(2,31);function ko(e,t,r){t=t||[],r=r||0;for(var n=r;e>=ca;)t[r++]=e&255|Uo,e/=128;for(;e&aa;)t[r++]=e&255|Uo,e>>>=7;return t[r]=e|0,ko.bytes=r-n+1,t}var fa=Xr,ua=128,Po=127;function Xr(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw Xr.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Po)<<o:(i&Po)*Math.pow(2,o),o+=7}while(i>=ua);return Xr.bytes=s-n,r}var la=Math.pow(2,7),ha=Math.pow(2,14),da=Math.pow(2,21),pa=Math.pow(2,28),ma=Math.pow(2,35),ya=Math.pow(2,42),ba=Math.pow(2,49),ga=Math.pow(2,56),xa=Math.pow(2,63),wa=function(e){return e<la?1:e<ha?2:e<da?3:e<pa?4:e<ma?5:e<ya?6:e<ba?7:e<ga?8:e<xa?9:10},Ea={encode:sa,decode:fa,encodingLength:wa},Sa=Ea,Ue=Sa;function Pe(e,t=0){return[Ue.decode(e,t),Ue.decode.bytes]}function he(e,t,r=0){return Ue.encode(e,t,r),t}function de(e){return Ue.encodingLength(e)}function At(e,t){let r=t.byteLength,n=de(e),o=n+de(r),s=new Uint8Array(o+r);return he(e,s,0),he(r,s,n),s.set(t,o),new pe(e,r,t,s)}function ke(e){let t=Kt(e),[r,n]=Pe(t),[o,s]=Pe(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new pe(r,o,i,t)}function Oo(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Ko(e.bytes,r.bytes)}}var pe=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function No(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Aa(r,Wr(e),t??X.encoder);default:return Ba(r,Wr(e),t??le.encoder)}}var qo=new WeakMap;function Wr(e){let t=qo.get(e);if(t==null){let r=new Map;return qo.set(e,r),r}return t}var ot=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Oe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Ia)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=At(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&Oo(t.multihash,n.multihash)}toString(t){return No(this,t)}toJSON(){return{"/":No(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Mo(n,o,s.bytes))}else if(r[_a]===!0){let{version:n,multihash:o,code:s}=r,i=ke(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Oe)throw new Error(`Version 0 CID must use dag-pb (code: ${Oe}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Mo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Oe,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Kt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new pe(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[u,w]=Pe(t.subarray(r));return r+=w,u},o=n(),s=Oe;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),a=n(),f=r+a,m=f-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:m,size:f}}static parse(t,r){let[n,o]=va(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Wr(s).set(n,t),s}};function va(e,t){switch(e[0]){case"Q":{let r=t??X;return[X.prefix,r.decode(`${X.prefix}${e}`)]}case X.prefix:{let r=t??X;return[X.prefix,r.decode(e)]}case le.prefix:{let r=t??le;return[le.prefix,r.decode(e)]}case Re.prefix:{let r=t??Re;return[Re.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Aa(e,t,r){let{prefix:n}=r;if(n!==X.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Ba(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Oe=112,Ia=18;function Mo(e,t,r){let n=de(e),o=n+de(t),s=new Uint8Array(o+r.byteLength);return he(e,s,0),he(t,s,n),s.set(r,o),s}var _a=Symbol.for("@ipld/js-cid/CID");var Jr={};ht(Jr,{identity:()=>wt});var Ho=0,Ka="identity",Vo=Kt;function Ta(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return At(Ho,Vo(e))}var wt={code:Ho,name:Ka,encode:Vo,digest:Ta};function ct(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Tt(e=0){return new Uint8Array(e)}function dt(e=0){return new Uint8Array(e)}function Ne(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=dt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var Zo=Symbol.for("@achingbrain/uint8arraylist");function Fo(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function lr(e){return!!e?.[Zo]}var yt=class e{bufs;length;[Zo]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(lr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(lr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Fo(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Fo(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(lr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Ne(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Ne(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let f=t>=c&&t<a,m=r>c&&r<=a;if(f&&m){if(t===c&&r===a){n.push(i);break}let u=t-c;n.push(i.subarray(u,u+(r-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(m){if(r===a){n.push(i);break}n.push(i.subarray(0,r-c));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!lr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<o;u++)i[n[u]]=u;let c=i,a=this.byteLength-n.byteLength,f=n.byteLength-1,m;for(let u=r;u<=a;u+=m){m=0;for(let w=f;w>=0;w--){let S=this.get(u+w);if(n[w]!==S){m=Math.max(1,w-c[S]);break}}if(m===0)return u}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=dt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=Tt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=Tt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=Tt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=dt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=Tt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=Tt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=Tt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=Tt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=Tt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!ct(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var Qr={};ht(Qr,{base10:()=>Da});var Da=qt({prefix:"9",name:"base10",alphabet:"0123456789"});var tn={};ht(tn,{base16:()=>Ca,base16upper:()=>Ra});var Ca=j({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ra=j({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var en={};ht(en,{base2:()=>Ua});var Ua=j({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rn={};ht(rn,{base256emoji:()=>qa});var zo=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Pa=zo.reduce((e,t,r)=>(e[r]=t,e),[]),ka=zo.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function Oa(e){return e.reduce((t,r)=>(t+=Pa[r],t),"")}function Na(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=ka[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var qa=ue({prefix:"\u{1F680}",name:"base256emoji",encode:Oa,decode:Na});var nn={};ht(nn,{base64:()=>Ma,base64pad:()=>Ha,base64url:()=>Va,base64urlpad:()=>Fa});var Ma=j({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ha=j({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Va=j({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Fa=j({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var on={};ht(on,{base8:()=>Za});var Za=j({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var sn={};ht(sn,{identity:()=>za});var za=ue({prefix:"\0",name:"identity",encode:e=>Lo(e),decode:e=>To(e)});var hu=new TextEncoder,du=new TextDecoder;var fn={};ht(fn,{sha256:()=>qe,sha512:()=>ja});var $a=20;function cn({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new an(e,t,r,n,o)}var an=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??$a,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Go(n,this.code,r?.truncate):n.then(o=>Go(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Go(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return At(t,e)}function $o(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var qe=cn({name:"sha2-256",code:18,encode:$o("SHA-256")}),ja=cn({name:"sha2-512",code:19,encode:$o("SHA-512")});var un={...sn,...en,...on,...Qr,...tn,...$r,...jr,...Yr,...nn,...rn},Bu={...fn,...Jr};function Xo(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var jo=Xo("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),ln=Xo("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=dt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Xa={utf8:jo,"utf-8":jo,hex:un.base16,latin1:ln,ascii:ln,binary:ln,...un},hr=Xa;function q(e,t="utf8"){let r=hr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function P(e,t="utf8"){let r=hr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var Wa=parseInt("11111",2),hn=parseInt("10000000",2),Ja=parseInt("01111111",2),Wo={0:Me,1:Me,2:Qa,3:rc,4:nc,5:ec,6:tc,16:Me,22:Me,48:Me};function Lt(e,t={offset:0}){let r=e[t.offset]&Wa;if(t.offset++,Wo[r]!=null)return Wo[r](e,t);throw new Error("No decoder for tag "+r)}function He(e,t){let r=0;if((e[t.offset]&hn)===hn){let n=e[t.offset]&Ja,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Me(e,t){He(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=Lt(e,t);if(n===null)break;r.push(n)}return r}function Qa(e,t){let r=He(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function tc(e,t){let r=He(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let f=e[t.offset];if(t.offset++,a.push(f&127),f<128){a.reverse();let m=0;for(let u=0;u<a.length;u++)m+=a[u]<<u*7;c+=`.${m}`,a=[]}}return c}function ec(e,t){return t.offset++,null}function rc(e,t){let r=He(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function nc(e,t){let r=He(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function oc(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new yt;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function dn(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=oc(e.byteLength);return new yt(Uint8Array.from([t.byteLength|hn]),t)}function pt(e){let t=new yt,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new yt(Uint8Array.from([2]),dn(t),t)}function dr(e){let t=Uint8Array.from([0]),r=new yt(t,e);return new yt(Uint8Array.from([3]),dn(r),r)}function Mt(e,t=48){let r=new yt;for(let n of e)r.append(n);return new yt(Uint8Array.from([t]),dn(r),r)}async function Jo(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var sc=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),ic=Uint8Array.from([6,5,43,129,4,0,34]),ac=Uint8Array.from([6,5,43,129,4,0,35]),cc={ext:!0,kty:"EC",crv:"P-256"},fc={ext:!0,kty:"EC",crv:"P-384"},uc={ext:!0,kty:"EC",crv:"P-521"},pn=32,mn=48,yn=66;function bn(e){let t=Lt(e);return Qo(t)}function Qo(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===pn*2+1)return n=P(t.subarray(r,r+pn),"base64url"),o=P(t.subarray(r+pn),"base64url"),new ye({...cc,key_ops:["verify"],x:n,y:o});if(t.byteLength===mn*2+1)return n=P(t.subarray(r,r+mn),"base64url"),o=P(t.subarray(r+mn),"base64url"),new ye({...fc,key_ops:["verify"],x:n,y:o});if(t.byteLength===yn*2+1)return n=P(t.subarray(r,r+yn),"base64url"),o=P(t.subarray(r+yn),"base64url"),new ye({...uc,key_ops:["verify"],x:n,y:o});throw new Q(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function ts(e){return Mt([pt(Uint8Array.from([1])),Mt([lc(e.crv)],160),Mt([dr(new yt(Uint8Array.from([4]),q(e.x??"","base64url"),q(e.y??"","base64url")))],161)]).subarray()}function lc(e){if(e==="P-256")return sc;if(e==="P-384")return ic;if(e==="P-521")return ac;throw new Q(`Invalid curve ${e}`)}var ye=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=ts(this.jwk)),this._raw}toMultihash(){return wt.digest(tt(this))}toCID(){return ot.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}async verify(t,r,n){return Jo(this.jwk,r,t,n)}};function Wt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Bt(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function O(e,t,r=""){let n=Wt(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,c=s?` of length ${t}`:"",a=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function pr(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Bt(e.outputLen),Bt(e.blockLen)}function be(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function rs(e,t){O(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function Ct(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function mr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Et(e,t){return e<<32-t|e>>>t}var ns=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Rt(e){if(O(e),ns)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=hc[e[r]];return t}var Dt={_0:48,_9:57,A:65,F:70,a:97,f:102};function es(e){if(e>=Dt._0&&e<=Dt._9)return e-Dt._0;if(e>=Dt.A&&e<=Dt.F)return e-(Dt.A-10);if(e>=Dt.a&&e<=Dt.f)return e-(Dt.a-10)}function Ut(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ns)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=es(e.charCodeAt(s)),c=es(e.charCodeAt(s+1));if(i===void 0||c===void 0){let a=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function mt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];O(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function gn(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function ge(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var xn=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function os(e,t,r){return e&t^~e&r}function ss(e,t,r){return e&t^e&r^t&r}var Ve=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=mr(this.buffer)}update(t){be(this),O(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=mr(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){be(this),rs(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Ct(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let u=i;u<o;u++)r[u]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let c=mr(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let f=a/4,m=this.get();if(f>m.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,m[u],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Pt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var st=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var yr=BigInt(4294967295),is=BigInt(32);function dc(e,t=!1){return t?{h:Number(e&yr),l:Number(e>>is&yr)}:{h:Number(e>>is&yr)|0,l:Number(e&yr)|0}}function as(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=dc(e[s],t);[n[s],o[s]]=[i,c]}return[n,o]}var wn=(e,t,r)=>e>>>r,En=(e,t,r)=>e<<32-r|t>>>r,Jt=(e,t,r)=>e>>>r|t<<32-r,Qt=(e,t,r)=>e<<32-r|t>>>r,Fe=(e,t,r)=>e<<64-r|t>>>r-32,Ze=(e,t,r)=>e>>>r-32|t<<64-r;function It(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var cs=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),fs=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,us=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),ls=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,hs=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ds=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var mc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ht=new Uint32Array(64),Sn=class extends Ve{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,r,n,o,s,i,c,a]}set(t,r,n,o,s,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let u=0;u<16;u++,r+=4)Ht[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let w=Ht[u-15],S=Ht[u-2],p=Et(w,7)^Et(w,18)^w>>>3,B=Et(S,17)^Et(S,19)^S>>>10;Ht[u]=B+Ht[u-7]+p+Ht[u-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:f,H:m}=this;for(let u=0;u<64;u++){let w=Et(c,6)^Et(c,11)^Et(c,25),S=m+w+os(c,a,f)+mc[u]+Ht[u]|0,B=(Et(n,2)^Et(n,13)^Et(n,22))+ss(n,o,s)|0;m=f,f=a,a=c,c=i+S|0,i=s,s=o,o=n,n=S+B|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,m=m+this.H|0,this.set(n,o,s,i,c,a,f,m)}roundClean(){Ct(Ht)}destroy(){this.set(0,0,0,0,0,0,0,0),Ct(this.buffer)}},vn=class extends Sn{A=Pt[0]|0;B=Pt[1]|0;C=Pt[2]|0;D=Pt[3]|0;E=Pt[4]|0;F=Pt[5]|0;G=Pt[6]|0;H=Pt[7]|0;constructor(){super(32)}};var ps=as(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),yc=ps[0],bc=ps[1],Vt=new Uint32Array(80),Ft=new Uint32Array(80),An=class extends Ve{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:f,El:m,Fh:u,Fl:w,Gh:S,Gl:p,Hh:B,Hl:v}=this;return[t,r,n,o,s,i,c,a,f,m,u,w,S,p,B,v]}set(t,r,n,o,s,i,c,a,f,m,u,w,S,p,B,v){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=f|0,this.El=m|0,this.Fh=u|0,this.Fl=w|0,this.Gh=S|0,this.Gl=p|0,this.Hh=B|0,this.Hl=v|0}process(t,r){for(let b=0;b<16;b++,r+=4)Vt[b]=t.getUint32(r),Ft[b]=t.getUint32(r+=4);for(let b=16;b<80;b++){let I=Vt[b-15]|0,R=Ft[b-15]|0,N=Jt(I,R,1)^Jt(I,R,8)^wn(I,R,7),M=Qt(I,R,1)^Qt(I,R,8)^En(I,R,7),x=Vt[b-2]|0,g=Ft[b-2]|0,U=Jt(x,g,19)^Fe(x,g,61)^wn(x,g,6),H=Qt(x,g,19)^Ze(x,g,61)^En(x,g,6),L=us(M,H,Ft[b-7],Ft[b-16]),h=ls(L,N,U,Vt[b-7],Vt[b-16]);Vt[b]=h|0,Ft[b]=L|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:f,Dl:m,Eh:u,El:w,Fh:S,Fl:p,Gh:B,Gl:v,Hh:y,Hl:A}=this;for(let b=0;b<80;b++){let I=Jt(u,w,14)^Jt(u,w,18)^Fe(u,w,41),R=Qt(u,w,14)^Qt(u,w,18)^Ze(u,w,41),N=u&S^~u&B,M=w&p^~w&v,x=hs(A,R,M,bc[b],Ft[b]),g=ds(x,y,I,N,yc[b],Vt[b]),U=x|0,H=Jt(n,o,28)^Fe(n,o,34)^Fe(n,o,39),L=Qt(n,o,28)^Ze(n,o,34)^Ze(n,o,39),h=n&s^n&c^s&c,d=o&i^o&a^i&a;y=B|0,A=v|0,B=S|0,v=p|0,S=u|0,p=w|0,{h:u,l:w}=It(f|0,m|0,g|0,U|0),f=c|0,m=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let l=cs(U,L,d);n=fs(l,g,H,h),o=l|0}({h:n,l:o}=It(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=It(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=It(this.Ch|0,this.Cl|0,c|0,a|0),{h:f,l:m}=It(this.Dh|0,this.Dl|0,f|0,m|0),{h:u,l:w}=It(this.Eh|0,this.El|0,u|0,w|0),{h:S,l:p}=It(this.Fh|0,this.Fl|0,S|0,p|0),{h:B,l:v}=It(this.Gh|0,this.Gl|0,B|0,v|0),{h:y,l:A}=It(this.Hh|0,this.Hl|0,y|0,A|0),this.set(n,o,s,i,c,a,f,m,u,w,S,p,B,v,y,A)}roundClean(){Ct(Vt,Ft)}destroy(){Ct(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Bn=class extends An{Ah=st[0]|0;Al=st[1]|0;Bh=st[2]|0;Bl=st[3]|0;Ch=st[4]|0;Cl=st[5]|0;Dh=st[6]|0;Dl=st[7]|0;Eh=st[8]|0;El=st[9]|0;Fh=st[10]|0;Fl=st[11]|0;Gh=st[12]|0;Gl=st[13]|0;Hh=st[14]|0;Hl=st[15]|0;constructor(){super(64)}};var xe=gn(()=>new vn,xn(1));var ms=gn(()=>new Bn,xn(3));var _n=BigInt(0),In=BigInt(1);function kt(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function ys(e){if(typeof e=="bigint"){if(!br(e))throw new Error("positive bigint expected, got "+e)}else Bt(e);return e}function ze(e){let t=ys(e).toString(16);return t.length&1?"0"+t:t}function bs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?_n:BigInt("0x"+e)}function we(e){return bs(Rt(e))}function te(e){return bs(Rt(xr(O(e)).reverse()))}function gr(e,t){Bt(t),e=ys(e);let r=Ut(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Kn(e,t){return gr(e,t).reverse()}function xr(e){return Uint8Array.from(e)}var br=e=>typeof e=="bigint"&&_n<=e;function gc(e,t,r){return br(e)&&br(t)&&br(r)&&t<=e&&e<r}function Ge(e,t,r,n){if(!gc(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Tn(e){let t;for(t=0;e>_n;e>>=In,t+=1);return t}var Ye=e=>(In<<BigInt(e))-In;function gs(e,t,r){if(Bt(e,"hashLen"),Bt(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=v=>new Uint8Array(v),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),c=1e3,a=n(e),f=n(e),m=0,u=()=>{a.fill(1),f.fill(0),m=0},w=(...v)=>r(f,mt(a,...v)),S=(v=o)=>{f=w(s,v),a=w(),v.length!==0&&(f=w(i,v),a=w())},p=()=>{if(m++>=c)throw new Error("drbg: tried max amount of iterations");let v=0,y=[];for(;v<t;){a=w();let A=a.slice();y.push(A),v+=a.length}return mt(...y)};return(v,y)=>{u(),S(v);let A;for(;!(A=y(p()));)S();return u(),A}}function Zt(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,c){let a=e[s];if(c&&a===void 0)return;let f=typeof a;if(f!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${f}`)}let o=(s,i)=>Object.entries(s).forEach(([c,a])=>n(c,a,i));o(t,!1),o(r,!0)}function Ee(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var ft=BigInt(0),et=BigInt(1),ee=BigInt(2),Es=BigInt(3),Ss=BigInt(4),vs=BigInt(5),xc=BigInt(7),As=BigInt(8),wc=BigInt(9),Bs=BigInt(16);function W(e,t){let r=e%t;return r>=ft?r:t+r}function z(e,t,r){let n=e;for(;t-- >ft;)n*=n,n%=r;return n}function xs(e,t){if(e===ft)throw new Error("invert: expected non-zero number");if(t<=ft)throw new Error("invert: expected positive modulus, got "+t);let r=W(e,t),n=t,o=ft,s=et,i=et,c=ft;for(;r!==ft;){let f=n/r,m=n%r,u=o-i*f,w=s-c*f;n=r,r=m,o=i,s=c,i=u,c=w}if(n!==et)throw new Error("invert: does not exist");return W(o,t)}function Dn(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Is(e,t){let r=(e.ORDER+et)/Ss,n=e.pow(t,r);return Dn(e,n,t),n}function Ec(e,t){let r=(e.ORDER-vs)/As,n=e.mul(t,ee),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,ee),o),c=e.mul(s,e.sub(i,e.ONE));return Dn(e,c,t),c}function Sc(e){let t=Se(e),r=_s(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+xc)/Bs;return(c,a)=>{let f=c.pow(a,i),m=c.mul(f,n),u=c.mul(f,o),w=c.mul(f,s),S=c.eql(c.sqr(m),a),p=c.eql(c.sqr(u),a);f=c.cmov(f,m,S),m=c.cmov(w,u,p);let B=c.eql(c.sqr(m),a),v=c.cmov(f,m,B);return Dn(c,v,a),v}}function _s(e){if(e<Es)throw new Error("sqrt is not defined for small field");let t=e-et,r=0;for(;t%ee===ft;)t/=ee,r++;let n=ee,o=Se(e);for(;ws(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Is;let s=o.pow(n,t),i=(t+et)/ee;return function(a,f){if(a.is0(f))return f;if(ws(a,f)!==1)throw new Error("Cannot find square root");let m=r,u=a.mul(a.ONE,s),w=a.pow(f,t),S=a.pow(f,i);for(;!a.eql(w,a.ONE);){if(a.is0(w))return a.ZERO;let p=1,B=a.sqr(w);for(;!a.eql(B,a.ONE);)if(p++,B=a.sqr(B),p===m)throw new Error("Cannot find square root");let v=et<<BigInt(m-p-1),y=a.pow(u,v);m=p,u=a.sqr(y),w=a.mul(w,u),S=a.mul(S,y)}return S}}function vc(e){return e%Ss===Es?Is:e%As===vs?Ec:e%Bs===wc?Sc(e):_s(e)}var Ks=(e,t)=>(W(e,t)&et)===et,Ac=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Cn(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=Ac.reduce((n,o)=>(n[o]="function",n),t);return Zt(e,r),e}function Bc(e,t,r){if(r<ft)throw new Error("invalid exponent, negatives unsupported");if(r===ft)return e.ONE;if(r===et)return t;let n=e.ONE,o=t;for(;r>ft;)r&et&&(n=e.mul(n,o)),o=e.sqr(o),r>>=et;return n}function $e(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),s),n}function ws(e,t){let r=(e.ORDER-et)/ee,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Ic(e,t){t!==void 0&&Bt(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var Ln=class{ORDER;BITS;BYTES;isLE;ZERO=ft;ONE=et;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=ft)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=Ic(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return W(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return ft<=t&&t<this.ORDER}is0(t){return t===ft}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&et)===et}neg(t){return W(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return W(t*t,this.ORDER)}add(t,r){return W(t+r,this.ORDER)}sub(t,r){return W(t-r,this.ORDER)}mul(t,r){return W(t*r,this.ORDER)}pow(t,r){return Bc(this,t,r)}div(t,r){return W(t*xs(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return xs(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=vc(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Kn(t,this.BYTES):gr(t,this.BYTES)}fromBytes(t,r=!1){O(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:c}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let f=new Uint8Array(o);f.set(t,s?0:f.length-t.length),t=f}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let a=s?te(t):we(t);if(c&&(a=W(a,i)),!r&&!this.isValid(a))throw new Error("invalid field element: outside of range 0..ORDER");return a}invertBatch(t){return $e(this,t)}cmov(t,r,n){return n?r:t}};function Se(e,t={}){return new Ln(e,t)}function Ts(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Rn(e){let t=Ts(e);return t+Math.ceil(t/2)}function Un(e,t,r=!1){O(e);let n=e.length,o=Ts(t),s=Rn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?te(e):we(e),c=W(i,t-et)+et;return r?Kn(c,o):gr(c,o)}var ve=BigInt(0),re=BigInt(1);function je(e,t){let r=t.negate();return e?r:t}function ne(e,t){let r=$e(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Rs(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Pn(e,t){Rs(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Ye(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Ls(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(e&o),a=e>>i;c>n&&(c-=s,a+=re);let f=t*n,m=f+Math.abs(c)-1,u=c===0,w=c<0,S=t%2!==0;return{nextN:a,offset:m,isZero:u,isNeg:w,isNegF:S,offsetF:f}}var kn=new WeakMap,Us=new WeakMap;function On(e){return Us.get(e)||1}function Ds(e){if(e!==ve)throw new Error("invalid wNAF")}var Ae=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>ve;)r&re&&(n=n.add(o)),o=o.double(),r>>=re;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=Pn(r,this.bits),s=[],i=t,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let f=1;f<o;f++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=Pn(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:f,isZero:m,isNeg:u,isNegF:w,offsetF:S}=Ls(n,c,i);n=a,m?s=s.add(je(w,r[S])):o=o.add(je(u,r[f]))}return Ds(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=Pn(t,this.bits);for(let i=0;i<s.windows&&n!==ve;i++){let{nextN:c,offset:a,isZero:f,isNeg:m}=Ls(n,i,s);if(n=c,!f){let u=r[a];o=o.add(m?u.negate():u)}}return Ds(n),o}getPrecomputes(t,r,n){let o=kn.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),kn.set(r,o))),o}cached(t,r,n){let o=On(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=On(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Rs(r,this.bits),Us.set(t,r),kn.delete(t)}hasCache(t){return On(t)!==1}};function Ps(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>ve||n>ve;)r&re&&(s=s.add(o)),n&re&&(i=i.add(o)),o=o.double(),r>>=re,n>>=re;return{p1:s,p2:i}}function Cs(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Cn(t),t}else return Se(e,{isLE:r})}function wr(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let f=t[a];if(!(typeof f=="bigint"&&f>ve))throw new Error(`CURVE.${a} must be positive bigint`)}let o=Cs(t.p,r.Fp,n),s=Cs(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function Er(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var zt=BigInt(0),rt=BigInt(1),Nn=BigInt(2),_c=BigInt(8);function Kc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function ks(e,t={}){let r=wr("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;Zt(t,{},{uvRatio:"function"});let c=Nn<<BigInt(o.BYTES*8)-rt,a=v=>n.create(v),f=t.uvRatio||((v,y)=>{try{return{isValid:!0,value:n.sqrt(n.div(v,y))}}catch{return{isValid:!1,value:zt}}});if(!Kc(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function m(v,y,A=!1){let b=A?rt:zt;return Ge("coordinate "+v,y,b,c),y}function u(v){if(!(v instanceof p))throw new Error("EdwardsPoint expected")}let w=Ee((v,y)=>{let{X:A,Y:b,Z:I}=v,R=v.is0();y==null&&(y=R?_c:n.inv(I));let N=a(A*y),M=a(b*y),x=n.mul(I,y);if(R)return{x:zt,y:rt};if(x!==rt)throw new Error("invZ was invalid");return{x:N,y:M}}),S=Ee(v=>{let{a:y,d:A}=s;if(v.is0())throw new Error("bad point: ZERO");let{X:b,Y:I,Z:R,T:N}=v,M=a(b*b),x=a(I*I),g=a(R*R),U=a(g*g),H=a(M*y),L=a(g*a(H+x)),h=a(U+a(A*a(M*x)));if(L!==h)throw new Error("bad point: equation left != right (1)");let d=a(b*I),l=a(R*N);if(d!==l)throw new Error("bad point: equation left != right (2)");return!0});class p{static BASE=new p(s.Gx,s.Gy,rt,a(s.Gx*s.Gy));static ZERO=new p(zt,rt,rt,zt);static Fp=n;static Fn=o;X;Y;Z;T;constructor(y,A,b,I){this.X=m("x",y),this.Y=m("y",A),this.Z=m("z",b,!0),this.T=m("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){if(y instanceof p)throw new Error("extended point not allowed");let{x:A,y:b}=y||{};return m("x",A),m("y",b),new p(A,b,rt,a(A*b))}static fromBytes(y,A=!1){let b=n.BYTES,{a:I,d:R}=s;y=xr(O(y,b,"point")),kt(A,"zip215");let N=xr(y),M=y[b-1];N[b-1]=M&-129;let x=te(N),g=A?c:n.ORDER;Ge("point.y",x,zt,g);let U=a(x*x),H=a(U-rt),L=a(R*U-I),{isValid:h,value:d}=f(H,L);if(!h)throw new Error("bad point: invalid y coordinate");let l=(d&rt)===rt,E=(M&128)!==0;if(!A&&d===zt&&E)throw new Error("bad point: x=0 and x_0=1");return E!==l&&(d=a(-d)),p.fromAffine({x:d,y:x})}static fromHex(y,A=!1){return p.fromBytes(Ut(y),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,A=!0){return B.createCache(this,y),A||this.multiply(Nn),this}assertValidity(){S(this)}equals(y){u(y);let{X:A,Y:b,Z:I}=this,{X:R,Y:N,Z:M}=y,x=a(A*M),g=a(R*I),U=a(b*M),H=a(N*I);return x===g&&U===H}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:y}=s,{X:A,Y:b,Z:I}=this,R=a(A*A),N=a(b*b),M=a(Nn*a(I*I)),x=a(y*R),g=A+b,U=a(a(g*g)-R-N),H=x+N,L=H-M,h=x-N,d=a(U*L),l=a(H*h),E=a(U*h),_=a(L*H);return new p(d,l,_,E)}add(y){u(y);let{a:A,d:b}=s,{X:I,Y:R,Z:N,T:M}=this,{X:x,Y:g,Z:U,T:H}=y,L=a(I*x),h=a(R*g),d=a(M*b*H),l=a(N*U),E=a((I+R)*(x+g)-L-h),_=l-d,T=l+d,D=a(h-A*L),K=a(E*_),C=a(T*D),k=a(E*D),G=a(_*T);return new p(K,C,G,k)}subtract(y){return this.add(y.negate())}multiply(y){if(!o.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:A,f:b}=B.cached(this,y,I=>ne(p,I));return ne(p,[A,b])[0]}multiplyUnsafe(y,A=p.ZERO){if(!o.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===zt?p.ZERO:this.is0()||y===rt?this:B.unsafe(this,y,b=>ne(p,b),A)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return B.unsafe(this,s.n).is0()}toAffine(y){return w(this,y)}clearCofactor(){return i===rt?this:this.multiplyUnsafe(i)}toBytes(){let{x:y,y:A}=this.toAffine(),b=n.toBytes(A);return b[b.length-1]|=y&rt?128:0,b}toHex(){return Rt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let B=new Ae(p,o.BITS);return p.BASE.precompute(8),p}function Os(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');Zt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,c=r.randomBytes||ge,a=r.adjustScalarBytes||(x=>x),f=r.domain||((x,g,U)=>{if(kt(U,"phflag"),g.length||U)throw new Error("Contexts/pre-hash are not supported");return x});function m(x){return i.create(te(x))}function u(x){let g=b.secretKey;O(x,b.secretKey,"secretKey");let U=O(t(x),2*g,"hashedSecretKey"),H=a(U.slice(0,g)),L=U.slice(g,2*g),h=m(H);return{head:H,prefix:L,scalar:h}}function w(x){let{head:g,prefix:U,scalar:H}=u(x),L=o.multiply(H),h=L.toBytes();return{head:g,prefix:U,scalar:H,point:L,pointBytes:h}}function S(x){return w(x).pointBytes}function p(x=Uint8Array.of(),...g){let U=mt(...g);return m(t(f(U,O(x,void 0,"context"),!!n)))}function B(x,g,U={}){x=O(x,void 0,"message"),n&&(x=n(x));let{prefix:H,scalar:L,pointBytes:h}=w(g),d=p(U.context,H,x),l=o.multiply(d).toBytes(),E=p(U.context,l,h,x),_=i.create(d+E*L);if(!i.isValid(_))throw new Error("sign failed: invalid s");let T=mt(l,i.toBytes(_));return O(T,b.signature,"result")}let v={zip215:!0};function y(x,g,U,H=v){let{context:L,zip215:h}=H,d=b.signature;x=O(x,d,"signature"),g=O(g,void 0,"message"),U=O(U,b.publicKey,"publicKey"),h!==void 0&&kt(h,"zip215"),n&&(g=n(g));let l=d/2,E=x.subarray(0,l),_=te(x.subarray(l,d)),T,D,K;try{T=e.fromBytes(U,h),D=e.fromBytes(E,h),K=o.multiplyUnsafe(_)}catch{return!1}if(!h&&T.isSmallOrder())return!1;let C=p(L,D.toBytes(),T.toBytes(),g);return D.add(T.multiplyUnsafe(C)).subtract(K).clearCofactor().is0()}let A=s.BYTES,b={secretKey:A,publicKey:A,signature:2*A,seed:A};function I(x=c(b.seed)){return O(x,b.seed,"seed")}function R(x){return Wt(x)&&x.length===i.BYTES}function N(x,g){try{return!!e.fromBytes(x,g)}catch{return!1}}let M={getExtendedPublicKey:w,randomSecretKey:I,isValidSecretKey:R,isValidPublicKey:N,toMontgomery(x){let{y:g}=e.fromBytes(x),U=b.publicKey,H=U===32;if(!H&&U!==57)throw new Error("only defined for 25519 and 448");let L=H?s.div(rt+g,rt-g):s.div(g-rt,g+rt);return s.toBytes(L)},toMontgomerySecret(x){let g=b.secretKey;O(x,g);let U=t(x.subarray(0,g));return a(U).subarray(0,g)}};return Object.freeze({keygen:Er(I,S),getPublicKey:S,sign:B,verify:y,utils:M,Point:e,lengths:b})}var Tc=BigInt(1),Ns=BigInt(2);var Lc=BigInt(5),Dc=BigInt(8),qn=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Cc={p:qn,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Dc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Rc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=qn,c=e*e%s*e%s,a=z(c,Ns,s)*c%s,f=z(a,Tc,s)*e%s,m=z(f,Lc,s)*f%s,u=z(m,t,s)*m%s,w=z(u,r,s)*u%s,S=z(w,n,s)*w%s,p=z(S,o,s)*S%s,B=z(p,o,s)*S%s,v=z(B,t,s)*m%s;return{pow_p_5_8:z(v,Ns,s)*e%s,b2:c}}function Uc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var qs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Pc(e,t){let r=qn,n=W(t*t*t,r),o=W(n*n*t,r),s=Rc(e*o).pow_p_5_8,i=W(e*n*s,r),c=W(t*i*i,r),a=i,f=W(i*qs,r),m=c===e,u=c===W(-e,r),w=c===W(-e*qs,r);return m&&(i=a),(u||w)&&(i=f),Ks(i,r)&&(i=W(-i,r)),{isValid:m||u,value:i}}var kc=ks(Cc,{uvRatio:Pc});function Oc(e){return Os(kc,ms,Object.assign({adjustScalarBytes:Uc},e))}var Ms=Oc({});var Xe=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},Sr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Hs={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new Sr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var gt=Hs;var vr=32;var Mn,Nc=(async()=>{try{return await gt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function qc(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await gt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await gt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function Mc(e,t,r){return Ms.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function Vs(e,t,r){return Mn==null&&(Mn=await Nc),Mn?qc(e,t,r):Mc(e,t,r)}function Ar(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var Br=class{type="Ed25519";raw;constructor(t){this.raw=Hn(t,vr)}toMultihash(){return wt.digest(tt(this))}toCID(){return ot.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=Vs(this.raw,r,t);return Ar(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function Vn(e){return e=Hn(e,vr),new Br(e)}function Hn(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new Q(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Vc=Math.pow(2,7),Fc=Math.pow(2,14),Zc=Math.pow(2,21),Zs=Math.pow(2,28),zs=Math.pow(2,35),Gs=Math.pow(2,42),Ys=Math.pow(2,49),ut=128,Gt=127;function Yt(e){if(e<Vc)return 1;if(e<Fc)return 2;if(e<Zc)return 3;if(e<Zs)return 4;if(e<zs)return 5;if(e<Gs)return 6;if(e<Ys)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Ir(e,t,r=0){switch(Yt(e)){case 8:t[r++]=e&255|ut,e/=128;case 7:t[r++]=e&255|ut,e/=128;case 6:t[r++]=e&255|ut,e/=128;case 5:t[r++]=e&255|ut,e/=128;case 4:t[r++]=e&255|ut,e>>>=7;case 3:t[r++]=e&255|ut,e>>>=7;case 2:t[r++]=e&255|ut,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function $s(e,t){let r=e[t],n=0;if(n+=r&Gt,r<ut||(r=e[t+1],n+=(r&Gt)<<7,r<ut)||(r=e[t+2],n+=(r&Gt)<<14,r<ut)||(r=e[t+3],n+=(r&Gt)<<21,r<ut)||(r=e[t+4],n+=(r&Gt)*Zs,r<ut)||(r=e[t+5],n+=(r&Gt)*zs,r<ut)||(r=e[t+6],n+=(r&Gt)*Gs,r<ut)||(r=e[t+7],n+=(r&Gt)*Ys,r<ut))return n;throw new RangeError("Could not decode varint")}var Fn=new Float32Array([-0]),$t=new Uint8Array(Fn.buffer);function js(e,t,r){Fn[0]=e,t[r]=$t[0],t[r+1]=$t[1],t[r+2]=$t[2],t[r+3]=$t[3]}function Xs(e,t){return $t[0]=e[t],$t[1]=e[t+1],$t[2]=e[t+2],$t[3]=e[t+3],Fn[0]}var Zn=new Float64Array([-0]),at=new Uint8Array(Zn.buffer);function Ws(e,t,r){Zn[0]=e,t[r]=at[0],t[r+1]=at[1],t[r+2]=at[2],t[r+3]=at[3],t[r+4]=at[4],t[r+5]=at[5],t[r+6]=at[6],t[r+7]=at[7]}function Js(e,t){return at[0]=e[t],at[1]=e[t+1],at[2]=e[t+2],at[3]=e[t+3],at[4]=e[t+4],at[5]=e[t+5],at[6]=e[t+6],at[7]=e[t+7],Zn[0]}var Gc=BigInt(Number.MAX_SAFE_INTEGER),Yc=BigInt(Number.MIN_SAFE_INTEGER),bt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return oe;if(t<Gc&&t>Yc)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>Qs&&(o=0n,++n>Qs&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return oe;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):oe}},oe=new bt(0,0);oe.toBigInt=function(){return 0n};oe.zzEncode=oe.zzDecode=function(){return this};oe.length=function(){return 1};var Qs=4294967296n;function ti(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function ei(e,t,r){if(r-t<1)return"";let o,s=[],i=0,c;for(;t<r;)c=e[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function zn(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function St(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function _r(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Gn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,St(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw St(this,4);return _r(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw St(this,4);return _r(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw St(this,4);let t=Xs(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw St(this,4);let t=Js(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw St(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return ei(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw St(this,t);this.pos+=t}else do if(this.pos>=this.len)throw St(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new bt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw St(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw St(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw St(this,8);let t=_r(this.buf,this.pos+=4),r=_r(this.buf,this.pos+=4);return new bt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=$s(this.buf,this.pos);return this.pos+=Yt(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Yn(e){return new Gn(e instanceof Uint8Array?e:e.subarray())}function Kr(e,t,r){let n=Yn(e);return t.decode(n,void 0,r)}function $n(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return dt(i);o+i>t&&(n=dt(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var se=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function jn(){}var Wn=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},$c=$n();function jc(e){return globalThis.Buffer!=null?dt(e):$c(e)}var Je=class{len;head;tail;states;constructor(){this.len=0,this.head=new se(jn,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new se(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Jn((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Tr,10,bt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=bt.fromBigInt(t);return this._push(Tr,r.length(),r)}uint64Number(t){return this._push(Ir,Yt(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=bt.fromBigInt(t).zzEncode();return this._push(Tr,r.length(),r)}sint64Number(t){let r=bt.fromNumber(t).zzEncode();return this._push(Tr,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(Xn,1,t?1:0)}fixed32(t){return this._push(We,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=bt.fromBigInt(t);return this._push(We,4,r.lo)._push(We,4,r.hi)}fixed64Number(t){let r=bt.fromNumber(t);return this._push(We,4,r.lo)._push(We,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(js,4,t)}double(t){return this._push(Ws,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(Xn,1,0):this.uint32(r)._push(Wc,r,t)}string(t){let r=ti(t);return r!==0?this.uint32(r)._push(zn,r,t):this._push(Xn,1,0)}fork(){return this.states=new Wn(this),this.head=this.tail=new se(jn,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new se(jn,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=jc(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function Xn(e,t,r){t[r]=e&255}function Xc(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var Jn=class extends se{next;constructor(t,r){super(Xc,t,r),this.next=void 0}};function Tr(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function We(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function Wc(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Je.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(Jc,t,e),this},Je.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(Qc,t,e),this});function Jc(e,t,r){t.set(e,r)}function Qc(e,t,r){e.length<40?zn(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(q(e),r)}function Qn(){return new Je}function Lr(e,t){let r=Qn();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Be;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Be||(Be={}));function Dr(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function to(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return Dr("enum",Be.VARINT,r,n)}function Cr(e,t){return Dr("message",Be.LENGTH_DELIMITED,e,t)}var J;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(J||(J={}));var eo;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(eo||(eo={}));(function(e){e.codec=()=>to(eo)})(J||(J={}));var _t;(function(e){let t;e.codec=()=>(t==null&&(t=Cr((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Lr(r,e.codec()),e.decode=(r,n)=>Kr(r,e.codec(),n)})(_t||(_t={}));var ro;(function(e){let t;e.codec=()=>(t==null&&(t=Cr((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Lr(r,e.codec()),e.decode=(r,n)=>Kr(r,e.codec(),n)})(ro||(ro={}));var tr={};ht(tr,{MAX_RSA_KEY_SIZE:()=>no,generateRSAKeyPair:()=>ai,jwkToJWKKeyPair:()=>ci,jwkToPkcs1:()=>nf,jwkToPkix:()=>ao,jwkToRSAPrivateKey:()=>lo,pkcs1MessageToJwk:()=>so,pkcs1MessageToRSAPrivateKey:()=>co,pkcs1ToJwk:()=>rf,pkcs1ToRSAPrivateKey:()=>ii,pkixMessageToJwk:()=>io,pkixMessageToRSAPublicKey:()=>uo,pkixToJwk:()=>of,pkixToRSAPublicKey:()=>fo});var Ie=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=tr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return ot.createV1(114,this._multihash)}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return si(this.jwk,r,t,n)}},Qe=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=tr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}sign(t,r){return oi(this.jwk,t,r)}};var no=8192,oo=18,tf=1062,ef=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function rf(e){let t=Lt(e);return so(t)}function so(e){return{n:P(e[1],"base64url"),e:P(e[2],"base64url"),d:P(e[3],"base64url"),p:P(e[4],"base64url"),q:P(e[5],"base64url"),dp:P(e[6],"base64url"),dq:P(e[7],"base64url"),qi:P(e[8],"base64url"),kty:"RSA"}}function nf(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new Q("JWK was missing components");return Mt([pt(Uint8Array.from([0])),pt(q(e.n,"base64url")),pt(q(e.e,"base64url")),pt(q(e.d,"base64url")),pt(q(e.p,"base64url")),pt(q(e.q,"base64url")),pt(q(e.dp,"base64url")),pt(q(e.dq,"base64url")),pt(q(e.qi,"base64url"))]).subarray()}function of(e){let t=Lt(e,{offset:0});return io(t)}function io(e){let t=Lt(e[1],{offset:0});return{kty:"RSA",n:P(t[0],"base64url"),e:P(t[1],"base64url")}}function ao(e){if(e.n==null||e.e==null)throw new Q("JWK was missing components");return Mt([ef,dr(Mt([pt(q(e.n,"base64url")),pt(q(e.e,"base64url"))]))]).subarray()}function ii(e){let t=Lt(e);return co(t)}function co(e){let t=so(e);return lo(t)}function fo(e,t){if(e.byteLength>=tf)throw new fe("Key size is too large");let r=Lt(e,{offset:0});return uo(r,e,t)}function uo(e,t,r){let n=io(e);if(r==null){let o=xe(_t.encode({Type:J.RSA,Data:t}));r=At(oo,o)}return new Ie(n,r)}function lo(e){if(ui(e)>no)throw new Q("Key size is too large");let t=ci(e),r=xe(_t.encode({Type:J.RSA,Data:ao(t.publicKey)})),n=At(oo,r);return new Qe(t.privateKey,new Ie(t.publicKey,n))}async function ai(e){if(e>no)throw new Q("Key size is too large");let t=await fi(e),r=xe(_t.encode({Type:J.RSA,Data:ao(t.publicKey)})),n=At(oo,r);return new Qe(t.privateKey,new Ie(t.publicKey,n))}function ci(e){if(e==null)throw new Q("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function fi(e,t){let r=await gt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await sf(r,t);return{privateKey:n[0],publicKey:n[1]}}async function oi(e,t,r){let n=await gt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await gt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function si(e,t,r,n){let o=await gt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await gt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function sf(e,t){if(e.privateKey==null||e.publicKey==null)throw new Q("Private and public key are required");let r=await Promise.all([gt.get().subtle.exportKey("jwk",e.privateKey),gt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function ui(e){if(e.kty!=="RSA")throw new Q("invalid key type");if(e.n==null)throw new Q("invalid key modulus");return q(e.n,"base64url").length*8}var Rr=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(pr(t),O(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),Ct(o)}update(t){return be(this),this.iHash.update(t),this}digestInto(t){be(this),O(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ho=(e,t,r)=>new Rr(e,t).update(r).digest();ho.create=(e,t)=>new Rr(e,t);var li=(e,t)=>(e+(e>=0?t:-t)/hi)/t;function af(e,t,r){let[[n,o],[s,i]]=t,c=li(i*e,r),a=li(-o*e,r),f=e-c*n-a*s,m=-c*o-a*i,u=f<Ot,w=m<Ot;u&&(f=-f),w&&(m=-m);let S=Ye(Math.ceil(Tn(r)/2))+_e;if(f<Ot||f>=S||m<Ot||m>=S)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:f,k2neg:w,k2:m}}function mo(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function po(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return kt(r.lowS,"lowS"),kt(r.prehash,"prehash"),r.format!==void 0&&mo(r.format),r}var yo=class extends Error{constructor(t=""){super(t)}},jt={Err:yo,_tlv:{encode:(e,t)=>{let{Err:r}=jt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=ze(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?ze(o.length/2|128):"";return ze(e)+s+o+t},decode(e,t){let{Err:r}=jt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+a);if(f.length!==a)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let m of f)i=i<<8|m;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=jt;if(e<Ot)throw new t("integer: negative integers are not allowed");let r=ze(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=jt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return we(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=jt,o=O(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:f,l:m}=n.decode(2,a);if(m.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(f)}},hexFromSig(e){let{_tlv:t,_int:r}=jt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Ot=BigInt(0),_e=BigInt(1),hi=BigInt(2),Ur=BigInt(3),cf=BigInt(4);function di(e,t={}){let r=wr("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;Zt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:a}=t;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let f=mi(n,o);function m(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function u(L,h,d){let{x:l,y:E}=h.toAffine(),_=n.toBytes(l);if(kt(d,"isCompressed"),d){m();let T=!n.isOdd(E);return mt(pi(T),_)}else return mt(Uint8Array.of(4),_,n.toBytes(E))}function w(L){O(L,void 0,"Point");let{publicKey:h,publicKeyUncompressed:d}=f,l=L.length,E=L[0],_=L.subarray(1);if(l===h&&(E===2||E===3)){let T=n.fromBytes(_);if(!n.isValid(T))throw new Error("bad point: is not on curve, wrong x");let D=B(T),K;try{K=n.sqrt(D)}catch(G){let F=G instanceof Error?": "+G.message:"";throw new Error("bad point: is not on curve, sqrt error"+F)}m();let C=n.isOdd(K);return(E&1)===1!==C&&(K=n.neg(K)),{x:T,y:K}}else if(l===d&&E===4){let T=n.BYTES,D=n.fromBytes(_.subarray(0,T)),K=n.fromBytes(_.subarray(T,T*2));if(!v(D,K))throw new Error("bad point: is not on curve");return{x:D,y:K}}else throw new Error(`bad point: got length ${l}, expected compressed=${h} or uncompressed=${d}`)}let S=t.toBytes||u,p=t.fromBytes||w;function B(L){let h=n.sqr(L),d=n.mul(h,L);return n.add(n.add(d,n.mul(L,s.a)),s.b)}function v(L,h){let d=n.sqr(h),l=B(L);return n.eql(d,l)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=n.mul(n.pow(s.a,Ur),cf),A=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(y,A)))throw new Error("bad curve params: a or b");function b(L,h,d=!1){if(!n.isValid(h)||d&&n.is0(h))throw new Error(`bad point coordinate ${L}`);return h}function I(L){if(!(L instanceof g))throw new Error("Weierstrass Point expected")}function R(L){if(!a||!a.basises)throw new Error("no endo");return af(L,a.basises,o.ORDER)}let N=Ee((L,h)=>{let{X:d,Y:l,Z:E}=L;if(n.eql(E,n.ONE))return{x:d,y:l};let _=L.is0();h==null&&(h=_?n.ONE:n.inv(E));let T=n.mul(d,h),D=n.mul(l,h),K=n.mul(E,h);if(_)return{x:n.ZERO,y:n.ZERO};if(!n.eql(K,n.ONE))throw new Error("invZ was invalid");return{x:T,y:D}}),M=Ee(L=>{if(L.is0()){if(t.allowInfinityPoint&&!n.is0(L.Y))return;throw new Error("bad point: ZERO")}let{x:h,y:d}=L.toAffine();if(!n.isValid(h)||!n.isValid(d))throw new Error("bad point: x or y not field elements");if(!v(h,d))throw new Error("bad point: equation left != right");if(!L.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function x(L,h,d,l,E){return d=new g(n.mul(d.X,L),d.Y,d.Z),h=je(l,h),d=je(E,d),h.add(d)}class g{static BASE=new g(s.Gx,s.Gy,n.ONE);static ZERO=new g(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(h,d,l){this.X=b("x",h),this.Y=b("y",d,!0),this.Z=b("z",l),Object.freeze(this)}static CURVE(){return s}static fromAffine(h){let{x:d,y:l}=h||{};if(!h||!n.isValid(d)||!n.isValid(l))throw new Error("invalid affine point");if(h instanceof g)throw new Error("projective point not allowed");return n.is0(d)&&n.is0(l)?g.ZERO:new g(d,l,n.ONE)}static fromBytes(h){let d=g.fromAffine(p(O(h,void 0,"point")));return d.assertValidity(),d}static fromHex(h){return g.fromBytes(Ut(h))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(h=8,d=!0){return H.createCache(this,h),d||this.multiply(Ur),this}assertValidity(){M(this)}hasEvenY(){let{y:h}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(h)}equals(h){I(h);let{X:d,Y:l,Z:E}=this,{X:_,Y:T,Z:D}=h,K=n.eql(n.mul(d,D),n.mul(_,E)),C=n.eql(n.mul(l,D),n.mul(T,E));return K&&C}negate(){return new g(this.X,n.neg(this.Y),this.Z)}double(){let{a:h,b:d}=s,l=n.mul(d,Ur),{X:E,Y:_,Z:T}=this,D=n.ZERO,K=n.ZERO,C=n.ZERO,k=n.mul(E,E),G=n.mul(_,_),F=n.mul(T,T),V=n.mul(E,_);return V=n.add(V,V),C=n.mul(E,T),C=n.add(C,C),D=n.mul(h,C),K=n.mul(l,F),K=n.add(D,K),D=n.sub(G,K),K=n.add(G,K),K=n.mul(D,K),D=n.mul(V,D),C=n.mul(l,C),F=n.mul(h,F),V=n.sub(k,F),V=n.mul(h,V),V=n.add(V,C),C=n.add(k,k),k=n.add(C,k),k=n.add(k,F),k=n.mul(k,V),K=n.add(K,k),F=n.mul(_,T),F=n.add(F,F),k=n.mul(F,V),D=n.sub(D,k),C=n.mul(F,G),C=n.add(C,C),C=n.add(C,C),new g(D,K,C)}add(h){I(h);let{X:d,Y:l,Z:E}=this,{X:_,Y:T,Z:D}=h,K=n.ZERO,C=n.ZERO,k=n.ZERO,G=s.a,F=n.mul(s.b,Ur),V=n.mul(d,_),Y=n.mul(l,T),nt=n.mul(E,D),vt=n.add(d,l),$=n.add(_,T);vt=n.mul(vt,$),$=n.add(V,Y),vt=n.sub(vt,$),$=n.add(d,E);let it=n.add(_,D);return $=n.mul($,it),it=n.add(V,nt),$=n.sub($,it),it=n.add(l,E),K=n.add(T,D),it=n.mul(it,K),K=n.add(Y,nt),it=n.sub(it,K),k=n.mul(G,$),K=n.mul(F,nt),k=n.add(K,k),K=n.sub(Y,k),k=n.add(Y,k),C=n.mul(K,k),Y=n.add(V,V),Y=n.add(Y,V),nt=n.mul(G,nt),$=n.mul(F,$),Y=n.add(Y,nt),nt=n.sub(V,nt),nt=n.mul(G,nt),$=n.add($,nt),V=n.mul(Y,$),C=n.add(C,V),V=n.mul(it,$),K=n.mul(vt,K),K=n.sub(K,V),V=n.mul(vt,Y),k=n.mul(it,k),k=n.add(k,V),new g(K,C,k)}subtract(h){return this.add(h.negate())}is0(){return this.equals(g.ZERO)}multiply(h){let{endo:d}=t;if(!o.isValidNot0(h))throw new Error("invalid scalar: out of range");let l,E,_=T=>H.cached(this,T,D=>ne(g,D));if(d){let{k1neg:T,k1:D,k2neg:K,k2:C}=R(h),{p:k,f:G}=_(D),{p:F,f:V}=_(C);E=G.add(V),l=x(d.beta,k,F,T,K)}else{let{p:T,f:D}=_(h);l=T,E=D}return ne(g,[l,E])[0]}multiplyUnsafe(h){let{endo:d}=t,l=this;if(!o.isValid(h))throw new Error("invalid scalar: out of range");if(h===Ot||l.is0())return g.ZERO;if(h===_e)return l;if(H.hasCache(this))return this.multiply(h);if(d){let{k1neg:E,k1:_,k2neg:T,k2:D}=R(h),{p1:K,p2:C}=Ps(g,l,_,D);return x(d.beta,K,C,E,T)}else return H.unsafe(l,h)}toAffine(h){return N(this,h)}isTorsionFree(){let{isTorsionFree:h}=t;return i===_e?!0:h?h(g,this):H.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:h}=t;return i===_e?this:h?h(g,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(h=!0){return kt(h,"isCompressed"),this.assertValidity(),S(g,this,h)}toHex(h=!0){return Rt(this.toBytes(h))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let U=o.BITS,H=new Ae(g,t.endo?Math.ceil(U/2):U);return g.BASE.precompute(8),g}function pi(e){return Uint8Array.of(e?2:3)}function mi(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ff(e,t={}){let{Fn:r}=e,n=t.randomBytes||ge,o=Object.assign(mi(e.Fp,r),{seed:Rn(r.ORDER)});function s(S){try{let p=r.fromBytes(S);return r.isValidNot0(p)}catch{return!1}}function i(S,p){let{publicKey:B,publicKeyUncompressed:v}=o;try{let y=S.length;return p===!0&&y!==B||p===!1&&y!==v?!1:!!e.fromBytes(S)}catch{return!1}}function c(S=n(o.seed)){return Un(O(S,o.seed,"seed"),r.ORDER)}function a(S,p=!0){return e.BASE.multiply(r.fromBytes(S)).toBytes(p)}function f(S){let{secretKey:p,publicKey:B,publicKeyUncompressed:v}=o;if(!Wt(S)||"_lengths"in r&&r._lengths||p===B)return;let y=O(S,void 0,"key").length;return y===B||y===v}function m(S,p,B=!0){if(f(S)===!0)throw new Error("first arg must be private key");if(f(p)===!1)throw new Error("second arg must be public key");let v=r.fromBytes(S);return e.fromBytes(p).multiply(v).toBytes(B)}let u={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c},w=Er(c,a);return Object.freeze({getPublicKey:a,getSharedSecret:m,keygen:w,Point:e,utils:u,lengths:o})}function yi(e,t,r={}){pr(t),Zt(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||ge,o=r.hmac||((d,l)=>ho(t,d,l)),{Fp:s,Fn:i}=e,{ORDER:c,BITS:a}=i,{keygen:f,getPublicKey:m,getSharedSecret:u,utils:w,lengths:S}=ff(e,r),p={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},B=c*hi<s.ORDER;function v(d){let l=c>>_e;return d>l}function y(d,l){if(!i.isValidNot0(l))throw new Error(`invalid signature ${d}: out of range 1..Point.Fn.ORDER`);return l}function A(){if(B)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function b(d,l){mo(l);let E=S.signature,_=l==="compact"?E:l==="recovered"?E+1:void 0;return O(d,_)}class I{r;s;recovery;constructor(l,E,_){if(this.r=y("r",l),this.s=y("s",E),_!=null){if(A(),![0,1,2,3].includes(_))throw new Error("invalid recovery id");this.recovery=_}Object.freeze(this)}static fromBytes(l,E=p.format){b(l,E);let _;if(E==="der"){let{r:C,s:k}=jt.toSig(O(l));return new I(C,k)}E==="recovered"&&(_=l[0],E="compact",l=l.subarray(1));let T=S.signature/2,D=l.subarray(0,T),K=l.subarray(T,T*2);return new I(i.fromBytes(D),i.fromBytes(K),_)}static fromHex(l,E){return this.fromBytes(Ut(l),E)}assertRecovery(){let{recovery:l}=this;if(l==null)throw new Error("invalid recovery id: must be present");return l}addRecoveryBit(l){return new I(this.r,this.s,l)}recoverPublicKey(l){let{r:E,s:_}=this,T=this.assertRecovery(),D=T===2||T===3?E+c:E;if(!s.isValid(D))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let K=s.toBytes(D),C=e.fromBytes(mt(pi((T&1)===0),K)),k=i.inv(D),G=N(O(l,void 0,"msgHash")),F=i.create(-G*k),V=i.create(_*k),Y=e.BASE.multiplyUnsafe(F).add(C.multiplyUnsafe(V));if(Y.is0())throw new Error("invalid recovery: point at infinify");return Y.assertValidity(),Y}hasHighS(){return v(this.s)}toBytes(l=p.format){if(mo(l),l==="der")return Ut(jt.hexFromSig(this));let{r:E,s:_}=this,T=i.toBytes(E),D=i.toBytes(_);return l==="recovered"?(A(),mt(Uint8Array.of(this.assertRecovery()),T,D)):mt(T,D)}toHex(l){return Rt(this.toBytes(l))}}let R=r.bits2int||function(l){if(l.length>8192)throw new Error("input is too large");let E=we(l),_=l.length*8-a;return _>0?E>>BigInt(_):E},N=r.bits2int_modN||function(l){return i.create(R(l))},M=Ye(a);function x(d){return Ge("num < 2^"+a,d,Ot,M),i.toBytes(d)}function g(d,l){return O(d,void 0,"message"),l?O(t(d),void 0,"prehashed message"):d}function U(d,l,E){let{lowS:_,prehash:T,extraEntropy:D}=po(E,p);d=g(d,T);let K=N(d),C=i.fromBytes(l);if(!i.isValidNot0(C))throw new Error("invalid private key");let k=[x(C),x(K)];if(D!=null&&D!==!1){let Y=D===!0?n(S.secretKey):D;k.push(O(Y,void 0,"extraEntropy"))}let G=mt(...k),F=K;function V(Y){let nt=R(Y);if(!i.isValidNot0(nt))return;let vt=i.inv(nt),$=e.BASE.multiply(nt).toAffine(),it=i.create($.x);if(it===Ot)return;let ar=i.create(vt*i.create(F+it*C));if(ar===Ot)return;let Io=($.x===it?0:2)|Number($.y&_e),_o=ar;return _&&v(ar)&&(_o=i.neg(ar),Io^=1),new I(it,_o,B?void 0:Io)}return{seed:G,k2sig:V}}function H(d,l,E={}){let{seed:_,k2sig:T}=U(d,l,E);return gs(t.outputLen,i.BYTES,o)(_,T).toBytes(E.format)}function L(d,l,E,_={}){let{lowS:T,prehash:D,format:K}=po(_,p);if(E=O(E,void 0,"publicKey"),l=g(l,D),!Wt(d)){let C=d instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+C)}b(d,K);try{let C=I.fromBytes(d,K),k=e.fromBytes(E);if(T&&C.hasHighS())return!1;let{r:G,s:F}=C,V=N(l),Y=i.inv(F),nt=i.create(V*Y),vt=i.create(G*Y),$=e.BASE.multiplyUnsafe(nt).add(k.multiplyUnsafe(vt));return $.is0()?!1:i.create($.x)===G}catch{return!1}}function h(d,l,E={}){let{prehash:_}=po(E,p);return l=g(l,_),I.fromBytes(d,"recovered").recoverPublicKey(l).toBytes()}return Object.freeze({keygen:f,getPublicKey:m,getSharedSecret:u,utils:w,lengths:S,Point:e,sign:H,verify:L,recoverPublicKey:h,Signature:I,hash:t})}var go={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},uf={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var bi=BigInt(2);function lf(e){let t=go.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,m=f*f*e%t,u=z(m,r,t)*m%t,w=z(u,r,t)*m%t,S=z(w,bi,t)*f%t,p=z(S,o,t)*S%t,B=z(p,s,t)*p%t,v=z(B,c,t)*B%t,y=z(v,a,t)*v%t,A=z(y,c,t)*B%t,b=z(A,r,t)*m%t,I=z(b,i,t)*p%t,R=z(I,n,t)*f%t,N=z(R,bi,t);if(!bo.eql(bo.sqr(N),e))throw new Error("Cannot find square root");return N}var bo=Se(go.p,{sqrt:lf}),hf=di(go,{Fp:bo,endo:uf}),Ke=yi(hf,xe);function gi(e,t,r,n){let o=qe.digest(r instanceof Uint8Array?r:r.subarray());if(Ar(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Ke.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new Xe(String(s))});try{return n?.signal?.throwIfAborted(),Ke.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new Xe(String(s))}}var Pr=class{type="secp256k1";raw;_key;constructor(t){this._key=wi(t),this.raw=xi(this._key)}toMultihash(){return wt.digest(tt(this))}toCID(){return ot.createV1(114,this.toMultihash())}toString(){return X.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:ct(this.raw,t.raw)}verify(t,r,n){return gi(this._key,r,t,n)}};function xo(e){return new Pr(e)}function xi(e){return Ke.Point.fromBytes(e).toBytes()}function wi(e){try{return Ke.Point.fromBytes(e),e}catch(t){throw new fe(String(t))}}function ie(e,t){let{Type:r,Data:n}=_t.decode(e),o=n??new Uint8Array;switch(r){case J.RSA:return fo(o,t);case J.Ed25519:return Vn(o);case J.secp256k1:return xo(o);case J.ECDSA:return bn(o);default:throw new Xt}}function Ei(e){let{Type:t,Data:r}=_t.decode(e.digest),n=r??new Uint8Array;switch(t){case J.Ed25519:return Vn(n);case J.secp256k1:return xo(n);case J.ECDSA:return bn(n);default:throw new Xt}}function tt(e){return _t.encode({Type:J[e.type],Data:e.raw})}var Si=Symbol.for("nodejs.util.inspect.custom"),df=114,er=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Vr]=!0;toString(){return this.string==null&&(this.string=X.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return ot.createV1(df,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return ct(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return ct(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Si](){return`PeerId(${this.toString()})`}},rr=class extends er{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},nr=class extends er{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},or=class extends er{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},pf=2336,sr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=wt.digest(q(this.url))}[Si](){return`PeerId(${this.url})`}[Vr]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return ot.createV1(pf,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=P(t)),t.toString()===this.toString())}};var mf=114,vi=2336;function Ai(e,t){let r;if(e.charAt(0)==="1"||e.charAt(0)==="Q")r=ke(X.decode(`z${e}`));else{if(e.startsWith("k51qzi5uqu5")||e.startsWith("kzwfwjn5ji4")||e.startsWith("k2k4r8")||e.startsWith("bafz"))return yf(ot.parse(e));if(t==null)throw new Q('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=ke(t.decode(e))}return Bi(r)}function ae(e){if(e.type==="Ed25519")return new nr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new or({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new rr({multihash:e.toCID().multihash,publicKey:e});throw new Xt}function Bi(e){if(gf(e))return new rr({multihash:e});if(bf(e))try{let t=Ei(e);if(t.type==="Ed25519")return new nr({multihash:e,publicKey:t});if(t.type==="secp256k1")return new or({multihash:e,publicKey:t})}catch{let r=P(e.digest);return new sr(new URL(r))}throw new fr("Supplied PeerID Multihash is invalid")}function yf(e){if(e?.multihash==null||e.version==null||e.version===1&&e.code!==mf&&e.code!==vi)throw new cr("Supplied PeerID CID is invalid");if(e.code===vi){let t=P(e.multihash.digest);return new sr(new URL(t))}return Bi(e.multihash)}function bf(e){return e.code===wt.code}function gf(e){return e.code===qe.code}var xf=2048;function Te(){let e=new Uint8Array(32);return crypto.getRandomValues(e),P(e,"base64urlpad")}function xt(e){let t=Object.entries(e).map(([r,n])=>`${r}="${n}"`).join(", ");return`${lt} ${t}`}async function Le(e,t,r){let n=Ii(t,r);return e.sign(n)}async function ir(e,t,r,n){let o=Ii(t,r);return e.verify(o,n)}var kr=new TextEncoder;function wo([e,t]){return e.length+1+t.length}function Ii(e,t){t.sort((i,c)=>i[0].localeCompare(c[0]));let r=t.reduce((i,c)=>i+Yt(wo(c))+wo(c),e.length),n=new Uint8Array(r),o=0,s=kr.encodeInto(e,n);o+=s.written;for(let[i,c]of t){let a=wo([i,c]);Ir(a,n,o),o+=Yt(a);let f=kr.encodeInto(i,n.subarray(o));o+=f.written,f=kr.encodeInto("=",n.subarray(o)),o+=f.written,typeof c=="string"?(f=kr.encodeInto(c,n.subarray(o)),o+=f.written):(n.set(c,o),o+=c.length)}return n}function ce(e){if(e.length<lt.length+1)throw new Z("Authorization header too short");if(e.length>xf)throw new Z("Authorization header too long");if(!e.includes(lt))throw new Z("No peer id auth scheme found");let t=e.substring(lt.length).trim(),r={},n=/(\w[^=]+)="([^"]+)"/g,o;for(;(o=n.exec(t))!==null;)r[o[1]]=o[2];return r}async function Or(e,t){return Ki(e,t)}async function _i(e,t){let r=await Eo(e,t.opaque);if(typeof r.challengeClient!="string"||typeof r.hostname!="string"||typeof r.creationTime!="number")throw new Error("Invalid opaque");return r}async function Ki(e,t){let r=JSON.stringify(t),n=q(r),o=await e.sign(n),s=JSON.stringify({val:P(n,"base64urlpad"),sig:P(o,"base64urlpad")});return P(q(s),"base64urlpad")}async function Eo(e,t){let{sig:r,val:n}=JSON.parse(P(q(t,"base64urlpad"))),o=q(n,"base64urlpad");if(!await e.verify(o,q(r,"base64urlpad")))throw new Error("Invalid signature");let i=P(o);return JSON.parse(i)}async function So(e,t,r){return Ki(e,{peer:t.toString(),h:r,t:Date.now()})}function Ti(e,t,r){if(e.hostname!==t)throw new Z("Invalid hostname");if(e.challengeClient==null)throw new Z("Missing challenge-client");if(Date.now()-e.creationTime>r)throw new Z("Token expired")}function Li(e){return e==null?!1:typeof e["challenge-server"]=="string"&&typeof e["public-key"]=="string"}function Di(e){return e==null?!1:typeof e.opaque=="string"&&typeof e.sig=="string"}function Ci(e){return e==null?!1:typeof e["challenge-server"]=="string"&&typeof e["public-key"]=="string"&&typeof e.opaque=="string"&&typeof e.sig=="string"}async function Ri(e,t,r,n){let o=await _i(r.publicKey,e);if(Ti(o,t,n),o.clientPublicKey==null)throw new Z("Missing client public key");let s=ie(q(o.clientPublicKey,"base64urlpad")),i=ae(s);if(!await ir(s,lt,[["challenge-client",o.challengeClient],["hostname",t],["server-public-key",tt(r.publicKey)]],q(e.sig,"base64urlpad")))throw new Z("Invalid signature");return{peerId:i,info:xt({bearer:await So(r,i,t)})}}async function Ui(e,t,r){let n=ie(q(e["public-key"],"base64urlpad")),o=ae(n),s=await Le(r,lt,[["challenge-server",e["challenge-server"]],["client-public-key",tt(n)],["hostname",t]]),i=Te();return{peerId:o,authenticate:xt({"challenge-client":i,"public-key":P(tt(r.publicKey),"base64urlpad"),sig:P(s,"base64urlpad"),opaque:await Or(r,{challengeClient:i,creationTime:Date.now(),hostname:t,clientPublicKey:e["public-key"]})})}}async function Pi(e,t,r){let n=ie(q(e["public-key"],"base64urlpad")),o=ae(n),s=await Le(r,lt,[["challenge-server",e["challenge-server"]],["client-public-key",tt(n)],["hostname",t]]);return{peerId:o,info:xt({sig:P(s,"base64urlpad"),bearer:await So(r,o,t)})}}async function ki(e,t,r,n){let o=await Eo(r.publicKey,e.bearer);if(typeof o.peer!="string"||typeof o.h!="string"||typeof o.t!="number")throw new Z("Invalid bearer token");if(o.h!==t)throw new Z("Invalid hostname");if(Date.now()-o.t>(n??Nr))throw new Z("Token expired");return Ai(o.peer)}var vo=class extends Error{static name="MissingAuthHeaderError";name="MissingAuthHeaderError"},De=class extends Error{static name="InvalidSignatureError";name="InvalidSignatureError"},Ce=class extends Error{static name="InvalidPeerError";name="InvalidPeerError"},Ao=class extends Error{static name="BadResponseError";name="BadResponseError"},Bo=class extends Error{static name="NotAuthenticatedError";name="NotAuthenticatedError"},Nt=class extends Error{static name="InvalidStateError";name="InvalidStateError"};function wf(e){return e==null?!1:typeof e["challenge-client"]=="string"&&typeof e["public-key"]=="string"&&typeof e.sig=="string"&&typeof e.opaque=="string"}function Ef(e){return e==null?!1:typeof e["challenge-client"]=="string"&&typeof e["public-key"]=="string"&&typeof e.opaque=="string"}function Oi(e){return e==null?!1:typeof e.bearer=="string"}var qr=class{clientKey;challenge;hostname;verifyPeer;state;serverId;bearer;constructor(t,r,n){this.state="init",this.clientKey=t,this.challenge=Te(),this.hostname=r,this.verifyPeer=n}getChallenge(){return this.state="challenge-server",xt({"challenge-server":this.challenge,"public-key":P(tt(this.clientKey.publicKey),"base64urlpad")})}async verifyServer(t,r){if(this.state!=="challenge-server")throw new Nt(`Client Initiated Handshake state was "${this.state}" and not "challenge-server"`);let n=ce(t);if(!wf(n))throw new Z("Server sent incorrect message");this.state="verify-server";let o=q(n["public-key"],"base64urlpad"),s=ie(o),i=tt(this.clientKey.publicKey);if(!await ir(s,lt,[["challenge-server",this.challenge],["client-public-key",i],["hostname",this.hostname]],q(n.sig,"base64urlpad")))throw new De("Invalid signature");if(this.serverId=ae(s),await this.verifyPeer?.(this.serverId,r)===!1)throw new Ce("verifyPeer check failed");let a=await Le(this.clientKey,lt,[["hostname",this.hostname],["server-public-key",o],["challenge-client",n["challenge-client"]]]);return this.state="respond-to-server",xt({opaque:n.opaque,sig:P(a,"base64urlpad")})}decodeBearerToken(t){if(this.state!=="respond-to-server")throw new Nt(`Client Initiated Handshake state was "${this.state}" and not "respond-to-server"`);let r=ce(t);if(!Oi(r))throw new Z("Server sent incorrect message");return this.state="complete",this.bearer=r.bearer,xt({bearer:this.bearer})}},Mr=class{clientKey;hostname;verifyPeer;state;serverId;bearer;serverPublicKey;challenge;constructor(t,r,n){this.state="init",this.clientKey=t,this.hostname=r,this.verifyPeer=n}async answerServerChallenge(t,r){if(this.state!=="init")throw new Nt(`Client Initiated Handshake state was "${this.state}" and not "init"`);let n=ce(t);if(!Ef(n))throw new Z("Server sent incorrect message");this.state="verify-server",this.serverPublicKey=ie(q(n["public-key"],"base64urlpad")),this.serverId=ae(this.serverPublicKey),this.challenge=n["challenge-client"];let o=await Le(this.clientKey,lt,[["hostname",this.hostname],["server-public-key",tt(this.serverPublicKey)],["challenge-client",n["challenge-client"]]]);if(await this.verifyPeer?.(this.serverId,r)===!1)throw new Ce("verifyPeer check failed");return this.state="challenge-server",xt({"challenge-server":n["challenge-client"],"public-key":P(tt(this.clientKey.publicKey),"base64urlpad"),sig:P(o,"base64urlpad"),opaque:n.opaque})}async decodeBearerToken(t){if(this.state!=="challenge-server")throw new Nt(`Client Initiated Handshake state was "${this.state}" and not "challenge-server"`);let r=ce(t);if(!Oi(r))throw new Z("Server sent incorrect message");if(r.sig==null)throw new Z("Server sent incorrect message");if(this.serverPublicKey==null||this.challenge==null)throw new Nt("Server public key and/or challenge missing");if(!await ir(this.serverPublicKey,lt,[["hostname",this.hostname],["client-public-key",tt(this.clientKey.publicKey)],["challenge-server",this.challenge]],q(r.sig,"base64urlpad")))throw new De("Invalid signature");return this.state="complete",this.bearer=r.bearer,xt({bearer:this.bearer})}};var lt="libp2p-PeerID",Sf="/http-peer-id-auth/1.0.0",Nr=3600*1e3;function vf(e){return e==null?!1:typeof e.bearer=="string"}async function Af(e,t){let r=Te();return xt({"challenge-client":r,"public-key":P(tt(t.publicKey),"base64urlpad"),opaque:await Or(t,{challengeClient:r,hostname:e,creationTime:Date.now()})})}async function Bf(e,t,r,n=Nr){let o=ce(e);if(Ci(o))return Pi(o,t,r);if(Li(o))return Ui(o,t,r);if(Di(o))return Ri(o,t,r,n);if(vf(o))return{peerId:await ki(o,t,r,n)};throw new Z("Client sent invalid message")}return Vi(If);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PHttpPeerIdAuth}));
//# sourceMappingURL=index.min.js.map
