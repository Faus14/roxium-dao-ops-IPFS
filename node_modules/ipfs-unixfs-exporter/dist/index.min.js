(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsUnixfsExporter = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IpfsUnixfsExporter=(()=>{var Zo=Object.create;var bt=Object.defineProperty;var Qo=Object.getOwnPropertyDescriptor;var Yo=Object.getOwnPropertyNames;var es=Object.getPrototypeOf,ts=Object.prototype.hasOwnProperty;var Et=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),H=(t,e)=>{for(var r in e)bt(t,r,{get:e[r],enumerable:!0})},ln=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Yo(e))!ts.call(t,i)&&i!==r&&bt(t,i,{get:()=>e[i],enumerable:!(n=Qo(e,i))||n.enumerable});return t};var ir=(t,e,r)=>(r=t!=null?Zo(es(t)):{},ln(e||!t||!t.__esModule?bt(r,"default",{value:t,enumerable:!0}):r,t)),rs=t=>ln(bt({},"__esModule",{value:!0}),t);var wo=Et((dt,Jt)=>{(function(t,e){"use strict";var r={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(a){if(!Array.isArray(a)&&!ArrayBuffer.isView(a))return!1;for(var h=0;h<a.length;h++)if(!Number.isInteger(a[h])||a[h]<0||a[h]>255)return!1;return!0}function i(a,h){return(a&65535)*h+(((a>>>16)*h&65535)<<16)}function o(a,h){return a<<h|a>>>32-h}function s(a){return a^=a>>>16,a=i(a,2246822507),a^=a>>>13,a=i(a,3266489909),a^=a>>>16,a}function c(a,h){a=[a[0]>>>16,a[0]&65535,a[1]>>>16,a[1]&65535],h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535];var p=[0,0,0,0];return p[3]+=a[3]+h[3],p[2]+=p[3]>>>16,p[3]&=65535,p[2]+=a[2]+h[2],p[1]+=p[2]>>>16,p[2]&=65535,p[1]+=a[1]+h[1],p[0]+=p[1]>>>16,p[1]&=65535,p[0]+=a[0]+h[0],p[0]&=65535,[p[0]<<16|p[1],p[2]<<16|p[3]]}function u(a,h){a=[a[0]>>>16,a[0]&65535,a[1]>>>16,a[1]&65535],h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535];var p=[0,0,0,0];return p[3]+=a[3]*h[3],p[2]+=p[3]>>>16,p[3]&=65535,p[2]+=a[2]*h[3],p[1]+=p[2]>>>16,p[2]&=65535,p[2]+=a[3]*h[2],p[1]+=p[2]>>>16,p[2]&=65535,p[1]+=a[1]*h[3],p[0]+=p[1]>>>16,p[1]&=65535,p[1]+=a[2]*h[2],p[0]+=p[1]>>>16,p[1]&=65535,p[1]+=a[3]*h[1],p[0]+=p[1]>>>16,p[1]&=65535,p[0]+=a[0]*h[3]+a[1]*h[2]+a[2]*h[1]+a[3]*h[0],p[0]&=65535,[p[0]<<16|p[1],p[2]<<16|p[3]]}function l(a,h){return h%=64,h===32?[a[1],a[0]]:h<32?[a[0]<<h|a[1]>>>32-h,a[1]<<h|a[0]>>>32-h]:(h-=32,[a[1]<<h|a[0]>>>32-h,a[0]<<h|a[1]>>>32-h])}function m(a,h){return h%=64,h===0?a:h<32?[a[0]<<h|a[1]>>>32-h,a[1]<<h]:[a[1]<<h-32,0]}function d(a,h){return[a[0]^h[0],a[1]^h[1]]}function v(a){return a=d(a,[0,a[0]>>>1]),a=u(a,[4283543511,3981806797]),a=d(a,[0,a[0]>>>1]),a=u(a,[3301882366,444984403]),a=d(a,[0,a[0]>>>1]),a}r.x86.hash32=function(a,h){if(r.inputValidation&&!n(a))return e;h=h||0;for(var p=a.length%4,B=a.length-p,y=h,w=0,b=3432918353,_=461845907,A=0;A<B;A=A+4)w=a[A]|a[A+1]<<8|a[A+2]<<16|a[A+3]<<24,w=i(w,b),w=o(w,15),w=i(w,_),y^=w,y=o(y,13),y=i(y,5)+3864292196;switch(w=0,p){case 3:w^=a[A+2]<<16;case 2:w^=a[A+1]<<8;case 1:w^=a[A],w=i(w,b),w=o(w,15),w=i(w,_),y^=w}return y^=a.length,y=s(y),y>>>0},r.x86.hash128=function(a,h){if(r.inputValidation&&!n(a))return e;h=h||0;for(var p=a.length%16,B=a.length-p,y=h,w=h,b=h,_=h,A=0,I=0,E=0,N=0,se=597399067,yt=2869860233,gt=951274213,wt=2716044179,S=0;S<B;S=S+16)A=a[S]|a[S+1]<<8|a[S+2]<<16|a[S+3]<<24,I=a[S+4]|a[S+5]<<8|a[S+6]<<16|a[S+7]<<24,E=a[S+8]|a[S+9]<<8|a[S+10]<<16|a[S+11]<<24,N=a[S+12]|a[S+13]<<8|a[S+14]<<16|a[S+15]<<24,A=i(A,se),A=o(A,15),A=i(A,yt),y^=A,y=o(y,19),y+=w,y=i(y,5)+1444728091,I=i(I,yt),I=o(I,16),I=i(I,gt),w^=I,w=o(w,17),w+=b,w=i(w,5)+197830471,E=i(E,gt),E=o(E,17),E=i(E,wt),b^=E,b=o(b,15),b+=_,b=i(b,5)+2530024501,N=i(N,wt),N=o(N,18),N=i(N,se),_^=N,_=o(_,13),_+=y,_=i(_,5)+850148119;switch(A=0,I=0,E=0,N=0,p){case 15:N^=a[S+14]<<16;case 14:N^=a[S+13]<<8;case 13:N^=a[S+12],N=i(N,wt),N=o(N,18),N=i(N,se),_^=N;case 12:E^=a[S+11]<<24;case 11:E^=a[S+10]<<16;case 10:E^=a[S+9]<<8;case 9:E^=a[S+8],E=i(E,gt),E=o(E,17),E=i(E,wt),b^=E;case 8:I^=a[S+7]<<24;case 7:I^=a[S+6]<<16;case 6:I^=a[S+5]<<8;case 5:I^=a[S+4],I=i(I,yt),I=o(I,16),I=i(I,gt),w^=I;case 4:A^=a[S+3]<<24;case 3:A^=a[S+2]<<16;case 2:A^=a[S+1]<<8;case 1:A^=a[S],A=i(A,se),A=o(A,15),A=i(A,yt),y^=A}return y^=a.length,w^=a.length,b^=a.length,_^=a.length,y+=w,y+=b,y+=_,w+=y,b+=y,_+=y,y=s(y),w=s(w),b=s(b),_=s(_),y+=w,y+=b,y+=_,w+=y,b+=y,_+=y,("00000000"+(y>>>0).toString(16)).slice(-8)+("00000000"+(w>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(_>>>0).toString(16)).slice(-8)},r.x64.hash128=function(a,h){if(r.inputValidation&&!n(a))return e;h=h||0;for(var p=a.length%16,B=a.length-p,y=[0,h],w=[0,h],b=[0,0],_=[0,0],A=[2277735313,289559509],I=[1291169091,658871167],E=0;E<B;E=E+16)b=[a[E+4]|a[E+5]<<8|a[E+6]<<16|a[E+7]<<24,a[E]|a[E+1]<<8|a[E+2]<<16|a[E+3]<<24],_=[a[E+12]|a[E+13]<<8|a[E+14]<<16|a[E+15]<<24,a[E+8]|a[E+9]<<8|a[E+10]<<16|a[E+11]<<24],b=u(b,A),b=l(b,31),b=u(b,I),y=d(y,b),y=l(y,27),y=c(y,w),y=c(u(y,[0,5]),[0,1390208809]),_=u(_,I),_=l(_,33),_=u(_,A),w=d(w,_),w=l(w,31),w=c(w,y),w=c(u(w,[0,5]),[0,944331445]);switch(b=[0,0],_=[0,0],p){case 15:_=d(_,m([0,a[E+14]],48));case 14:_=d(_,m([0,a[E+13]],40));case 13:_=d(_,m([0,a[E+12]],32));case 12:_=d(_,m([0,a[E+11]],24));case 11:_=d(_,m([0,a[E+10]],16));case 10:_=d(_,m([0,a[E+9]],8));case 9:_=d(_,[0,a[E+8]]),_=u(_,I),_=l(_,33),_=u(_,A),w=d(w,_);case 8:b=d(b,m([0,a[E+7]],56));case 7:b=d(b,m([0,a[E+6]],48));case 6:b=d(b,m([0,a[E+5]],40));case 5:b=d(b,m([0,a[E+4]],32));case 4:b=d(b,m([0,a[E+3]],24));case 3:b=d(b,m([0,a[E+2]],16));case 2:b=d(b,m([0,a[E+1]],8));case 1:b=d(b,[0,a[E]]),b=u(b,A),b=l(b,31),b=u(b,I),y=d(y,b)}return y=d(y,[0,a.length]),w=d(w,[0,a.length]),y=c(y,w),w=c(w,y),y=v(y),w=v(w),y=c(y,w),w=c(w,y),("00000000"+(y[0]>>>0).toString(16)).slice(-8)+("00000000"+(y[1]>>>0).toString(16)).slice(-8)+("00000000"+(w[0]>>>0).toString(16)).slice(-8)+("00000000"+(w[1]>>>0).toString(16)).slice(-8)},typeof dt<"u"?(typeof Jt<"u"&&Jt.exports&&(dt=Jt.exports=r),dt.murmurHash3=r):typeof define=="function"&&define.amd?define([],function(){return r}):(r._murmurHash3=t.murmurHash3,r.noConflict=function(){return t.murmurHash3=r._murmurHash3,r._murmurHash3=e,r.noConflict=e,r},t.murmurHash3=r)})(dt)});var Eo=Et((cd,bo)=>{bo.exports=wo()});var Ao=Et((md,vo)=>{"use strict";vo.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,r){let n=this._internalPositionFor(e,!1);if(r===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):i=!0,this._setInternalPos(n,e,r,i),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let r=this._internalPositionFor(e,!0);if(r!==-1)return this._data[r][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let r=0;for(;r<this.length;)e(this.get(r),r,this),r++}map(e){let r=0,n=new Array(this.length);for(;r<this.length;)n[r]=e(this.get(r),r,this),r++;return n}reduce(e,r){let n=0,i=r;for(;n<this.length;){let o=this.get(n);i=e(i,o,n),n++}return i}find(e){let r=0,n,i;for(;r<this.length&&!n;)i=this.get(r),n=e(i),r++;return n?i:void 0}_internalPositionFor(e,r){let n=this._bytePosFor(e,r);if(n>=this._bitArrays.length)return-1;let i=this._bitArrays[n],o=e-n*7;if(!((i&1<<o)>0))return-1;let c=this._bitArrays.slice(0,n).reduce(_c,0),u=~(4294967295<<o+1),l=ko(i&u);return c+l-1}_bytePosFor(e,r){let n=Math.floor(e/7),i=n+1;for(;!r&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]|=1<<e-r*7}_unsetBit(e){let r=this._bytePosFor(e,!1);this._bitArrays[r]&=~(1<<e-r*7)}_setInternalPos(e,r,n,i){let o=this._data,s=[r,n];if(i)this._sortData(),o[e]=s;else{if(o.length)if(o[o.length-1][0]>=r)o.push(s);else if(o[0][0]<=r)o.unshift(s);else{let c=Math.round(o.length/2);this._data=o.slice(0,c).concat(s).concat(o.slice(c))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(kc),this._changedData=!1}bitField(){let e=[],r=8,n=0,i=0,o,s=this._bitArrays.slice();for(;s.length||n;){n===0&&(o=s.shift(),n=7);let u=Math.min(n,r),l=~(255<<u),m=o&l;i|=m<<8-r,o=o>>>u,n-=u,r-=u,(!r||!n&&!s.length)&&(e.push(i),i=0,r=8)}for(var c=e.length-1;c>0&&e[c]===0;c--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(vc)}};function _c(t,e){return t+ko(e)}function ko(t){let e=t;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function kc(t,e){return t[0]-e[0]}function vc(t){return t[1]}});var Oo=Et((ap,sn)=>{"use strict";var Xc=Object.prototype.hasOwnProperty,O="~";function pt(){}Object.create&&(pt.prototype=Object.create(null),new pt().__proto__||(O=!1));function Kc(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function Mo(t,e,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var o=new Kc(r,n||t,i),s=O?O+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],o]:t._events[s].push(o):(t._events[s]=o,t._eventsCount++),t}function nr(t,e){--t._eventsCount===0?t._events=new pt:delete t._events[e]}function $(){this._events=new pt,this._eventsCount=0}$.prototype.eventNames=function(){var e=[],r,n;if(this._eventsCount===0)return e;for(n in r=this._events)Xc.call(r,n)&&e.push(O?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e};$.prototype.listeners=function(e){var r=O?O+e:e,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s};$.prototype.listenerCount=function(e){var r=O?O+e:e,n=this._events[r];return n?n.fn?1:n.length:0};$.prototype.emit=function(e,r,n,i,o,s){var c=O?O+e:e;if(!this._events[c])return!1;var u=this._events[c],l=arguments.length,m,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,r),!0;case 3:return u.fn.call(u.context,r,n),!0;case 4:return u.fn.call(u.context,r,n,i),!0;case 5:return u.fn.call(u.context,r,n,i,o),!0;case 6:return u.fn.call(u.context,r,n,i,o,s),!0}for(d=1,m=new Array(l-1);d<l;d++)m[d-1]=arguments[d];u.fn.apply(u.context,m)}else{var v=u.length,a;for(d=0;d<v;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,r);break;case 3:u[d].fn.call(u[d].context,r,n);break;case 4:u[d].fn.call(u[d].context,r,n,i);break;default:if(!m)for(a=1,m=new Array(l-1);a<l;a++)m[a-1]=arguments[a];u[d].fn.apply(u[d].context,m)}}return!0};$.prototype.on=function(e,r,n){return Mo(this,e,r,n,!1)};$.prototype.once=function(e,r,n){return Mo(this,e,r,n,!0)};$.prototype.removeListener=function(e,r,n,i){var o=O?O+e:e;if(!this._events[o])return this;if(!r)return nr(this,o),this;var s=this._events[o];if(s.fn)s.fn===r&&(!i||s.once)&&(!n||s.context===n)&&nr(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==r||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=u.length===1?u[0]:u:nr(this,o)}return this};$.prototype.removeAllListeners=function(e){var r;return e?(r=O?O+e:e,this._events[r]&&nr(this,r)):(this._events=new pt,this._eventsCount=0),this};$.prototype.off=$.prototype.removeListener;$.prototype.addListener=$.prototype.on;$.prefixed=O;$.EventEmitter=$;typeof sn<"u"&&(sn.exports=$)});var su={};H(su,{BadPathError:()=>Xe,InvalidParametersError:()=>ue,NoPropError:()=>Ye,NoResolverError:()=>Ke,NotFoundError:()=>j,NotUnixFSError:()=>C,OverReadError:()=>Ze,UnderReadError:()=>Qe,exporter:()=>Ko,recursive:()=>ou,walkPath:()=>Xo});function ns(t){return t[Symbol.asyncIterator]!=null}function is(t){if(ns(t))return(async()=>{let r;for await(let n of t)r=n;return r})();let e;for(let r of t)e=r;return e}var dn=is;var lr={};H(lr,{base32:()=>ve,base32hex:()=>ys,base32hexpad:()=>ws,base32hexpadupper:()=>bs,base32hexupper:()=>gs,base32pad:()=>ms,base32padupper:()=>xs,base32upper:()=>ps,base32z:()=>Es});var _e={};H(_e,{coerce:()=>re,empty:()=>pn,equals:()=>or,fromHex:()=>ss,fromString:()=>sr,isBinary:()=>as,toHex:()=>os,toString:()=>ar});var pn=new Uint8Array(0);function os(t){return t.reduce((e,r)=>e+r.toString(16).padStart(2,"0"),"")}function ss(t){let e=t.match(/../g);return e!=null?new Uint8Array(e.map(r=>parseInt(r,16))):pn}function or(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}function re(t){if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")}function as(t){return t instanceof ArrayBuffer||ArrayBuffer.isView(t)}function sr(t){return new TextEncoder().encode(t)}function ar(t){return new TextDecoder().decode(t)}function cs(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var o=t.charAt(i),s=o.charCodeAt(0);if(r[s]!==255)throw new TypeError(o+" is ambiguous");r[s]=i}var c=t.length,u=t.charAt(0),l=Math.log(c)/Math.log(256),m=Math.log(256)/Math.log(c);function d(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var p=0,B=0,y=0,w=h.length;y!==w&&h[y]===0;)y++,p++;for(var b=(w-y)*m+1>>>0,_=new Uint8Array(b);y!==w;){for(var A=h[y],I=0,E=b-1;(A!==0||I<B)&&E!==-1;E--,I++)A+=256*_[E]>>>0,_[E]=A%c>>>0,A=A/c>>>0;if(A!==0)throw new Error("Non-zero carry");B=I,y++}for(var N=b-B;N!==b&&_[N]===0;)N++;for(var se=u.repeat(p);N<b;++N)se+=t.charAt(_[N]);return se}function v(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var p=0;if(h[p]!==" "){for(var B=0,y=0;h[p]===u;)B++,p++;for(var w=(h.length-p)*l+1>>>0,b=new Uint8Array(w);h[p];){var _=r[h.charCodeAt(p)];if(_===255)return;for(var A=0,I=w-1;(_!==0||A<y)&&I!==-1;I--,A++)_+=c*b[I]>>>0,b[I]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");y=A,p++}if(h[p]!==" "){for(var E=w-y;E!==w&&b[E]===0;)E++;for(var N=new Uint8Array(B+(w-E)),se=B;E!==w;)N[se++]=b[E++];return N}}}function a(h){var p=v(h);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:v,decode:a}}var us=cs,fs=us,mn=fs;var cr=class{name;prefix;baseEncode;constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ur=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,r,n){this.name=e,this.prefix=r;let i=r.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xn(this,e)}},fr=class{decoders;constructor(e){this.decoders=e}or(e){return xn(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function xn(t,e){return new fr({...t.decoders??{[t.prefix]:t},...e.decoders??{[e.prefix]:e}})}var hr=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new cr(e,r,n),this.decoder=new ur(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ke({name:t,prefix:e,encode:r,decode:n}){return new hr(t,e,r,n)}function ce({name:t,prefix:e,alphabet:r}){let{encode:n,decode:i}=mn(r,t);return ke({prefix:e,name:t,encode:n,decode:o=>re(i(o))})}function hs(t,e,r,n){let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),s=0,c=0,u=0;for(let l=0;l<i;++l){let m=e[t[l]];if(m===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|m,s+=r,s>=8&&(s-=8,o[u++]=255&c>>s)}if(s>=r||(255&c<<8-s)!==0)throw new SyntaxError("Unexpected end of data");return o}function ls(t,e,r){let n=e[e.length-1]==="=",i=(1<<r)-1,o="",s=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],s+=8;s>r;)s-=r,o+=e[i&c>>s];if(s!==0&&(o+=e[i&c<<r-s]),n)for(;(o.length*r&7)!==0;)o+="=";return o}function ds(t){let e={};for(let r=0;r<t.length;++r)e[t[r]]=r;return e}function D({name:t,prefix:e,bitsPerChar:r,alphabet:n}){let i=ds(n);return ke({prefix:e,name:t,encode(o){return ls(o,n,r)},decode(o){return hs(o,i,r,t)}})}var ve=D({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ps=D({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ms=D({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xs=D({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ys=D({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),gs=D({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ws=D({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bs=D({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Es=D({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dr={};H(dr,{base36:()=>Ge,base36upper:()=>_s});var Ge=ce({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_s=ce({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pr={};H(pr,{base58btc:()=>ne,base58flickr:()=>ks});var ne=ce({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ks=ce({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var vs=wn,yn=128,As=127,Bs=~As,Is=Math.pow(2,31);function wn(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Is;)e[r++]=t&255|yn,t/=128;for(;t&Bs;)e[r++]=t&255|yn,t>>>=7;return e[r]=t|0,wn.bytes=r-n+1,e}var Ss=mr,Ts=128,gn=127;function mr(t,n){var r=0,n=n||0,i=0,o=n,s,c=t.length;do{if(o>=c)throw mr.bytes=0,new RangeError("Could not decode varint");s=t[o++],r+=i<28?(s&gn)<<i:(s&gn)*Math.pow(2,i),i+=7}while(s>=Ts);return mr.bytes=o-n,r}var Ns=Math.pow(2,7),Ds=Math.pow(2,14),Cs=Math.pow(2,21),Us=Math.pow(2,28),Ps=Math.pow(2,35),Ls=Math.pow(2,42),Fs=Math.pow(2,49),zs=Math.pow(2,56),$s=Math.pow(2,63),Rs=function(t){return t<Ns?1:t<Ds?2:t<Cs?3:t<Us?4:t<Ps?5:t<Ls?6:t<Fs?7:t<zs?8:t<$s?9:10},Ms={encode:vs,decode:Ss,encodingLength:Rs},Os=Ms,qe=Os;function We(t,e=0){return[qe.decode(t,e),qe.decode.bytes]}function Ae(t,e,r=0){return qe.encode(t,e,r),e}function Be(t){return qe.encodingLength(t)}function Se(t,e){let r=e.byteLength,n=Be(t),i=n+Be(r),o=new Uint8Array(i+r);return Ae(t,o,0),Ae(r,o,n),o.set(e,i),new Ie(t,r,e,o)}function kt(t){let e=re(t),[r,n]=We(e),[i,o]=We(e.subarray(n)),s=e.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Ie(r,i,s,e)}function bn(t,e){if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&or(t.bytes,r.bytes)}}var Ie=class{code;size;digest;bytes;constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};function En(t,e){let{bytes:r,version:n}=t;switch(n){case 0:return Vs(r,xr(t),e??ne.encoder);default:return js(r,xr(t),e??ve.encoder)}}var _n=new WeakMap;function xr(t){let e=_n.get(t);if(e==null){let r=new Map;return _n.set(t,r),r}return e}var U=class t{code;version;multihash;bytes;"/";constructor(e,r,n,i){this.code=r,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==Je)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Gs)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=Se(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return t.equals(this,e)}static equals(e,r){let n=r;return n!=null&&e.code===n.code&&e.version===n.version&&bn(e.multihash,n.multihash)}toString(e){return En(this,e)}toJSON(){return{"/":En(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof t)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:o,bytes:s}=r;return new t(n,i,o,s??kn(n,i,o.bytes))}else if(r[qs]===!0){let{version:n,multihash:i,code:o}=r,s=kt(i);return t.create(n,o,s)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==Je)throw new Error(`Version 0 CID must use dag-pb (code: ${Je}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let i=kn(e,r,n.bytes);return new t(e,r,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,Je,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,i=re(e.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let o=i.subarray(r.multihashSize-r.digestSize),s=new Ie(r.multihashCode,r.digestSize,o,i);return[r.version===0?t.createV0(s):t.createV1(r.codec,s),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[d,v]=We(e.subarray(r));return r+=v,d},i=n(),o=Je;if(i===18?(i=0,r=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=r,c=n(),u=n(),l=r+u,m=l-s;return{version:i,codec:o,multihashCode:c,digestSize:u,multihashSize:m,size:l}}static parse(e,r){let[n,i]=Hs(e,r),o=t.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return xr(o).set(n,e),o}};function Hs(t,e){switch(t[0]){case"Q":{let r=e??ne;return[ne.prefix,r.decode(`${ne.prefix}${t}`)]}case ne.prefix:{let r=e??ne;return[ne.prefix,r.decode(t)]}case ve.prefix:{let r=e??ve;return[ve.prefix,r.decode(t)]}case Ge.prefix:{let r=e??Ge;return[Ge.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}}function Vs(t,e,r){let{prefix:n}=r;if(n!==ne.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=e.get(n);if(i==null){let o=r.encode(t).slice(1);return e.set(n,o),o}else return i}function js(t,e,r){let{prefix:n}=r,i=e.get(n);if(i==null){let o=r.encode(t);return e.set(n,o),o}else return i}var Je=112,Gs=18;function kn(t,e,r){let n=Be(t),i=n+Be(e),o=new Uint8Array(i+r.byteLength);return Ae(t,o,0),Ae(e,o,n),o.set(r,i),o}var qs=Symbol.for("@ipld/js-cid/CID");var Xe=class t extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=t.name;code=t.code;constructor(e="Bad path"){super(e)}},j=class t extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=t.name;code=t.code;constructor(e="Not found"){super(e)}},Ke=class t extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=t.name;code=t.code;constructor(e="No resolver"){super(e)}},C=class t extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=t.name;code=t.code;constructor(e="Not UnixFS"){super(e)}},Ze=class t extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=t.name;code=t.code;constructor(e="Over read"){super(e)}},Qe=class t extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=t.name;code=t.code;constructor(e="Under read"){super(e)}},Ye=class t extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=t.name;code=t.code;constructor(e="No Property found"){super(e)}},ue=class t extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=t.name;code=t.code;constructor(e="Invalid parameters"){super(e)}};var Ws=["string","number","bigint","symbol"],Js=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function vn(t){if(t===null)return"null";if(t===void 0)return"undefined";if(t===!0||t===!1)return"boolean";let e=typeof t;if(Ws.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(t))return"Array";if(Xs(t))return"Buffer";let r=Ks(t);return r||"Object"}function Xs(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}function Ks(t){let e=Object.prototype.toString.call(t).slice(8,-1);if(Js.includes(e))return e}var f=class{constructor(e,r,n){this.major=e,this.majorEncoded=e<<5,this.name=r,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};f.uint=new f(0,"uint",!0);f.negint=new f(1,"negint",!0);f.bytes=new f(2,"bytes",!0);f.string=new f(3,"string",!0);f.array=new f(4,"array",!1);f.map=new f(5,"map",!1);f.tag=new f(6,"tag",!1);f.float=new f(7,"float",!0);f.false=new f(7,"false",!0);f.true=new f(7,"true",!0);f.null=new f(7,"null",!0);f.undefined=new f(7,"undefined",!0);f.break=new f(7,"break",!0);var x=class{constructor(e,r,n){this.type=e,this.value=r,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Ne=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Zs=new TextDecoder,Qs=new TextEncoder;function vt(t){return Ne&&globalThis.Buffer.isBuffer(t)}function At(t){return t instanceof Uint8Array?vt(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}var Sn=Ne?(t,e,r)=>r-e>64?globalThis.Buffer.from(t.subarray(e,r)).toString("utf8"):Bn(t,e,r):(t,e,r)=>r-e>64?Zs.decode(t.subarray(e,r)):Bn(t,e,r),Bt=Ne?t=>t.length>64?globalThis.Buffer.from(t):An(t):t=>t.length>64?Qs.encode(t):An(t);var De=Ne?(t,e,r)=>vt(t)?new Uint8Array(t.subarray(e,r)):t.slice(e,r):(t,e,r)=>t.slice(e,r),Tn=Ne?(t,e)=>(t=t.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),At(globalThis.Buffer.concat(t,e))):(t,e)=>{let r=new Uint8Array(e),n=0;for(let i of t)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},Nn=Ne?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function Dn(t,e){if(vt(t)&&vt(e))return t.compare(e);for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return 0}function An(t){let e=[],r=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=i&63|128):(i&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++n)&1023),e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=i&63|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=i&63|128)}return e}function Bn(t,e,r){let n=[];for(;e<r;){let i=t[e],o=null,s=i>239?4:i>223?3:i>191?2:1;if(e+s<=r){let c,u,l,m;switch(s){case 1:i<128&&(o=i);break;case 2:c=t[e+1],(c&192)===128&&(m=(i&31)<<6|c&63,m>127&&(o=m));break;case 3:c=t[e+1],u=t[e+2],(c&192)===128&&(u&192)===128&&(m=(i&15)<<12|(c&63)<<6|u&63,m>2047&&(m<55296||m>57343)&&(o=m));break;case 4:c=t[e+1],u=t[e+2],l=t[e+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(m=(i&15)<<18|(c&63)<<12|(u&63)<<6|l&63,m>65535&&m<1114112&&(o=m))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),e+=s}return yr(n)}var In=4096;function yr(t){let e=t.length;if(e<=In)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=In));return r}var Ys=256,It=class{constructor(e=Ys){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let r=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let i=r.length-(this.maxCursor-this.cursor)-1;r.set(e,i)}else{if(r){let i=r.length-(this.maxCursor-this.cursor)-1;i<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(r=Nn(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let r;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(r=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=De(n,0,this.cursor)}else r=Tn(this.chunks,this.cursor);return e&&this.reset(),r}};var k="CBOR decode error:",Ce="CBOR encode error:",et=[];et[23]=1;et[24]=2;et[25]=3;et[26]=5;et[27]=9;function ae(t,e,r){if(t.length-e<r)throw new Error(`${k} not enough data for type`)}var P=[24,256,65536,4294967296,BigInt("18446744073709551616")];function G(t,e,r){ae(t,e,1);let n=t[e];if(r.strict===!0&&n<P[0])throw new Error(`${k} integer encoded in more bytes than necessary (strict decode)`);return n}function q(t,e,r){ae(t,e,2);let n=t[e]<<8|t[e+1];if(r.strict===!0&&n<P[1])throw new Error(`${k} integer encoded in more bytes than necessary (strict decode)`);return n}function W(t,e,r){ae(t,e,4);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(r.strict===!0&&n<P[2])throw new Error(`${k} integer encoded in more bytes than necessary (strict decode)`);return n}function J(t,e,r){ae(t,e,8);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],i=t[e+4]*16777216+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&o<P[3])throw new Error(`${k} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(r.allowBigInt===!0)return o;throw new Error(`${k} integers outside of the safe integer range are not supported`)}function Cn(t,e,r,n){return new x(f.uint,G(t,e+1,n),2)}function Un(t,e,r,n){return new x(f.uint,q(t,e+1,n),3)}function Pn(t,e,r,n){return new x(f.uint,W(t,e+1,n),5)}function Ln(t,e,r,n){return new x(f.uint,J(t,e+1,n),9)}function K(t,e){return L(t,0,e.value)}function L(t,e,r){if(r<P[0]){let n=Number(r);t.push([e|n])}else if(r<P[1]){let n=Number(r);t.push([e|24,n])}else if(r<P[2]){let n=Number(r);t.push([e|25,n>>>8,n&255])}else if(r<P[3]){let n=Number(r);t.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<P[4]){let i=[e|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,t.push(i)}else throw new Error(`${k} encountered BigInt larger than allowable range`)}}K.encodedSize=function(e){return L.encodedSize(e.value)};L.encodedSize=function(e){return e<P[0]?1:e<P[1]?2:e<P[2]?3:e<P[3]?5:9};K.compareTokens=function(e,r){return e.value<r.value?-1:e.value>r.value?1:0};function Fn(t,e,r,n){return new x(f.negint,-1-G(t,e+1,n),2)}function zn(t,e,r,n){return new x(f.negint,-1-q(t,e+1,n),3)}function $n(t,e,r,n){return new x(f.negint,-1-W(t,e+1,n),5)}var gr=BigInt(-1),Rn=BigInt(1);function Mn(t,e,r,n){let i=J(t,e+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new x(f.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${k} integers outside of the safe integer range are not supported`);return new x(f.negint,gr-BigInt(i),9)}function St(t,e){let r=e.value,n=typeof r=="bigint"?r*gr-Rn:r*-1-1;L(t,e.type.majorEncoded,n)}St.encodedSize=function(e){let r=e.value,n=typeof r=="bigint"?r*gr-Rn:r*-1-1;return n<P[0]?1:n<P[1]?2:n<P[2]?3:n<P[3]?5:9};St.compareTokens=function(e,r){return e.value<r.value?1:e.value>r.value?-1:0};function tt(t,e,r,n){ae(t,e,r+n);let i=De(t,e+r,e+r+n);return new x(f.bytes,i,r+n)}function On(t,e,r,n){return tt(t,e,1,r)}function Hn(t,e,r,n){return tt(t,e,2,G(t,e+1,n))}function Vn(t,e,r,n){return tt(t,e,3,q(t,e+1,n))}function jn(t,e,r,n){return tt(t,e,5,W(t,e+1,n))}function Gn(t,e,r,n){let i=J(t,e+1,n);if(typeof i=="bigint")throw new Error(`${k} 64-bit integer bytes lengths not supported`);return tt(t,e,9,i)}function Tt(t){return t.encodedBytes===void 0&&(t.encodedBytes=t.type===f.string?Bt(t.value):t.value),t.encodedBytes}function Ue(t,e){let r=Tt(e);L(t,e.type.majorEncoded,r.length),t.push(r)}Ue.encodedSize=function(e){let r=Tt(e);return L.encodedSize(r.length)+r.length};Ue.compareTokens=function(e,r){return ta(Tt(e),Tt(r))};function ta(t,e){return t.length<e.length?-1:t.length>e.length?1:Dn(t,e)}function rt(t,e,r,n,i){let o=r+n;ae(t,e,o);let s=new x(f.string,Sn(t,e+r,e+o),o);return i.retainStringBytes===!0&&(s.byteValue=De(t,e+r,e+o)),s}function qn(t,e,r,n){return rt(t,e,1,r,n)}function Wn(t,e,r,n){return rt(t,e,2,G(t,e+1,n),n)}function Jn(t,e,r,n){return rt(t,e,3,q(t,e+1,n),n)}function Xn(t,e,r,n){return rt(t,e,5,W(t,e+1,n),n)}function Kn(t,e,r,n){let i=J(t,e+1,n);if(typeof i=="bigint")throw new Error(`${k} 64-bit integer string lengths not supported`);return rt(t,e,9,i,n)}var Zn=Ue;function Pe(t,e,r,n){return new x(f.array,n,r)}function Qn(t,e,r,n){return Pe(t,e,1,r)}function Yn(t,e,r,n){return Pe(t,e,2,G(t,e+1,n))}function ei(t,e,r,n){return Pe(t,e,3,q(t,e+1,n))}function ti(t,e,r,n){return Pe(t,e,5,W(t,e+1,n))}function ri(t,e,r,n){let i=J(t,e+1,n);if(typeof i=="bigint")throw new Error(`${k} 64-bit integer array lengths not supported`);return Pe(t,e,9,i)}function ni(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${k} indefinite length items not allowed`);return Pe(t,e,1,1/0)}function Nt(t,e){L(t,f.array.majorEncoded,e.value)}Nt.compareTokens=K.compareTokens;Nt.encodedSize=function(e){return L.encodedSize(e.value)};function Le(t,e,r,n){return new x(f.map,n,r)}function ii(t,e,r,n){return Le(t,e,1,r)}function oi(t,e,r,n){return Le(t,e,2,G(t,e+1,n))}function si(t,e,r,n){return Le(t,e,3,q(t,e+1,n))}function ai(t,e,r,n){return Le(t,e,5,W(t,e+1,n))}function ci(t,e,r,n){let i=J(t,e+1,n);if(typeof i=="bigint")throw new Error(`${k} 64-bit integer map lengths not supported`);return Le(t,e,9,i)}function ui(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${k} indefinite length items not allowed`);return Le(t,e,1,1/0)}function Dt(t,e){L(t,f.map.majorEncoded,e.value)}Dt.compareTokens=K.compareTokens;Dt.encodedSize=function(e){return L.encodedSize(e.value)};function fi(t,e,r,n){return new x(f.tag,r,1)}function hi(t,e,r,n){return new x(f.tag,G(t,e+1,n),2)}function li(t,e,r,n){return new x(f.tag,q(t,e+1,n),3)}function di(t,e,r,n){return new x(f.tag,W(t,e+1,n),5)}function pi(t,e,r,n){return new x(f.tag,J(t,e+1,n),9)}function Ct(t,e){L(t,f.tag.majorEncoded,e.value)}Ct.compareTokens=K.compareTokens;Ct.encodedSize=function(e){return L.encodedSize(e.value)};var aa=20,ca=21,ua=22,fa=23;function mi(t,e,r,n){if(n.allowUndefined===!1)throw new Error(`${k} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new x(f.null,null,1):new x(f.undefined,void 0,1)}function xi(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${k} indefinite length items not allowed`);return new x(f.break,void 0,1)}function wr(t,e,r){if(r){if(r.allowNaN===!1&&Number.isNaN(t))throw new Error(`${k} NaN values are not supported`);if(r.allowInfinity===!1&&(t===1/0||t===-1/0))throw new Error(`${k} Infinity values are not supported`)}return new x(f.float,t,e)}function yi(t,e,r,n){return wr(br(t,e+1),3,n)}function gi(t,e,r,n){return wr(Er(t,e+1),5,n)}function wi(t,e,r,n){return wr(ki(t,e+1),9,n)}function Ut(t,e,r){let n=e.value;if(n===!1)t.push([f.float.majorEncoded|aa]);else if(n===!0)t.push([f.float.majorEncoded|ca]);else if(n===null)t.push([f.float.majorEncoded|ua]);else if(n===void 0)t.push([f.float.majorEncoded|fa]);else{let i,o=!1;(!r||r.float64!==!0)&&(Ei(n),i=br(Q,1),n===i||Number.isNaN(n)?(Q[0]=249,t.push(Q.slice(0,3)),o=!0):(_i(n),i=Er(Q,1),n===i&&(Q[0]=250,t.push(Q.slice(0,5)),o=!0))),o||(ha(n),i=ki(Q,1),Q[0]=251,t.push(Q.slice(0,9)))}}Ut.encodedSize=function(e,r){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!r||r.float64!==!0){Ei(n);let i=br(Q,1);if(n===i||Number.isNaN(n))return 3;if(_i(n),i=Er(Q,1),n===i)return 5}return 9};var bi=new ArrayBuffer(9),Z=new DataView(bi,1),Q=new Uint8Array(bi,0);function Ei(t){if(t===1/0)Z.setUint16(0,31744,!1);else if(t===-1/0)Z.setUint16(0,64512,!1);else if(Number.isNaN(t))Z.setUint16(0,32256,!1);else{Z.setFloat32(0,t);let e=Z.getUint32(0),r=(e&2139095040)>>23,n=e&8388607;if(r===255)Z.setUint16(0,31744,!1);else if(r===0)Z.setUint16(0,(t&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?Z.setUint16(0,0):i<-14?Z.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):Z.setUint16(0,(e&2147483648)>>16|i+15<<10|n>>13,!1)}}}function br(t,e){if(t.length-e<2)throw new Error(`${k} not enough data for float16`);let r=(t[e]<<8)+t[e+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,r&32768?-o:o}function _i(t){Z.setFloat32(0,t,!1)}function Er(t,e){if(t.length-e<4)throw new Error(`${k} not enough data for float32`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,4).getFloat32(0,!1)}function ha(t){Z.setFloat64(0,t,!1)}function ki(t,e){if(t.length-e<8)throw new Error(`${k} not enough data for float64`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,8).getFloat64(0,!1)}Ut.compareTokens=K.compareTokens;function T(t,e,r){throw new Error(`${k} encountered invalid minor (${r}) for major ${t[e]>>>5}`)}function Pt(t){return()=>{throw new Error(`${k} ${t}`)}}var g=[];for(let t=0;t<=23;t++)g[t]=T;g[24]=Cn;g[25]=Un;g[26]=Pn;g[27]=Ln;g[28]=T;g[29]=T;g[30]=T;g[31]=T;for(let t=32;t<=55;t++)g[t]=T;g[56]=Fn;g[57]=zn;g[58]=$n;g[59]=Mn;g[60]=T;g[61]=T;g[62]=T;g[63]=T;for(let t=64;t<=87;t++)g[t]=On;g[88]=Hn;g[89]=Vn;g[90]=jn;g[91]=Gn;g[92]=T;g[93]=T;g[94]=T;g[95]=Pt("indefinite length bytes/strings are not supported");for(let t=96;t<=119;t++)g[t]=qn;g[120]=Wn;g[121]=Jn;g[122]=Xn;g[123]=Kn;g[124]=T;g[125]=T;g[126]=T;g[127]=Pt("indefinite length bytes/strings are not supported");for(let t=128;t<=151;t++)g[t]=Qn;g[152]=Yn;g[153]=ei;g[154]=ti;g[155]=ri;g[156]=T;g[157]=T;g[158]=T;g[159]=ni;for(let t=160;t<=183;t++)g[t]=ii;g[184]=oi;g[185]=si;g[186]=ai;g[187]=ci;g[188]=T;g[189]=T;g[190]=T;g[191]=ui;for(let t=192;t<=215;t++)g[t]=fi;g[216]=hi;g[217]=li;g[218]=di;g[219]=pi;g[220]=T;g[221]=T;g[222]=T;g[223]=T;for(let t=224;t<=243;t++)g[t]=Pt("simple values are not supported");g[244]=T;g[245]=T;g[246]=T;g[247]=mi;g[248]=Pt("simple values are not supported");g[249]=yi;g[250]=gi;g[251]=wi;g[252]=T;g[253]=T;g[254]=T;g[255]=xi;var Y=[];for(let t=0;t<24;t++)Y[t]=new x(f.uint,t,1);for(let t=-1;t>=-24;t--)Y[31-t]=new x(f.negint,t,1);Y[64]=new x(f.bytes,new Uint8Array(0),1);Y[96]=new x(f.string,"",1);Y[128]=new x(f.array,0,1);Y[160]=new x(f.map,0,1);Y[244]=new x(f.false,!1,1);Y[245]=new x(f.true,!0,1);Y[246]=new x(f.null,null,1);function da(){let t=[];return t[f.uint.major]=K,t[f.negint.major]=St,t[f.bytes.major]=Ue,t[f.string.major]=Zn,t[f.array.major]=Nt,t[f.map.major]=Dt,t[f.tag.major]=Ct,t[f.float.major]=Ut,t}var gf=da(),wf=new It,Lt=class t{constructor(e,r){this.obj=e,this.parent=r}includes(e){let r=this;do if(r.obj===e)return!0;while(r=r.parent);return!1}static createCheck(e,r){if(e&&e.includes(r))throw new Error(`${Ce} object contains circular references`);return new t(r,e)}},fe={null:new x(f.null,null),undefined:new x(f.undefined,void 0),true:new x(f.true,!0),false:new x(f.false,!1),emptyArray:new x(f.array,0),emptyMap:new x(f.map,0)},he={number(t,e,r,n){return!Number.isInteger(t)||!Number.isSafeInteger(t)?new x(f.float,t):t>=0?new x(f.uint,t):new x(f.negint,t)},bigint(t,e,r,n){return t>=BigInt(0)?new x(f.uint,t):new x(f.negint,t)},Uint8Array(t,e,r,n){return new x(f.bytes,t)},string(t,e,r,n){return new x(f.string,t)},boolean(t,e,r,n){return t?fe.true:fe.false},null(t,e,r,n){return fe.null},undefined(t,e,r,n){return fe.undefined},ArrayBuffer(t,e,r,n){return new x(f.bytes,new Uint8Array(t))},DataView(t,e,r,n){return new x(f.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength))},Array(t,e,r,n){if(!t.length)return r.addBreakTokens===!0?[fe.emptyArray,new x(f.break)]:fe.emptyArray;n=Lt.createCheck(n,t);let i=[],o=0;for(let s of t)i[o++]=_r(s,r,n);return r.addBreakTokens?[new x(f.array,t.length),i,new x(f.break)]:[new x(f.array,t.length),i]},Object(t,e,r,n){let i=e!=="Object",o=i?t.keys():Object.keys(t),s=i?t.size:o.length;if(!s)return r.addBreakTokens===!0?[fe.emptyMap,new x(f.break)]:fe.emptyMap;n=Lt.createCheck(n,t);let c=[],u=0;for(let l of o)c[u++]=[_r(l,r,n),_r(i?t.get(l):t[l],r,n)];return pa(c,r),r.addBreakTokens?[new x(f.map,s),c,new x(f.break)]:[new x(f.map,s),c]}};he.Map=he.Object;he.Buffer=he.Uint8Array;for(let t of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))he[`${t}Array`]=he.DataView;function _r(t,e={},r){let n=vn(t),i=e&&e.typeEncoders&&e.typeEncoders[n]||he[n];if(typeof i=="function"){let s=i(t,n,e,r);if(s!=null)return s}let o=he[n];if(!o)throw new Error(`${Ce} unsupported type: ${n}`);return o(t,n,e,r)}function pa(t,e){e.mapSorter&&t.sort(e.mapSorter)}var ma={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Ft=class{constructor(e,r={}){this._pos=0,this.data=e,this.options=r}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],r=Y[e];if(r===void 0){let n=g[e];if(!n)throw new Error(`${k} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let i=e&31;r=n(this.data,this._pos,i,this.options)}return this._pos+=r.encodedLength,r}},nt=Symbol.for("DONE"),zt=Symbol.for("BREAK");function xa(t,e,r){let n=[];for(let i=0;i<t.value;i++){let o=Fe(e,r);if(o===zt){if(t.value===1/0)break;throw new Error(`${k} got unexpected break to lengthed array`)}if(o===nt)throw new Error(`${k} found array but not enough entries (got ${i}, expected ${t.value})`);n[i]=o}return n}function ya(t,e,r){let n=r.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<t.value;s++){let c=Fe(e,r);if(c===zt){if(t.value===1/0)break;throw new Error(`${k} got unexpected break to lengthed map`)}if(c===nt)throw new Error(`${k} found map but not enough entries (got ${s} [no key], expected ${t.value})`);if(n!==!0&&typeof c!="string")throw new Error(`${k} non-string keys not supported (got ${typeof c})`);if(r.rejectDuplicateMapKeys===!0&&(n&&o.has(c)||!n&&c in i))throw new Error(`${k} found repeat map key "${c}"`);let u=Fe(e,r);if(u===nt)throw new Error(`${k} found map but not enough entries (got ${s} [no value], expected ${t.value})`);n?o.set(c,u):i[c]=u}return n?o:i}function Fe(t,e){if(t.done())return nt;let r=t.next();if(r.type===f.break)return zt;if(r.type.terminal)return r.value;if(r.type===f.array)return xa(r,t,e);if(r.type===f.map)return ya(r,t,e);if(r.type===f.tag){if(e.tags&&typeof e.tags[r.value]=="function"){let n=Fe(t,e);return e.tags[r.value](n)}throw new Error(`${k} tag not supported (${r.value})`)}throw new Error("unsupported")}function kr(t,e){if(!(t instanceof Uint8Array))throw new Error(`${k} data to decode must be a Uint8Array`);e=Object.assign({},ma,e);let r=e.tokenizer||new Ft(t,e),n=Fe(r,e);if(n===nt)throw new Error(`${k} did not find any content to decode`);if(n===zt)throw new Error(`${k} got unexpected break`);return[n,t.subarray(r.pos())]}function it(t,e){let[r,n]=kr(t,e);if(n.length>0)throw new Error(`${k} too many terminals, data makes no sense`);return r}var Ai=42;function ba(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}function Ea(t){if(t.asCID!==t&&t["/"]!==t.bytes)return null;let e=U.asCID(t);if(!e)return null;let r=new Uint8Array(e.bytes.byteLength+1);return r.set(e.bytes,1),[new x(f.tag,Ai),new x(f.bytes,r)]}function _a(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function ka(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}function va(t){for(let e of t.keys())if(typeof e!="string"||e.length===0)throw new Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null}var vi={float64:!0,typeEncoders:{Map:va,Object:Ea,undefined:_a,number:ka}},Tf={...vi,typeEncoders:{...vi.typeEncoders}};function Aa(t){if(t[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return U.decode(t.subarray(1))}var $t={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};$t.tags[Ai]=Aa;var Nf={...$t,tags:$t.tags.slice()};var Bi=113;var Ii=t=>it(ba(t),$t);var Ti=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let r=this.inRecursive[this.inRecursive.length-1];r&&(r.type===f.array&&(r.elements++,r.elements!==1&&e.push([44])),r.type===f.map&&(r.elements++,r.elements!==1&&(r.elements%2===1?e.push([44]):e.push([58]))))}[f.uint.major](e,r){this.prefix(e);let n=String(r.value),i=[];for(let o=0;o<n.length;o++)i[o]=n.charCodeAt(o);e.push(i)}[f.negint.major](e,r){this[f.uint.major](e,r)}[f.bytes.major](e,r){throw new Error(`${Ce} unsupported type: Uint8Array`)}[f.string.major](e,r){this.prefix(e);let n=Bt(JSON.stringify(r.value));e.push(n.length>32?At(n):n)}[f.array.major](e,r){this.prefix(e),this.inRecursive.push({type:f.array,elements:0}),e.push([91])}[f.map.major](e,r){this.prefix(e),this.inRecursive.push({type:f.map,elements:0}),e.push([123])}[f.tag.major](e,r){}[f.float.major](e,r){if(r.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===f.array)e.push([93]);else if(s.type===f.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(r.value===void 0)throw new Error(`${Ce} unsupported type: undefined`);if(this.prefix(e),r.type.name==="true"){e.push([116,114,117,101]);return}else if(r.type.name==="false"){e.push([102,97,108,115,101]);return}else if(r.type.name==="null"){e.push([110,117,108,108]);return}let n=String(r.value),i=[],o=!1;for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s),!o&&(i[s]===46||i[s]===101||i[s]===69)&&(o=!0);o||(i.push(46),i.push(48)),e.push(i)}};var ze=class{constructor(e,r={}){this._pos=0,this.data=e,this.options=r,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${k} unexpected end of input at position ${this._pos}`);for(let r=0;r<e.length;r++)if(this.data[this._pos++]!==e[r])throw new Error(`${k} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,r=!1,n=!1,i=c=>{for(;!this.done();){let u=this.ch();if(c.includes(u))this._pos++;else break}};if(this.ch()===45&&(r=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new x(f.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),r&&this._pos===e+1)throw new Error(`${k} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${k} unexpected token at position ${this._pos}`);n=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));let o=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(o);return n?new x(f.float,s,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new x(s>=0?f.uint:f.negint,s,this._pos-e):new x(s>=0?f.uint:f.negint,BigInt(o),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${k} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let o=this._pos,s=0;o<this.data.length&&s<65536;o++,s++){let c=this.data[o];if(c===92||c<32||c>=128)break;if(c===34){let u=String.fromCharCode.apply(null,this.data.subarray(this._pos,o));return this._pos=o+1,new x(f.string,u,s)}}let e=this._pos,r=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${k} unexpected end of unicode escape sequence at position ${this._pos}`);let o=0;for(let s=0;s<4;s++){let c=this.ch();if(c>=48&&c<=57)c-=48;else if(c>=97&&c<=102)c=c-97+10;else if(c>=65&&c<=70)c=c-65+10;else throw new Error(`${k} unexpected unicode escape character at position ${this._pos}`);o=o*16+c,this._pos++}return o},i=()=>{let o=this.ch(),s=null,c=o>239?4:o>223?3:o>191?2:1;if(this._pos+c>this.data.length)throw new Error(`${k} unexpected unicode sequence at position ${this._pos}`);let u,l,m,d;switch(c){case 1:o<128&&(s=o);break;case 2:u=this.data[this._pos+1],(u&192)===128&&(d=(o&31)<<6|u&63,d>127&&(s=d));break;case 3:u=this.data[this._pos+1],l=this.data[this._pos+2],(u&192)===128&&(l&192)===128&&(d=(o&15)<<12|(u&63)<<6|l&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:u=this.data[this._pos+1],l=this.data[this._pos+2],m=this.data[this._pos+3],(u&192)===128&&(l&192)===128&&(m&192)===128&&(d=(o&15)<<18|(u&63)<<12|(l&63)<<6|m&63,d>65535&&d<1114112&&(s=d))}s===null?(s=65533,c=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|s&1023),r.push(s),this._pos+=c};for(;!this.done();){let o=this.ch(),s;switch(o){case 92:if(this._pos++,this.done())throw new Error(`${k} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:r.push(s);break;case 98:r.push(8);break;case 116:r.push(9);break;case 110:r.push(10);break;case 102:r.push(12);break;case 114:r.push(13);break;case 117:r.push(n());break;default:throw new Error(`${k} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new x(f.string,yr(r),this._pos-e);default:if(o<32)throw new Error(`${k} invalid control character at position ${this._pos}`);o<128?(r.push(o),this._pos++):i()}}throw new Error(`${k} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new x(f.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new x(f.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new x(f.null,null,4);case 102:return this.expect([102,97,108,115,101]),new x(f.false,!1,5);case 116:return this.expect([116,114,117,101]),new x(f.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${k} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new x(f.break,void 0,1);if(this.ch()!==44)throw new Error(`${k} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new x(f.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new x(f.break,void 0,1);if(this.ch()!==44)throw new Error(`${k} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new x(f.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${k} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${k} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function vr(t,e){return e=Object.assign({tokenizer:new ze(t,e)},e),it(t,e)}var Sa=20;function xe({name:t,code:e,encode:r,minDigestLength:n,maxDigestLength:i}){return new Ar(t,e,r,n,i)}var Ar=class{name;code;encode;minDigestLength;maxDigestLength;constructor(e,r,n,i,o){this.name=e,this.code=r,this.encode=n,this.minDigestLength=i??Sa,this.maxDigestLength=o}digest(e,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){let n=this.encode(e);return n instanceof Uint8Array?Ni(n,this.code,r?.truncate):n.then(i=>Ni(i,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Ni(t,e,r){if(r!=null&&r!==t.byteLength){if(r>t.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${t.byteLength}`);t=t.subarray(0,r)}return Se(e,t)}var Ir={};H(Ir,{base64:()=>Br,base64pad:()=>Ta,base64url:()=>Na,base64urlpad:()=>Da});var Br=D({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ta=D({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Na=D({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Da=D({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Ca(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}var Sr=class extends ze{constructor(e,r){super(e,r),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===f.map){let r=this._next();if(r.type===f.string&&r.value==="/"){let n=this._next();if(n.type===f.string){if(this._next().type!==f.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new x(f.tag,42,0)}if(n.type===f.map){let i=this._next();if(i.type===f.string&&i.value==="bytes"){let o=this._next();if(o.type===f.string){for(let c=0;c<2;c++)if(this._next().type!==f.break)throw new Error("Invalid encoded Bytes form");let s=Br.decode(`m${o.value}`);return new x(f.bytes,s,o.value.length)}this.tokenBuffer.push(o)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(r)}return e}},Tr={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Tr.tags[42]=U.parse;var Ci=297;var Ui=t=>{let e=Ca(t),r=Object.assign(Tr,{tokenizer:new Sr(e,Tr)});return vr(e,r)};var nh=new TextDecoder;var ih=new TextEncoder;var Ua=new TextDecoder;function Nr(t,e){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=t.length)throw new Error("protobuf: unexpected end of data");let i=t[e++];if(r+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[r,e]}function Rt(t,e){let r;[r,e]=Nr(t,e);let n=e+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>t.length)throw new Error("protobuf: unexpected end of data");return[t.subarray(e,n),n]}function Li(t,e){let r;return[r,e]=Nr(t,e),[r&7,r>>3,e]}function Pa(t){let e={},r=t.length,n=0;for(;n<r;){let i,o;if([i,o,n]=Li(t,n),o===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Rt(t,n)}else if(o===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=Rt(t,n),e.Name=Ua.decode(s)}else if(o===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[e.Tsize,n]=Nr(t,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Fi(t){let e=t.length,r=0,n,i=!1,o;for(;r<e;){let c,u;if([c,u,r]=Li(t,r),c!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${c}`);if(u===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,r]=Rt(t,r),n&&(i=!0)}else if(u===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,r]=Rt(t,r),n.push(Pa(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${u}`)}if(r>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return o&&(s.Data=o),s.Links=n||[],s}var sh=new TextEncoder,ah=2**32,ch=2**31;var hh=new TextEncoder;function zi(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}var Mt=112;function le(t){let e=zi(t),r=Fi(e),n={};return r.Data&&(n.Data=r.Data),r.Links&&(n.Links=r.Links.map(i=>{let o={};try{o.Hash=U.decode(i.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(o.Name=i.Name),i.Tsize!==void 0&&(o.Tsize=i.Tsize),o})),n}var _h=new TextEncoder,La=new TextDecoder;var Ri=512;function Mi(t){return JSON.parse(La.decode(t))}var Ot=85;var Pr={};H(Pr,{identity:()=>Ur});var Oi=0,Fa="identity",Hi=re;function za(t,e){if(e?.truncate!=null&&e.truncate!==t.byteLength){if(e.truncate<0||e.truncate>t.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${t.byteLength}`);t=t.subarray(0,e.truncate)}return Se(Oi,Hi(t))}var Ur={code:Oi,name:Fa,encode:Hi,digest:za};function ie(t=0){return new Uint8Array(t)}function ot(t,e){e==null&&(e=t.reduce((i,o)=>i+o.length,0));let r=ie(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}function $a(t){return t[Symbol.asyncIterator]!=null}function Ra(t){if($a(t))return(async()=>{let n=new Uint8Array(0);for await(let i of t)n=ot([n,i],n.length+i.length);return n})();let e=[],r=0;for(let n of t)e.push(n),r+=n.byteLength;return ot(e,r)}var F=Ra;function $e(t,e,r,n,i,o,s){let c=t,u=i;for(;o.length>0;){let l=o[0];if(l in c){o.shift(),u=`${u}/${l}`;let m=U.asCID(c[l]);if(m!=null)return{entry:{type:"object",name:n,path:i,cid:r,node:e,depth:s,size:BigInt(e.length),content:async function*(){yield t}},next:{cid:m,name:l,path:u,toResolve:o}};c=c[l]}else throw new Ye(`No property named ${l} found in node ${r}`)}return{entry:{type:"object",name:n,path:i,cid:r,node:e,depth:s,size:BigInt(e.length),content:async function*(){yield t}}}}var Ma=async(t,e,r,n,i,o,s,c)=>{let u=await F(s.get(t,c)),l=Ii(u);return $e(l,u,t,e,r,n,o)},Vi=Ma;var Oa=async(t,e,r,n,i,o,s,c)=>{let u=await F(s.get(t,c)),l=Ui(u);return $e(l,u,t,e,r,n,o)},ji=Oa;var R=class extends Event{type;detail;constructor(e,r){super(e),this.type=e,this.detail=r}};function Ha(t,e,r,n){let i=BigInt(t.length),o=BigInt(e+i);return r>=o||n<e?new Uint8Array(0):(n>=e&&n<o&&(t=t.subarray(0,Number(n-e))),r>=e&&r<o&&(t=t.subarray(Number(r-e))),t)}var ye=Ha;var Va=(t,e=0,r=t)=>{let n=BigInt(t),i=BigInt(e??0),o=BigInt(r);if(o!==n&&(o=i+o),o>n&&(o=n),i<0n)throw new ue("Offset must be greater than or equal to 0");if(i>n)throw new ue("Offset must be less than the file size");if(o<0n)throw new ue("Length must be greater than or equal to 0");if(o>n)throw new ue("Length must be less than the file size");return{start:i,end:o}},Re=Va;var ja=t=>{async function*e(r={}){let{start:n,end:i}=Re(t.length,r.offset,r.length),o=ye(t,0n,n,i);r.onProgress?.(new R("unixfs:exporter:progress:identity",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(t.byteLength)})),yield o}return e},Ga=async(t,e,r,n,i,o,s,c)=>{if(n.length>0)throw new j(`No link named ${r} found in raw node ${t}`);let u=kt(t.multihash.bytes);return{entry:{type:"identity",name:e,path:r,cid:t,content:ja(u.digest),depth:o,size:BigInt(u.digest.length),node:u.digest}}},Gi=Ga;var qa=async(t,e,r,n,i,o,s,c)=>{let u=await F(s.get(t,c)),l=Mi(u);return $e(l,u,t,e,r,n,o)},qi=qa;var Wa=t=>{async function*e(r={}){let{start:n,end:i}=Re(t.length,r.offset,r.length),o=ye(t,0n,n,i);r.onProgress?.(new R("unixfs:exporter:progress:raw",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(t.byteLength)})),yield o}return e},Ja=async(t,e,r,n,i,o,s,c)=>{if(n.length>0)throw new j(`No link named ${r} found in raw node ${t}`);let u=await F(s.get(t,c));return{entry:{type:"raw",name:e,path:r,cid:t,content:Wa(u),depth:o,size:BigInt(u.length),node:u}}},Wi=Ja;var st=class t extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=t.name;code=t.code;constructor(e="Invalid type"){super(e)}},Ht=class t extends Error{static name="InvalidUnixFSMessageError";static code="ERR_INVALID_MESSAGE";name=t.name;code=t.code;constructor(e="Invalid message"){super(e)}};var Xa=Math.pow(2,7),Ka=Math.pow(2,14),Za=Math.pow(2,21),Ji=Math.pow(2,28),Xi=Math.pow(2,35),Ki=Math.pow(2,42),Zi=Math.pow(2,49),M=128,de=127;function at(t){if(t<Xa)return 1;if(t<Ka)return 2;if(t<Za)return 3;if(t<Ji)return 4;if(t<Xi)return 5;if(t<Ki)return 6;if(t<Zi)return 7;if(Number.MAX_SAFE_INTEGER!=null&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Qi(t,e,r=0){switch(at(t)){case 8:e[r++]=t&255|M,t/=128;case 7:e[r++]=t&255|M,t/=128;case 6:e[r++]=t&255|M,t/=128;case 5:e[r++]=t&255|M,t/=128;case 4:e[r++]=t&255|M,t>>>=7;case 3:e[r++]=t&255|M,t>>>=7;case 2:e[r++]=t&255|M,t>>>=7;case 1:{e[r++]=t&255,t>>>=7;break}default:throw new Error("unreachable")}return e}function Yi(t,e){let r=t[e],n=0;if(n+=r&de,r<M||(r=t[e+1],n+=(r&de)<<7,r<M)||(r=t[e+2],n+=(r&de)<<14,r<M)||(r=t[e+3],n+=(r&de)<<21,r<M)||(r=t[e+4],n+=(r&de)*Ji,r<M)||(r=t[e+5],n+=(r&de)*Xi,r<M)||(r=t[e+6],n+=(r&de)*Ki,r<M)||(r=t[e+7],n+=(r&de)*Zi,r<M))return n;throw new RangeError("Could not decode varint")}var Lr=new Float32Array([-0]),pe=new Uint8Array(Lr.buffer);function eo(t,e,r){Lr[0]=t,e[r]=pe[0],e[r+1]=pe[1],e[r+2]=pe[2],e[r+3]=pe[3]}function to(t,e){return pe[0]=t[e],pe[1]=t[e+1],pe[2]=t[e+2],pe[3]=t[e+3],Lr[0]}var Fr=new Float64Array([-0]),z=new Uint8Array(Fr.buffer);function ro(t,e,r){Fr[0]=t,e[r]=z[0],e[r+1]=z[1],e[r+2]=z[2],e[r+3]=z[3],e[r+4]=z[4],e[r+5]=z[5],e[r+6]=z[6],e[r+7]=z[7]}function no(t,e){return z[0]=t[e],z[1]=t[e+1],z[2]=t[e+2],z[3]=t[e+3],z[4]=t[e+4],z[5]=t[e+5],z[6]=t[e+6],z[7]=t[e+7],Fr[0]}var Qa=BigInt(Number.MAX_SAFE_INTEGER),Ya=BigInt(Number.MIN_SAFE_INTEGER),X=class t{lo;hi;constructor(e,r){this.lo=e|0,this.hi=r|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return ge;if(e<Qa&&e>Ya)return this.fromNumber(Number(e));let r=e<0n;r&&(e=-e);let n=e>>32n,i=e-(n<<32n);return r&&(n=~n|0n,i=~i|0n,++i>io&&(i=0n,++n>io&&(n=0n))),new t(Number(i),Number(n))}static fromNumber(e){if(e===0)return ge;let r=e<0;r&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return r&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new t(n,i)}static from(e){return typeof e=="number"?t.fromNumber(e):typeof e=="bigint"?t.fromBigInt(e):typeof e=="string"?t.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new t(e.low>>>0,e.high>>>0):ge}},ge=new X(0,0);ge.toBigInt=function(){return 0n};ge.zzEncode=ge.zzDecode=function(){return this};ge.length=function(){return 1};var io=4294967296n;function oo(t){let e=0,r=0;for(let n=0;n<t.length;++n)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function so(t,e,r){if(r-e<1)return"";let i,o=[],s=0,c;for(;e<r;)c=t[e++],c<128?o[s++]=c:c>191&&c<224?o[s++]=(c&31)<<6|t[e++]&63:c>239&&c<365?(c=((c&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,o[s++]=55296+(c>>10),o[s++]=56320+(c&1023)):o[s++]=(c&15)<<12|(t[e++]&63)<<6|t[e++]&63,s>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i!=null?(s>0&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))}function zr(t,e,r){let n=r,i,o;for(let s=0;s<t.length;++s)i=t.charCodeAt(s),i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=i&63|128):(i&64512)===55296&&((o=t.charCodeAt(s+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++s,e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=i&63|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=i&63|128);return r-n}function ee(t,e){return RangeError(`index out of range: ${t.pos} + ${e??1} > ${t.len}`)}function Vt(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}var $r=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ee(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw ee(this,4);return Vt(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw ee(this,4);return Vt(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw ee(this,4);let e=to(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw ee(this,4);let e=no(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw ee(this,e);return this.pos+=e,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let e=this.bytes();return so(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ee(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ee(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new X(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw ee(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,e}if(this.len-this.pos>4){for(;r<5;++r)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;r<5;++r){if(this.pos>=this.len)throw ee(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw ee(this,8);let e=Vt(this.buf,this.pos+=4),r=Vt(this.buf,this.pos+=4);return new X(e,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=Yi(this.buf,this.pos);return this.pos+=at(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Rr(t){return new $r(t instanceof Uint8Array?t:t.subarray())}function ct(t,e,r){let n=Rr(t);return e.decode(n,void 0,r)}var Mr={};H(Mr,{base10:()=>ec});var ec=ce({prefix:"9",name:"base10",alphabet:"0123456789"});var Or={};H(Or,{base16:()=>tc,base16upper:()=>rc});var tc=D({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rc=D({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Hr={};H(Hr,{base2:()=>nc});var nc=D({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Vr={};H(Vr,{base256emoji:()=>cc});var co=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ic=co.reduce((t,e,r)=>(t[r]=e,t),[]),oc=co.reduce((t,e,r)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return t[n]=r,t},[]);function sc(t){return t.reduce((e,r)=>(e+=ic[r],e),"")}function ac(t){let e=[];for(let r of t){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let i=oc[n];if(i==null)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}var cc=ke({prefix:"\u{1F680}",name:"base256emoji",encode:sc,decode:ac});var jr={};H(jr,{base8:()=>uc});var uc=D({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Gr={};H(Gr,{identity:()=>fc});var fc=ke({prefix:"\0",name:"identity",encode:t=>ar(t),decode:t=>sr(t)});var qr={};H(qr,{sha256:()=>hc,sha512:()=>lc});function uo(t){return async e=>new Uint8Array(await crypto.subtle.digest(t,e))}var hc=xe({name:"sha2-256",code:18,encode:uo("SHA-256")}),lc=xe({name:"sha2-512",code:19,encode:uo("SHA-512")});var Wr={...Gr,...Hr,...jr,...Mr,...Or,...lr,...dr,...pr,...Ir,...Vr},Bl={...qr,...Pr};function ho(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var fo=ho("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Jr=ho("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=ie(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),dc={utf8:fo,"utf-8":fo,hex:Wr.base16,latin1:Jr,ascii:Jr,binary:Jr,...Wr},lo=dc;function jt(t,e="utf8"){let r=lo[e];if(r==null)throw new Error(`Unsupported encoding "${e}"`);return r.decoder.decode(`${r.prefix}${t}`)}function Xr(t){let e=t??8192,r=e>>>1,n,i=e;return function(s){if(s<1||s>r)return ie(s);i+s>e&&(n=ie(e),i=0);let c=n.subarray(i,i+=s);return(i&7)!==0&&(i=(i|7)+1),c}}var we=class{fn;len;next;val;constructor(e,r,n){this.fn=e,this.len=r,this.next=void 0,this.val=n}};function Kr(){}var Qr=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},pc=Xr();function mc(t){return globalThis.Buffer!=null?ie(t):pc(t)}var ft=class{len;head;tail;states;constructor(){this.len=0,this.head=new we(Kr,0,0),this.tail=this.head,this.states=null}_push(e,r,n){return this.tail=this.tail.next=new we(e,r,n),this.len+=r,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Yr((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Gt,10,X.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let r=X.fromBigInt(e);return this._push(Gt,r.length(),r)}uint64Number(e){return this._push(Qi,at(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let r=X.fromBigInt(e).zzEncode();return this._push(Gt,r.length(),r)}sint64Number(e){let r=X.fromNumber(e).zzEncode();return this._push(Gt,r.length(),r)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Zr,1,e?1:0)}fixed32(e){return this._push(ut,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let r=X.fromBigInt(e);return this._push(ut,4,r.lo)._push(ut,4,r.hi)}fixed64Number(e){let r=X.fromNumber(e);return this._push(ut,4,r.lo)._push(ut,4,r.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(eo,4,e)}double(e){return this._push(ro,8,e)}bytes(e){let r=e.length>>>0;return r===0?this._push(Zr,1,0):this.uint32(r)._push(yc,r,e)}string(e){let r=oo(e);return r!==0?this.uint32(r)._push(zr,r,e):this._push(Zr,1,0)}fork(){return this.states=new Qr(this),this.head=this.tail=new we(Kr,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new we(Kr,0,0),this.len=0),this}ldelim(){let e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=r,this.len+=n),this}finish(){let e=this.head.next,r=mc(this.len),n=0;for(;e!=null;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r}};function Zr(t,e,r){e[r]=t&255}function xc(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}var Yr=class extends we{next;constructor(e,r){super(xc,e,r),this.next=void 0}};function Gt(t,e,r){for(;t.hi!==0;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}function ut(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function yc(t,e,r){e.set(t,r)}globalThis.Buffer!=null&&(ft.prototype.bytes=function(t){let e=t.length>>>0;return this.uint32(e),e>0&&this._push(gc,e,t),this},ft.prototype.string=function(t){let e=globalThis.Buffer.byteLength(t);return this.uint32(e),e>0&&this._push(wc,e,t),this});function gc(t,e,r){e.set(t,r)}function wc(t,e,r){t.length<40?zr(t,e,r):e.utf8Write!=null?e.utf8Write(t,r):e.set(jt(t),r)}function en(){return new ft}function ht(t,e){let r=en();return e.encode(t,r,{lengthDelimited:!1}),r.finish()}var Me;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(Me||(Me={}));function qt(t,e,r,n){return{name:t,type:e,encode:r,decode:n}}function tn(t){function e(i){if(t[i.toString()]==null)throw new Error("Invalid enum value");return t[i]}let r=function(o,s){let c=e(o);s.int32(c)},n=function(o){let s=o.int32();return e(s)};return qt("enum",Me.VARINT,r,n)}function lt(t,e){return qt("message",Me.LENGTH_DELIMITED,t,e)}var te;(function(t){let e;(function(i){i.Raw="Raw",i.Directory="Directory",i.File="File",i.Metadata="Metadata",i.Symlink="Symlink",i.HAMTShard="HAMTShard"})(e=t.DataType||(t.DataType={}));let r;(function(i){i[i.Raw=0]="Raw",i[i.Directory=1]="Directory",i[i.File=2]="File",i[i.Metadata=3]="Metadata",i[i.Symlink=4]="Symlink",i[i.HAMTShard=5]="HAMTShard"})(r||(r={})),(function(i){i.codec=()=>tn(r)})(e=t.DataType||(t.DataType={}));let n;t.codec=()=>(n==null&&(n=lt((i,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),i.Type!=null&&(o.uint32(8),t.DataType.codec().encode(i.Type,o)),i.Data!=null&&(o.uint32(18),o.bytes(i.Data)),i.filesize!=null&&(o.uint32(24),o.uint64(i.filesize)),i.blocksizes!=null)for(let c of i.blocksizes)o.uint32(32),o.uint64(c);i.hashType!=null&&(o.uint32(40),o.uint64(i.hashType)),i.fanout!=null&&(o.uint32(48),o.uint64(i.fanout)),i.mode!=null&&(o.uint32(56),o.uint32(i.mode)),i.mtime!=null&&(o.uint32(66),Wt.codec().encode(i.mtime,o)),s.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let s={blocksizes:[]},c=o==null?i.len:i.pos+o;for(;i.pos<c;){let u=i.uint32();switch(u>>>3){case 1:s.Type=t.DataType.codec().decode(i);break;case 2:s.Data=i.bytes();break;case 3:s.filesize=i.uint64();break;case 4:s.blocksizes.push(i.uint64());break;case 5:s.hashType=i.uint64();break;case 6:s.fanout=i.uint64();break;case 7:s.mode=i.uint32();break;case 8:s.mtime=Wt.codec().decode(i,i.uint32());break;default:i.skipType(u&7);break}}return s})),n),t.encode=i=>ht(i,t.codec()),t.decode=i=>ct(i,t.codec())})(te||(te={}));var Wt;(function(t){let e;t.codec=()=>(e==null&&(e=lt((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.Seconds!=null&&(n.uint32(8),n.int64(r.Seconds)),r.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(r.FractionalNanoseconds)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},o=n==null?r.len:r.pos+n;for(;r.pos<o;){let s=r.uint32();switch(s>>>3){case 1:i.Seconds=r.int64();break;case 2:i.FractionalNanoseconds=r.fixed32();break;default:r.skipType(s&7);break}}return i})),e),t.encode=r=>ht(r,t.codec()),t.decode=r=>ct(r,t.codec())})(Wt||(Wt={}));var po;(function(t){let e;t.codec=()=>(e==null&&(e=lt((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.MimeType!=null&&(n.uint32(10),n.string(r.MimeType)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},o=n==null?r.len:r.pos+n;for(;r.pos<o;){let s=r.uint32();switch(s>>>3){case 1:i.MimeType=r.string();break;default:r.skipType(s&7);break}}return i})),e),t.encode=r=>ht(r,t.codec()),t.decode=r=>ct(r,t.codec())})(po||(po={}));var mo={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},bc=["directory","hamt-sharded-directory"],xo=parseInt("0644",8),yo=parseInt("0755",8),go=BigInt(1024),oe=class t{static unmarshal(e){let r=te.decode(e);if(r.fanout!=null&&r.fanout>go)throw new Ht(`Fanout size was too large - ${r.fanout} > ${go}`);let n=new t({type:mo[r.Type!=null?r.Type.toString():"File"],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:r.mtime!=null?{secs:r.mtime.Seconds??0n,nsecs:r.mtime.FractionalNanoseconds}:void 0,fanout:r.fanout});return n._originalMode=r.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:r,data:n,blockSizes:i,hashType:o,fanout:s,mtime:c,mode:u}=e;if(r!=null&&!Object.values(mo).includes(r))throw new st("Type: "+r+" is not valid");this.type=r??"file",this.data=n,this.hashType=o,this.fanout=s,this.blockSizes=i??[],this._originalMode=0,this.mode=u,this.mtime=c}set mode(e){e==null?this._mode=this.isDirectory()?yo:xo:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return bc.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(r=>{e+=r}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=te.DataType.Raw;break;case"directory":e=te.DataType.Directory;break;case"file":e=te.DataType.File;break;case"metadata":e=te.DataType.Metadata;break;case"symlink":e=te.DataType.Symlink;break;case"hamt-sharded-directory":e=te.DataType.HAMTShard;break;default:throw new st(`Type: ${e} is not valid`)}let r=this.data;(this.data==null||this.data.length===0)&&(r=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===xo&&!this.isDirectory()&&(n=void 0),n===yo&&this.isDirectory()&&(n=void 0));let i;return this.mtime!=null&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),te.encode({Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i})}};var Xt=ir(Eo(),1);function Ec(t){let e=new Array(4);for(let r=0;r<4;r++)e[r]=t&255,t=t>>8;return new Uint8Array(e)}var hd=xe({name:"murmur3-32",code:35,encode:t=>Ec(Xt.default.x86.hash32(t))}),_o=xe({name:"murmur3-128",code:34,encode:t=>_e.fromHex(Xt.default.x64.hash128(t))}),ld=xe({name:"murmur3-x64-64",code:34,encode:t=>_e.fromHex(Xt.default.x64.hash128(t)).subarray(0,8)});var Bo=ir(Ao(),1);var be=class t{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,r,n=0){this._options=e,this._popCount=0,this._parent=r,this._posAtParent=n,this._children=new Bo.default,this.key=null}async put(e,r){let n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,r)}async get(e){let r=await this._findChild(e);if(r!=null)return r.value}async del(e){let r=await this._findPlace(e),n=r.bucket._at(r.pos);n!=null&&n.key===e&&r.bucket._delAt(r.pos)}leafCount(){return this._children.compactArray().reduce((r,n)=>n instanceof t?r+n.leafCount():r+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let e=this._children.compactArray();for(let r of e)r instanceof t?yield*r.eachLeafSeries():yield r}serialize(e,r){let n=[];return r(this._children.reduce((i,o,s)=>(o!=null&&(o instanceof t?i.push(o.serialize(e,r)):i.push(e(o,s))),i),n))}async asyncTransform(e,r){return Io(this,e,r)}toJSON(){return this.serialize(Bc,Ic)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){let r=await this._findPlace(e),n=r.bucket._at(r.pos);if(!(n instanceof t)&&n!=null&&n.key===e)return n}async _findPlace(e){let r=this._options.hash(typeof e=="string"?jt(e):e),n=await r.take(this._options.bits),i=this._children.get(n);return i instanceof t?i._findPlace(r):{bucket:this,pos:n,hash:r,existingChild:i}}async _findNewBucketAndPos(e){let r=await this._findPlace(e);if(r.existingChild!=null&&r.existingChild.key!==e){let n=new t(this._options,r.bucket,r.pos);r.bucket._putObjectAt(r.pos,n);let i=await n._findPlace(r.existingChild.hash);return i.bucket._putAt(i,r.existingChild.key,r.existingChild.value),n._findNewBucketAndPos(r.hash)}return r}_putAt(e,r,n){this._putObjectAt(e.pos,{key:r,value:n,hash:e.hash})}_putObjectAt(e,r){this._children.get(e)==null&&this._popCount++,this._children.set(e,r)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let e=this._children.find(Ac);if(e!=null&&!(e instanceof t)){let r=e.hash;r.untake(this._options.bits);let n={pos:this._posAtParent,hash:r,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function Ac(t){return!!t}function Bc(t,e){return t.key}function Ic(t){return t}async function Io(t,e,r){let n=[];for(let i of t._children.compactArray())if(i instanceof be)await Io(i,e,r);else{let o=await e(i);n.push({bitField:t._children.bitField(),children:o})}return r(n)}var Sc=[255,254,252,248,240,224,192,128],Tc=[1,3,7,15,31,63,127,255],Kt=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let r=e,n=0;for(;r>0&&this._haveBits();){let i=this._value[this._currentBytePos],o=this._currentBitPos+1,s=Math.min(o,r),c=Nc(i,o-s,s);n=(n<<s)+c,r-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Nc(t,e,r){let n=Dc(e,r);return(t&n)>>>e}function Dc(t,e){return Sc[t]&Tc[Math.min(e+t-1,7)]}function So(t){function e(r){return r instanceof Zt?r:new Zt(r,t)}return e}var Zt=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,r){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=r,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let r=e;for(;this._availableBits<r;)await this._produceMoreBits();let n=0;for(;r>0;){let i=this._buffers[this._currentBufferIndex],o=Math.min(i.availableBits(),r),s=i.take(o);n=(n<<o)+s,r-=o,this._availableBits-=o,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let r=e;for(;r>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),r);n.untake(i),r-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?ot([this._value,Uint8Array.from([this._depth])]):this._value,r=await this._hashFn(e),n=new Kt(r);this._buffers.push(n),this._availableBits+=n.availableBits()}};function To(t){if(t==null||t.hashFn==null)throw new Error("please define an options.hashFn");let e={bits:t.bits??8,hash:So(t.hashFn)};return new be(e)}var Cc=async function(t){return(await _o.encode(t)).slice(0,8).reverse()},Uc=async(t,e,r)=>{let n=(e.tableSize()-1).toString(16).length;await Promise.all(t.map(async i=>{if(i.Name==null)throw new Error("Unexpected Link without a Name");if(i.Name.length===n){let o=parseInt(i.Name,16);e._putObjectAt(o,new be({hash:r._options.hash,bits:r._options.bits},e,o));return}await r.put(i.Name.substring(2),!0)}))},No=(t,e)=>t.toString(16).toUpperCase().padStart(e,"0").substring(0,e),Pc=t=>{let e=t.bucket,r=[];for(;e._parent!=null;)r.push(e),e=e._parent;return r.push(e),r.reverse()},Do=async(t,e,r,n,i)=>{if(n==null){if(t.Data==null)throw new C("no data in PBNode");let d;try{d=oe.unmarshal(t.Data)}catch(a){throw new C(a.message)}if(d.type!=="hamt-sharded-directory")throw new C("not a HAMT");if(d.fanout==null)throw new C("missing fanout");let v=To({hashFn:Cc,bits:Math.log2(Number(d.fanout))});n={rootBucket:v,hamtDepth:1,lastBucket:v}}let o=(n.lastBucket.tableSize()-1).toString(16).length;await Uc(t.Links,n.lastBucket,n.rootBucket);let s=await n.rootBucket._findNewBucketAndPos(e),c=No(s.pos,o),u=Pc(s);u.length>n.hamtDepth&&(n.lastBucket=u[n.hamtDepth],c=No(n.lastBucket._posAtParent,o));let l=t.Links.find(d=>{if(d.Name==null)return!1;let v=d.Name.substring(0,o),a=d.Name.substring(o);return!(v!==c||a!==""&&a!==e)});if(l==null)return;if(l.Name!=null&&l.Name.substring(o)===e)return l.Hash;n.hamtDepth++;let m=await F(r.get(l.Hash,i));return t=le(m),Do(t,e,r,n,i)},Co=Do;function Oe(t){return t?.extended===!1}function Lc(t){let[e,r]=t[Symbol.asyncIterator]!=null?[t[Symbol.asyncIterator](),Symbol.asyncIterator]:[t[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[r](){return this}}}var Qt=Lc;function Fc(t){return t[Symbol.asyncIterator]!=null}function zc(t,e){let r=0;if(Fc(t))return(async function*(){for await(let u of t)await e(u,r++)&&(yield u)})();let n=Qt(t),{value:i,done:o}=n.next();if(o===!0)return(function*(){})();let s=e(i,r++);if(typeof s.then=="function")return(async function*(){await s&&(yield i);for(let u of n)await e(u,r++)&&(yield u)})();let c=e;return(function*(){s===!0&&(yield i);for(let u of n)c(u,r++)&&(yield u)})()}var Uo=zc;function $c(t){return t[Symbol.asyncIterator]!=null}function Rc(t,e){let r=0;if($c(t))return(async function*(){for await(let u of t)yield e(u,r++)})();let n=Qt(t),{value:i,done:o}=n.next();if(o===!0)return(function*(){})();let s=e(i,r++);if(typeof s.then=="function")return(async function*(){yield await s;for(let u of n)yield e(u,r++)})();let c=e;return(function*(){yield s;for(let u of n)yield c(u,r++)})()}var He=Rc;function V(){let t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t}var Yt=globalThis.CustomEvent??Event;async function*Ee(t,e={}){let r=e.concurrency??1/0;r<1&&(r=1/0);let n=e.ordered??!1,i=new EventTarget,o=[],s=V(),c=V(),u=!1,l,m=!1;i.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(async()=>{try{for await(let h of t){if(o.length===r&&(s=V(),await s.promise),m)break;let p={done:!1};o.push(p),h().then(B=>{p.done=!0,p.ok=!0,p.value=B,i.dispatchEvent(new Yt("task-complete"))},B=>{p.done=!0,p.err=B,i.dispatchEvent(new Yt("task-complete"))})}u=!0,i.dispatchEvent(new Yt("task-complete"))}catch(h){l=h,i.dispatchEvent(new Yt("task-complete"))}});function d(){return n?o[0]?.done:!!o.find(h=>h.done)}function*v(){for(;o.length>0&&o[0].done;){let h=o[0];if(o.shift(),h.ok)yield h.value;else throw m=!0,s.resolve(),h.err;s.resolve()}}function*a(){for(;d();)for(let h=0;h<o.length;h++)if(o[h].done){let p=o[h];if(o.splice(h,1),h--,p.ok)yield p.value;else throw m=!0,s.resolve(),p.err;s.resolve()}}for(;;){if(d()||(c=V(),await c.promise),l!=null||(n?yield*v():yield*a(),l!=null))throw l;if(u&&o.length===0)break}}var er=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Ve=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new er(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let r=this.head;this.head=r.next=new er(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var rn=class extends Error{type;code;constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function tr(t={}){return Mc(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},t)}function Mc(t,e){e=e??{};let r=e.onEnd,n=new Ve,i,o,s,c=V(),u=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((B,y)=>{o=w=>{o=null,n.push(w);try{B(t(n))}catch(b){y(b)}return i}}):t(n)}finally{n.isEmpty()&&queueMicrotask(()=>{c.resolve(),c=V()})}},l=B=>o!=null?o(B):(n.push(B),i),m=B=>(n=new Ve,o!=null?o({error:B}):(n.push({error:B}),i)),d=B=>{if(s)return i;if(e?.objectMode!==!0&&B?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:B})},v=B=>s?i:(s=!0,B!=null?m(B):l({done:!0})),a=()=>(n=new Ve,v(),{done:!0}),h=B=>(v(B),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:u,return:a,throw:h,push:d,end:v,get readableLength(){return n.size},onEmpty:async B=>{let y=B?.signal;if(y?.throwIfAborted(),n.isEmpty())return;let w,b;y!=null&&(w=new Promise((_,A)=>{b=()=>{A(new rn)},y.addEventListener("abort",b)}));try{await Promise.race([c.promise,w])}finally{b!=null&&y!=null&&y?.removeEventListener("abort",b)}}},r==null)return i;let p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(B){return p.throw(B),r!=null&&(r(B),r=void 0),{done:!0}},return(){return p.return(),r!=null&&(r(),r=void 0),{done:!0}},push:d,end(B){return p.end(B),r!=null&&(r(B),r=void 0),i},get readableLength(){return p.readableLength},onEmpty:B=>p.onEmpty(B)},i}var rr=class extends Error{type;code;constructor(e,r,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=r??"ABORT_ERR"}};async function Po(t,e,r){if(e==null)return t;if(e.aborted)return t.catch(()=>{}),Promise.reject(new rr(r?.errorMessage,r?.errorCode,r?.errorName));let n,i=new rr(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([t,new Promise((o,s)=>{n=()=>{s(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}var nn=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=V(),this.haveNext=V()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=V(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,r){await this._push(e,r)}async end(e,r){e!=null?await this.throw(e):await this._push(void 0,r)}async _push(e,r){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=V(),await Po(this.readNext.promise,r?.signal,r)}};function Lo(){return new nn}function Oc(t){return t[Symbol.asyncIterator]!=null}async function Hc(t,e,r){try{await Promise.all(t.map(async n=>{for await(let i of n)await e.push(i,{signal:r}),r.throwIfAborted()})),await e.end(void 0,{signal:r})}catch(n){await e.end(n,{signal:r}).catch(()=>{})}}async function*Vc(t){let e=new AbortController,r=Lo();Hc(t,r,e.signal).catch(()=>{});try{yield*r}finally{e.abort()}}function*jc(t){for(let e of t)yield*e}function Gc(...t){let e=[];for(let r of t)Oc(r)||e.push(r);return e.length===t.length?jc(e):Vc(t)}var Fo=Gc;function je(t,...e){if(t==null)throw new Error("Empty pipeline");if(on(t)){let n=t;t=()=>n.source}else if($o(t)||zo(t)){let n=t;t=()=>n}let r=[t,...e];if(r.length>1&&on(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)on(r[n])&&(r[n]=Wc(r[n]));return qc(...r)}var qc=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},zo=t=>t?.[Symbol.asyncIterator]!=null,$o=t=>t?.[Symbol.iterator]!=null,on=t=>t==null?!1:t.sink!=null&&t.source!=null,Wc=t=>e=>{let r=t.sink(e);if(r?.then!=null){let n=tr({objectMode:!0});r.then(()=>{n.end()},s=>{n.end(s)});let i,o=t.source;if(zo(o))i=async function*(){yield*o,n.end()};else if($o(o))i=function*(){yield*o,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Fo(n,i())}return t.source};var Jc=(t,e,r,n,i,o,s)=>{async function*c(u={}){let l=u.offset??0,m=u.length??e.Links.length,d=e.Links.slice(l,m);u.onProgress?.(new R("unixfs:exporter:walk:directory",{cid:t})),yield*je(d,v=>He(v,a=>async()=>{let h=a.Name??"",p=`${n}/${h}`;return Oe(u)?{cid:a.Hash,name:h,path:p}:(await i(a.Hash,h,p,[],o+1,s,u)).entry}),v=>Ee(v,{ordered:!0,concurrency:u.blockReadConcurrency}),v=>Uo(v,a=>a!=null))}return c},Ro=Jc;var an=ir(Oo(),1);var cn=class t extends Error{name="TimeoutError";constructor(e,r){super(e,r),Error.captureStackTrace?.(this,t)}},Ho=t=>t.reason??new DOMException("This operation was aborted.","AbortError");function un(t,e){let{milliseconds:r,fallback:n,message:i,customTimers:o={setTimeout,clearTimeout},signal:s}=e,c,u,m=new Promise((d,v)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(s?.aborted){v(Ho(s));return}if(s&&(u=()=>{v(Ho(s))},s.addEventListener("abort",u,{once:!0})),t.then(d,v),r===Number.POSITIVE_INFINITY)return;let a=new cn;c=o.setTimeout(()=>{if(n){try{d(n())}catch(h){v(h)}return}typeof t.cancel=="function"&&t.cancel(),i===!1?d():i instanceof Error?v(i):(a.message=i??`Promise timed out after ${r} milliseconds`,v(a))},r)}).finally(()=>{m.clear(),u&&s&&s.removeEventListener("abort",u)});return m.clear=()=>{o.clearTimeout(c),c=void 0},m}function fn(t,e,r){let n=0,i=t.length;for(;i>0;){let o=Math.trunc(i/2),s=n+o;r(t[s],e)<=0?(n=++s,i-=o+1):i=o}return n}var mt=class{#t=[];enqueue(e,r){let{priority:n=0,id:i}=r??{},o={priority:n,id:i,run:e};if(this.size===0||this.#t[this.size-1].priority>=n){this.#t.push(o);return}let s=fn(this.#t,o,(c,u)=>u.priority-c.priority);this.#t.splice(s,0,o)}setPriority(e,r){let n=this.#t.findIndex(o=>o.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=this.#t.splice(n,1);this.enqueue(i.run,{priority:r,id:e})}dequeue(){return this.#t.shift()?.run}filter(e){return this.#t.filter(r=>r.priority===e.priority).map(r=>r.run)}get size(){return this.#t.length}};var xt=class extends an.default{#t;#n;#i=0;#d;#p=!1;#m=!1;#u;#w=0;#x=0;#o;#s;#e;#b;#r=0;#f;#a;#B=1n;#h=new Map;timeout;constructor(e){if(super(),e={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:mt,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);if(this.#t=e.carryoverIntervalCount??e.carryoverConcurrencyCount??!1,this.#n=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#d=e.intervalCap,this.#u=e.interval,this.#e=new e.queueClass,this.#b=e.queueClass,this.concurrency=e.concurrency,e.timeout!==void 0&&!(Number.isFinite(e.timeout)&&e.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${e.timeout}\` (${typeof e.timeout})`);this.timeout=e.timeout,this.#a=e.autoStart===!1,this.#P()}get#I(){return this.#n||this.#i<this.#d}get#S(){return this.#r<this.#f}#T(){this.#r--,this.#r===0&&this.emit("pendingZero"),this.#y(),this.emit("next")}#N(){this.#v(),this.#k(),this.#s=void 0}get#D(){let e=Date.now();if(this.#o===void 0){let r=this.#w-e;if(r<0){if(this.#x>0){let n=e-this.#x;if(n<this.#u)return this.#E(this.#u-n),!0}this.#i=this.#t?this.#r:0}else return this.#E(r),!0}return!1}#E(e){this.#s===void 0&&(this.#s=setTimeout(()=>{this.#N()},e))}#_(){this.#o&&(clearInterval(this.#o),this.#o=void 0)}#C(){this.#s&&(clearTimeout(this.#s),this.#s=void 0)}#y(){if(this.#e.size===0)return this.#_(),this.emit("empty"),this.#r===0&&(this.#C(),this.emit("idle")),!1;let e=!1;if(!this.#a){let r=!this.#D;if(this.#I&&this.#S){let n=this.#e.dequeue();this.#n||(this.#i++,this.#l()),this.emit("active"),this.#x=Date.now(),n(),r&&this.#k(),e=!0}}return e}#k(){this.#n||this.#o!==void 0||(this.#o=setInterval(()=>{this.#v()},this.#u),this.#w=Date.now()+this.#u)}#v(){this.#i===0&&this.#r===0&&this.#o&&this.#_(),this.#i=this.#t?this.#r:0,this.#g(),this.#l()}#g(){for(;this.#y(););}get concurrency(){return this.#f}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#f=e,this.#g()}async#U(e){return new Promise((r,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})}setPriority(e,r){if(typeof r!="number"||!Number.isFinite(r))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${r}\` (${typeof r})`);this.#e.setPriority(e,r)}async add(e,r={}){return r.id??=(this.#B++).toString(),r={timeout:this.timeout,...r},new Promise((n,i)=>{let o=Symbol(`task-${r.id}`);this.#e.enqueue(async()=>{this.#r++,this.#h.set(o,{id:r.id,priority:r.priority??0,startTime:Date.now(),timeout:r.timeout});try{try{r.signal?.throwIfAborted()}catch(u){throw this.#n||this.#i--,this.#h.delete(o),u}let s=e({signal:r.signal});r.timeout&&(s=un(Promise.resolve(s),{milliseconds:r.timeout,message:`Task timed out after ${r.timeout}ms (queue has ${this.#r} running, ${this.#e.size} waiting)`})),r.signal&&(s=Promise.race([s,this.#U(r.signal)]));let c=await s;n(c),this.emit("completed",c)}catch(s){i(s),this.emit("error",s)}finally{this.#h.delete(o),queueMicrotask(()=>{this.#T()})}},r),this.emit("add"),this.#y()})}async addAll(e,r){return Promise.all(e.map(async n=>this.add(n,r)))}start(){return this.#a?(this.#a=!1,this.#g(),this):this}pause(){this.#a=!0}clear(){this.#e=new this.#b,this.#A()}async onEmpty(){this.#e.size!==0&&await this.#c("empty")}async onSizeLessThan(e){this.#e.size<e||await this.#c("next",()=>this.#e.size<e)}async onIdle(){this.#r===0&&this.#e.size===0||await this.#c("idle")}async onPendingZero(){this.#r!==0&&await this.#c("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#c("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#c("rateLimitCleared")}async onError(){return new Promise((e,r)=>{let n=i=>{this.off("error",n),r(i)};this.on("error",n)})}async#c(e,r){return new Promise(n=>{let i=()=>{r&&!r()||(this.off(e,i),n())};this.on(e,i)})}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#r}get isPaused(){return this.#a}#P(){this.#n||(this.on("add",()=>{this.#e.size>0&&this.#l()}),this.on("next",()=>{this.#l()}))}#l(){this.#n||this.#m||(this.#m=!0,queueMicrotask(()=>{this.#m=!1,this.#A()}))}#A(){let e=this.#p,r=!this.#n&&this.#i>=this.#d&&this.#e.size>0;r!==e&&(this.#p=r,this.emit(r?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#p}get isSaturated(){return this.#r===this.#f&&this.#e.size>0||this.isRateLimited&&this.#e.size>0}get runningTasks(){return[...this.#h.values()].map(e=>({...e}))}};async function Vo(t,e,r,n,i,o,s){if(e instanceof Uint8Array){let l=ye(e,n,i,o);r.push(l);return}if(e.Data==null)throw new C("no data in PBNode");let c;try{c=oe.unmarshal(e.Data)}catch(l){throw new C(l.message)}if(c.data!=null){let l=c.data,m=ye(l,n,i,o);r.push(m),n+=BigInt(m.byteLength)}let u=[];if(e.Links.length!==c.blockSizes.length)throw new C("Inconsistent block sizes and dag links");for(let l=0;l<e.Links.length;l++){let m=e.Links[l],d=n,v=d+c.blockSizes[l];if((i>=d&&i<v||o>=d&&o<=v||i<d&&o>v)&&u.push({link:m,blockStart:n}),n=v,n>o)break}await je(u,l=>He(l,m=>async()=>{let d=await F(t.get(m.link.Hash,s));return{...m,block:d}}),l=>Ee(l,{ordered:!0,concurrency:s.blockReadConcurrency}),async l=>{for await(let{link:m,block:d,blockStart:v}of l){let a;switch(m.Hash.code){case Mt:a=le(d);break;case Ot:a=d;break;default:r.end(new C(`Unsupported codec: ${m.Hash.code}`));return}let h=new xt({concurrency:1});h.on("error",p=>{r.end(p)}),h.add(async()=>{s.onProgress?.(new R("unixfs:exporter:walk:file",{cid:m.Hash})),await Vo(t,a,r,v,i,o,s)}),await h.onIdle()}}),n>=o&&r.end()}var Zc=(t,e,r,n,i,o,s)=>{async function*c(u={}){let l=r.fileSize();if(l===void 0)throw new Error("File was a directory");let{start:m,end:d}=Re(l,u.offset,u.length);if(d===0n)return;let v=0n,a=d-m,h=tr();u.onProgress?.(new R("unixfs:exporter:walk:file",{cid:t})),Vo(s,e,h,0n,m,d,u).catch(p=>{h.end(p)});for await(let p of h)if(p!=null){if(v+=BigInt(p.byteLength),v>a)throw h.end(),new Ze("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");v===a&&h.end(),u.onProgress?.(new R("unixfs:exporter:progress:unixfs:file",{bytesRead:v,totalBytes:a,fileSize:l})),yield p}if(v<a)throw new Qe("Traversed entire DAG but did not read enough bytes")}return c},hn=Zc;var Qc=(t,e,r,n,i,o,s)=>{function c(u={}){return u.onProgress?.(new R("unixfs:exporter:walk:hamt-sharded-directory",{cid:t})),jo(e,n,i,o,s,u)}return c};async function*jo(t,e,r,n,i,o){let s=t.Links;if(t.Data==null)throw new C("no data in PBNode");let c;try{c=oe.unmarshal(t.Data)}catch(m){throw new C(m.message)}if(c.fanout==null)throw new C("missing fanout");let u=(c.fanout-1n).toString(16).length,l=je(s,m=>He(m,d=>async()=>{let v=d.Name!=null?d.Name.substring(u):null;if(v!=null&&v!==""){let a=`${e}/${v}`;return Oe(o)?{entries:[{cid:d.Hash,name:v,path:a}]}:{entries:[(await r(d.Hash,v,a,[],n+1,i,o)).entry].filter(Boolean)}}else{let a=await F(i.get(d.Hash,o));return t=le(a),o.onProgress?.(new R("unixfs:exporter:walk:hamt-sharded-directory",{cid:d.Hash})),{entries:jo(t,e,r,n,i,o)}}}),m=>Ee(m,{ordered:!0,concurrency:o.blockReadConcurrency}));for await(let{entries:m}of l)yield*m}var Go=Qc;var Yc=(t,e)=>t.Links.find(n=>n.Name===e)?.Hash,eu={raw:hn,file:hn,directory:Ro,"hamt-sharded-directory":Go,metadata:(t,e,r,n,i,o,s)=>()=>[],symlink:(t,e,r,n,i,o,s)=>()=>[]},tu=async(t,e,r,n,i,o,s,c)=>{if(Oe(c)&&n.length===0)return{entry:{cid:t,name:e,path:r}};let u=await F(s.get(t,c)),l=le(u),m,d;if(e==null&&(e=t.toString()),l.Data==null)throw new C("no data in PBNode");try{m=oe.unmarshal(l.Data)}catch(a){throw new C(a.message)}if(r==null&&(r=e),n.length>0){let a;if(m?.type==="hamt-sharded-directory"?a=await Co(l,n[0],s):a=Yc(l,n[0]),a==null)throw new j("file does not exist");let h=n.shift(),p=`${r}/${h}`;d={cid:a,toResolve:n,name:h??"",path:p}}let v=eu[m.type](t,l,m,r,i,o,s);if(v==null)throw new j("could not find content exporter");return m.isDirectory()?{entry:{type:"directory",name:e,path:r,cid:t,content:v,unixfs:m,depth:o,node:l,size:m.fileSize()},next:d}:{entry:{type:"file",name:e,path:r,cid:t,content:v,unixfs:m,depth:o,node:l,size:m.fileSize()},next:d}},qo=tu;var ru={[Mt]:qo,[Ot]:Wi,[Bi]:Vi,[Ci]:ji,[Ur.code]:Gi,[Ri]:qi},Wo=async(t,e,r,n,i,o,s)=>{let c=ru[t.code];if(c==null)throw new Ke(`No resolver for code ${t.code}`);return c(t,e,r,n,Wo,i,o,s)},Jo=Wo;var nu=(t="")=>(t.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),iu=t=>{if(t instanceof Uint8Array)return{cid:U.decode(t),toResolve:[]};let e=U.asCID(t);if(e!=null)return{cid:e,toResolve:[]};if(typeof t=="string"){t.indexOf("/ipfs/")===0&&(t=t.substring(6));let r=nu(t);return{cid:U.parse(r[0]),toResolve:r.slice(1)}}throw new Xe(`Unknown path type ${t}`)};async function*Xo(t,e,r={}){let{cid:n,toResolve:i}=iu(t),o=n.toString(),s=o,c=i.length;for(;;){let u=await Jo(n,o,s,i,c,e,r);if(u.entry==null&&u.next==null)throw new j(`Could not resolve ${t}`);if(u.entry!=null&&(yield u.entry),u.next==null)return;i=u.next.toResolve,n=u.next.cid,o=u.next.name,s=u.next.path}}async function Ko(t,e,r={}){let n=await dn(Xo(t,e,r));if(n==null)throw new j(`Could not resolve ${t}`);return n}async function*ou(t,e,r={}){let n=await Ko(t,e,r);if(n==null)return;if(yield n,n.type==="directory")for await(let o of i(n,r))yield o;async function*i(o,s){for await(let c of o.content(s))yield c,!(c instanceof Uint8Array)&&c.type==="directory"&&(yield*i(c,s))}}return rs(su);})();
return IpfsUnixfsExporter}));
//# sourceMappingURL=index.min.js.map
