(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.BlockstoreCore = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var BlockstoreCore=(()=>{var W=Object.defineProperty;var ke=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var $e=Object.prototype.hasOwnProperty;var Oe=(r,e)=>{for(var t in e)W(r,t,{get:e[t],enumerable:!0})},Ue=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Me(e))!$e.call(r,o)&&o!==t&&W(r,o,{get:()=>e[o],enumerable:!(n=ke(e,o))||n.enumerable});return r};var ze=r=>Ue(W({},"__esModule",{value:!0}),r);var Pt={};Oe(Pt,{BaseBlockstore:()=>N,BlackHoleBlockstore:()=>X,MemoryBlockstore:()=>G,TieredBlockstore:()=>Z});var N=class{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(let{cid:n,bytes:o}of e)await this.put(n,o,t),yield n}get(e,t){throw new Error(".get is not implemented")}async*getMany(e,t){for await(let n of e)yield{cid:n,bytes:this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(let n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}};var D=class r extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=r.name;code=r.code;constructor(e="Not Found"){super(e)}};function Le(r){return r[Symbol.asyncIterator]!=null}function Te(r){if(Le(r))return(async()=>{let t=[];for await(let n of r)t.push(n);return t})();let e=[];for(let t of r)e.push(t);return e}var ae=Te;var Xt=new Uint8Array(0);function ce(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function R(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Pe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),i=s.charCodeAt(0);if(t[i]!==255)throw new TypeError(s+" is ambiguous");t[i]=o}var d=r.length,h=r.charAt(0),I=Math.log(d)/Math.log(256),a=Math.log(256)/Math.log(d);function c(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";for(var l=0,p=0,m=0,y=u.length;m!==y&&u[m]===0;)m++,l++;for(var v=(y-m)*a+1>>>0,b=new Uint8Array(v);m!==y;){for(var A=u[m],E=0,x=v-1;(A!==0||E<p)&&x!==-1;x--,E++)A+=256*b[x]>>>0,b[x]=A%d>>>0,A=A/d>>>0;if(A!==0)throw new Error("Non-zero carry");p=E,m++}for(var F=v-p;F!==v&&b[F]===0;)F++;for(var $=h.repeat(l);F<v;++F)$+=r.charAt(b[F]);return $}function f(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;var l=0;if(u[l]!==" "){for(var p=0,m=0;u[l]===h;)p++,l++;for(var y=(u.length-l)*I+1>>>0,v=new Uint8Array(y);u[l];){var b=t[u.charCodeAt(l)];if(b===255)return;for(var A=0,E=y-1;(b!==0||A<m)&&E!==-1;E--,A++)b+=d*v[E]>>>0,v[E]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");m=A,l++}if(u[l]!==" "){for(var x=y-m;x!==y&&v[x]===0;)x++;for(var F=new Uint8Array(p+(y-x)),$=p;x!==y;)F[$++]=v[x++];return F}}}function M(u){var l=f(u);if(l)return l;throw new Error(`Non-${e} character`)}return{encode:c,decodeUnsafe:f,decode:M}}var Be=Pe,Ve=Be,ue=Ve;var Y=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;let o=t.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return de(this,e)}},ee=class{decoders;constructor(e){this.decoders=e}or(e){return de(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function de(r,e){return new ee({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}var te=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Y(e,t,n),this.decoder=new _(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function le({name:r,prefix:e,encode:t,decode:n}){return new te(r,e,t,n)}function O({name:r,prefix:e,alphabet:t}){let{encode:n,decode:o}=ue(t,r);return le({prefix:e,name:r,encode:n,decode:s=>R(o(s))})}function je(r,e,t,n){let o=r.length;for(;r[o-1]==="=";)--o;let s=new Uint8Array(o*t/8|0),i=0,d=0,h=0;for(let I=0;I<o;++I){let a=e[r[I]];if(a===void 0)throw new SyntaxError(`Non-${n} character`);d=d<<t|a,i+=t,i>=8&&(i-=8,s[h++]=255&d>>i)}if(i>=t||(255&d<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function qe(r,e,t){let n=e[e.length-1]==="=",o=(1<<t)-1,s="",i=0,d=0;for(let h=0;h<r.length;++h)for(d=d<<8|r[h],i+=8;i>t;)i-=t,s+=e[o&d>>i];if(i!==0&&(s+=e[o&d<<t-i]),n)for(;(s.length*t&7)!==0;)s+="=";return s}function Je(r){let e={};for(let t=0;t<r.length;++t)e[r[t]]=t;return e}function w({name:r,prefix:e,bitsPerChar:t,alphabet:n}){let o=Je(n);return le({prefix:e,name:r,encode(s){return qe(s,n,t)},decode(s){return je(s,o,t,r)}})}var C=w({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_t=w({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),er=w({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),tr=w({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rr=w({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),nr=w({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),or=w({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sr=w({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ir=w({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var j=O({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ur=O({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var S=O({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fr=O({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ge=pe,fe=128,Xe=127,He=~Xe,Ke=Math.pow(2,31);function pe(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ke;)e[t++]=r&255|fe,r/=128;for(;r&He;)e[t++]=r&255|fe,r>>>=7;return e[t]=r|0,pe.bytes=t-n+1,e}var Qe=re,Ze=128,he=127;function re(r,n){var t=0,n=n||0,o=0,s=n,i,d=r.length;do{if(s>=d)throw re.bytes=0,new RangeError("Could not decode varint");i=r[s++],t+=o<28?(i&he)<<o:(i&he)*Math.pow(2,o),o+=7}while(i>=Ze);return re.bytes=s-n,t}var We=Math.pow(2,7),Ye=Math.pow(2,14),_e=Math.pow(2,21),et=Math.pow(2,28),tt=Math.pow(2,35),rt=Math.pow(2,42),nt=Math.pow(2,49),ot=Math.pow(2,56),st=Math.pow(2,63),it=function(r){return r<We?1:r<Ye?2:r<_e?3:r<et?4:r<tt?5:r<rt?6:r<nt?7:r<ot?8:r<st?9:10},at={encode:Ge,decode:Qe,encodingLength:it},ct=at,P=ct;function B(r,e=0){return[P.decode(r,e),P.decode.bytes]}function U(r,e,t=0){return P.encode(r,e,t),e}function z(r){return P.encodingLength(r)}function be(r,e){let t=e.byteLength,n=z(r),o=n+z(t),s=new Uint8Array(o+t);return U(r,s,0),U(t,s,n),s.set(e,o),new L(r,t,e,s)}function q(r){let e=R(r),[t,n]=B(e),[o,s]=B(e.subarray(n)),i=e.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new L(t,o,i,e)}function ye(r,e){if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ce(r.bytes,t.bytes)}}var L=class{code;size;digest;bytes;constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};function ge(r,e){let{bytes:t,version:n}=r;switch(n){case 0:return dt(t,ne(r),e??S.encoder);default:return lt(t,ne(r),e??C.encoder)}}var xe=new WeakMap;function ne(r){let e=xe.get(r);if(e==null){let t=new Map;return xe.set(r,t),t}return e}var J=class r{code;version;multihash;bytes;"/";constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==V)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ft)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=be(e,t);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return r.equals(this,e)}static equals(e,t){let n=t;return n!=null&&e.code===n.code&&e.version===n.version&&ye(e.multihash,n.multihash)}toString(e){return ge(this,e)}toJSON(){return{"/":ge(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:o,multihash:s,bytes:i}=t;return new r(n,o,s,i??Ce(n,o,s.bytes))}else if(t[ht]===!0){let{version:n,multihash:o,code:s}=t,i=q(o);return r.create(n,s,i)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==V)throw new Error(`Version 0 CID must use dag-pb (code: ${V}) block encoding`);return new r(e,t,n,n.bytes)}case 1:{let o=Ce(e,t,n.bytes);return new r(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,V,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,n]=r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),n=t.size-t.multihashSize,o=R(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=o.subarray(t.multihashSize-t.digestSize),i=new L(t.multihashCode,t.digestSize,s,o);return[t.version===0?r.createV0(i):r.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[c,f]=B(e.subarray(t));return t+=f,c},o=n(),s=V;if(o===18?(o=0,t=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=t,d=n(),h=n(),I=t+h,a=I-i;return{version:o,codec:s,multihashCode:d,digestSize:h,multihashSize:a,size:I}}static parse(e,t){let[n,o]=ut(e,t),s=r.decode(o);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ne(s).set(n,e),s}};function ut(r,e){switch(r[0]){case"Q":{let t=e??S;return[S.prefix,t.decode(`${S.prefix}${r}`)]}case S.prefix:{let t=e??S;return[S.prefix,t.decode(r)]}case C.prefix:{let t=e??C;return[C.prefix,t.decode(r)]}case j.prefix:{let t=e??j;return[j.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function dt(r,e,t){let{prefix:n}=t;if(n!==S.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return o}function lt(r,e,t){let{prefix:n}=t,o=e.get(n);if(o==null){let s=t.encode(r);return e.set(n,s),s}else return o}var V=112,ft=18;function Ce(r,e,t){let n=z(r),o=n+z(e),s=new Uint8Array(o+t.byteLength);return U(r,s,0),U(e,s,n),s.set(t,o),s}var ht=Symbol.for("@ipld/js-cid/CID");var ve=85;function mt(r){return typeof r?.then=="function"}var G=class extends N{data;constructor(){super(),this.data=new Map}put(e,t,n){n?.signal?.throwIfAborted();let o;if(t instanceof Uint8Array)o=[t];else{let s=ae(t);if(mt(s))return s.then(i=>this._put(e,i,n));o=s}return this._put(e,o,n)}_put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(C.encode(e.multihash.bytes),t),e}*get(e,t){t?.signal?.throwIfAborted();let n=this.data.get(C.encode(e.multihash.bytes));if(n==null)throw new D;yield*n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(C.encode(e.multihash.bytes))}async delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(C.encode(e.multihash.bytes))}*getAll(e){e?.signal?.throwIfAborted();for(let[t,n]of this.data.entries())yield{cid:J.createV1(ve,q(C.decode(t))),bytes:(async function*(){yield*n})()},e?.signal?.throwIfAborted()}};var X=class extends N{put(e,t,n){return n?.signal?.throwIfAborted(),e}get(e,t){throw t?.signal?.throwIfAborted(),new D}has(e,t){return t?.signal?.throwIfAborted(),!1}async delete(e,t){t?.signal?.throwIfAborted()}async*getAll(e){e?.signal?.throwIfAborted()}};var Ee=w({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Or=w({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ur=w({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zr=w({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function bt(r,e){if(typeof r=="string")return yt(r);if(typeof r=="number")return xt(r,e);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(r)}`)}var H=bt;function yt(r){if(typeof r!="string"||r.length===0||r.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(r)}`);let e=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(r);if(!e?.groups)return NaN;let{value:t,unit:n="ms"}=e.groups,o=parseFloat(t),s=n.toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return o*315576e5;case"months":case"month":case"mo":return o*26298e5;case"weeks":case"week":case"w":return o*6048e5;case"days":case"day":case"d":return o*864e5;case"hours":case"hour":case"hrs":case"hr":case"h":return o*36e5;case"minutes":case"minute":case"mins":case"min":case"m":return o*6e4;case"seconds":case"second":case"secs":case"sec":case"s":return o*1e3;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:throw Error(`Unknown unit "${s}" provided to ms.parse(). value=${JSON.stringify(r)}`)}}function wt(r){let e=Math.abs(r);return e>=315576e5?`${Math.round(r/315576e5)}y`:e>=26298e5?`${Math.round(r/26298e5)}mo`:e>=6048e5?`${Math.round(r/6048e5)}w`:e>=864e5?`${Math.round(r/864e5)}d`:e>=36e5?`${Math.round(r/36e5)}h`:e>=6e4?`${Math.round(r/6e4)}m`:e>=1e3?`${Math.round(r/1e3)}s`:`${r}ms`}function gt(r){let e=Math.abs(r);return e>=315576e5?k(r,e,315576e5,"year"):e>=26298e5?k(r,e,26298e5,"month"):e>=6048e5?k(r,e,6048e5,"week"):e>=864e5?k(r,e,864e5,"day"):e>=36e5?k(r,e,36e5,"hour"):e>=6e4?k(r,e,6e4,"minute"):e>=1e3?k(r,e,1e3,"second"):`${r} ms`}function xt(r,e){if(typeof r!="number"||!Number.isFinite(r))throw Error("Value provided to ms.format() must be of type number.");return e?.long?gt(r):wt(r)}function k(r,e,t,n){let o=e>=t*1.5;return`${Math.round(r/t)} ${n}${o?"s":""}`}function oe(r){t.debug=t,t.default=t,t.coerce=h,t.disable=s,t.enable=o,t.enabled=i,t.humanize=H,t.destroy=I,Object.keys(r).forEach(a=>{t[a]=r[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let c=0;for(let f=0;f<a.length;f++)c=(c<<5)-c+a.charCodeAt(f),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(a){let c,f=null,M,u;function l(...p){if(!l.enabled)return;let m=l,y=Number(new Date),v=y-(c||y);m.diff=v,m.prev=c,m.curr=y,c=y,p[0]=t.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let b=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(E,x)=>{if(E==="%%")return"%";b++;let F=t.formatters[x];if(typeof F=="function"){let $=p[b];E=F.call(m,$),p.splice(b,1),b--}return E}),t.formatArgs.call(m,p),(m.log||t.log).apply(m,p)}return l.namespace=a,l.useColors=t.useColors(),l.color=t.selectColor(a),l.extend=n,l.destroy=t.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(M!==t.namespaces&&(M=t.namespaces,u=t.enabled(a)),u),set:p=>{f=p}}),typeof t.init=="function"&&t.init(l),l}function n(a,c){let f=t(this.namespace+(typeof c>"u"?":":c)+a);return f.log=this.log,f}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let c,f=(typeof a=="string"?a:"").split(/[\s,]+/),M=f.length;for(c=0;c<M;c++)f[c]&&(a=f[c].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.substr(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function s(){let a=[...t.names.map(d),...t.skips.map(d).map(c=>"-"+c)].join(",");return t.enable(""),a}function i(a){if(a[a.length-1]==="*")return!0;let c,f;for(c=0,f=t.skips.length;c<f;c++)if(t.skips[c].test(a))return!1;for(c=0,f=t.names.length;c<f;c++)if(t.names[c].test(a))return!0;return!1}function d(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function h(a){return a instanceof Error?a.stack??a.message:a}function I(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var K=It(),Ct=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function vt(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function Et(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+H(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(n=t))}),r.splice(n,0,e)}var Ft=console.debug??console.log??(()=>{});function At(r){try{r?K?.setItem("debug",r):K?.removeItem("debug")}catch{}}function St(){let r;try{r=K?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=globalThis.process.env.DEBUG),r}function It(){try{return localStorage}catch{}}function Nt(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}var Fe=oe({formatArgs:Et,save:At,load:St,useColors:vt,setupFormatters:Nt,colors:Ct,storage:K,log:Ft});var g=Fe;g.formatters.b=r=>r==null?"undefined":S.baseEncode(r);g.formatters.t=r=>r==null?"undefined":C.baseEncode(r);g.formatters.m=r=>r==null?"undefined":Ee.baseEncode(r);g.formatters.p=r=>r==null?"undefined":r.toString();g.formatters.c=r=>r==null?"undefined":r.toString();g.formatters.k=r=>r==null?"undefined":r.toString();g.formatters.a=r=>r==null?"undefined":r.toString();g.formatters.e=r=>{if(r==null)return"undefined";let e=Ae(r.message),t=Ae(r.stack);return e!=null&&t!=null?t.includes(e)?t:`${e}
${t}`:t??e??r.toString()};function Dt(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function se(r){let e=Dt(`${r}:trace`);return g.enabled(`${r}:trace`)&&g.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=g(`${r}:trace`)),Object.assign(g(r),{error:g(`${r}:error`),trace:e,newScope:t=>se(`${r}:${t}`)})}function Ae(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}function Rt(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:o=>{n.push(o)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}var Se=Rt;function kt(r){return r[Symbol.asyncIterator]!=null}function Mt(r,e){let t=0;if(kt(r))return(async function*(){for await(let h of r)await e(h,t++)&&(yield h)})();let n=Se(r),{value:o,done:s}=n.next();if(s===!0)return(function*(){})();let i=e(o,t++);if(typeof i.then=="function")return(async function*(){await i&&(yield o);for(let h of n)await e(h,t++)&&(yield h)})();let d=e;return(function*(){i===!0&&(yield o);for(let h of n)d(h,t++)&&(yield h)})()}var Ie=Mt;function T(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var Q=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function Ne(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new Q(t?.errorMessage,t?.errorCode,t?.errorName));let n,o=new Q(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((s,i)=>{n=()=>{i(o)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}var ie=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=T(),this.haveNext=T()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=T(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=T(),await Ne(this.readNext.promise,t?.signal,t)}};function De(){return new ie}function $t(r){return r[Symbol.asyncIterator]!=null}async function Ot(r,e,t){try{await Promise.all(r.map(async n=>{for await(let o of n)await e.push(o,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(n){await e.end(n,{signal:t}).catch(()=>{})}}async function*Ut(r){let e=new AbortController,t=De();Ot(r,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*zt(r){for(let e of r)yield*e}function Lt(...r){let e=[];for(let t of r)$t(t)||e.push(t);return e.length===r.length?zt(e):Ut(r)}var Re=Lt;var Tt=se("blockstore:core:tiered"),Z=class extends N{stores;constructor(e){super(),this.stores=e.slice()}async put(e,t,n){return await Promise.all(this.stores.map(async o=>{await o.put(e,t,n)})),e}async*get(e,t){let n;for(let o of this.stores)try{yield*o.get(e,t);return}catch(s){n=s,Tt.error(s)}throw n??new D}async has(e,t){for(let n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){await Promise.all(this.stores.map(async n=>{await n.delete(e,t)}))}async*putMany(e,t={}){for await(let n of e)await this.put(n.cid,n.bytes,t),yield n.cid}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}async*getAll(e){let t=new Set;yield*Ie(Re(...this.stores.map(n=>n.getAll(e))),n=>{let o=n.cid.toString();return t.has(o)?!1:(t.add(o),!0)})}};return ze(Pt);})();
return BlockstoreCore}));
//# sourceMappingURL=index.min.js.map
